# 인테리봇 성향분석 엔진 통합 분석 보고서

**작성일**: 2025년 12월 16일  
**목적**: DB 설계서 + 규칙서 + 현재 시스템 통합 분석  
**작성자**: AI Assistant

---

## 📋 목차

1. [전체 구조 비교](#1-전체-구조-비교)
2. [입력 구조 비교](#2-입력-구조-비교)
3. [분류 엔진 비교](#3-분류-엔진-비교)
4. [DB 쿼리 함수 비교](#4-db-쿼리-함수-비교)
5. [맥락 변환 및 AI 프롬프트 비교](#5-맥락-변환-및-ai-프롬프트-비교)
6. [실행 흐름 비교](#6-실행-흐름-비교)
7. [통합 구현 방안](#7-통합-구현-방안)
8. [구체적 마이그레이션 계획](#8-구체적-마이그레이션-계획)

---

## 1. 전체 구조 비교

### 1.1 현재 시스템 구조

```
현재 인테리봇 (V3 엔진):
├── 입력: SpaceInfo + VibeInput + 질문 답변
├── TraitEngine: 답변 → 점수 변환 (1-10점)
├── NeedsEngine: 점수 → Needs 변환
├── ProcessEngine: Needs → 공정 추천
├── RiskEngine: 리스크 탐지 (하드코딩)
├── AI 프롬프트: V3.1 설계서 기반
└── 출력: 분석 결과 + 추천 공정
```

**특징:**
- ✅ 점수 기반 정량 분석
- ✅ 단계적 변환 (Trait → Needs → Resolution → Action)
- ✅ V3.1 설계서 준수
- ❌ 입력 구조가 규칙서와 다름
- ❌ 분류 엔진이 규칙서와 다름

### 1.2 규칙서 제안 구조

```
규칙서 제안 시스템:
├── 입력: BasicInfo + LifestyleInput + PainPoints + DecisionStyle
├── 분류 엔진: 생활유형, 가족유형, 문제유형, 후회위험, 결정구조, 예산유연성
├── DB 쿼리: 평형/연식/가족/연령/예산/경고 조회
├── 맥락 변환: 분류 결과 + DB 데이터 → 맥락 문장
├── AI 프롬프트: 맥락 기반 맞춤 질문 생성
└── 출력: 맞춤 질문 + 경고 + 견적 파라미터
```

**특징:**
- ✅ 타입 기반 분류 (직관적)
- ✅ DB 기반 상세 정보 활용
- ✅ 연구 기반 위험 데이터
- ✅ 견적 시스템 연동 명확
- ❌ 현재 V3 엔진과 구조 다름

### 1.3 DB 설계서 구조

```
DB 설계서 제안:
├── personality_types: 성향 타입 마스터
├── risk_factors: 후회 위험 데이터
├── pyeong_characteristics: 평형별 특성
├── building_age_risks: 연식별 하자
├── age_preferences: 연령별 선호
├── family_needs: 가족 구성별 니즈
├── budget_benchmarks: 견적 기준점
├── warning_templates: 경고 문구
└── personality_material_mapping: 성향→자재 매핑
```

**특징:**
- ✅ 상세한 정보 DB화
- ✅ 템플릿 시스템
- ✅ 연구 기반 데이터
- ❌ 현재 personality_traits와 구조 다름

---

## 2. 입력 구조 비교

### 2.1 현재 시스템 입력

**파일**: `app/api/analyze/complete/route.ts`

```typescript
interface CompleteAnalysisRequest {
  spaceInfo: {
    housingType: string
    pyeong: number
    rooms: number
    bathrooms: number
    budget?: string
    budgetAmount?: number
    familySizeRange?: string
    ageRanges?: string[]
    lifestyleTags?: string[]
    livingPurpose?: '실거주' | '매도준비' | '임대'
    livingYears?: number
    totalPeople?: number
    additionalNotes?: string
    specialConditions?: {
      hasPets?: boolean
      hasElderly?: boolean
      hasPregnant?: boolean
      ...
    }
  }
  selectedSpaces: string[]
  selectedProcesses: Record<string, any>
  tierSelections?: Record<string, { enabled: boolean; tier: string }>
  detailOptions: { ... }
  personality: { ... }
}
```

**특징:**
- ✅ 이미 상세한 입력 구조
- ✅ specialConditions로 가족 특성 포함
- ⚠️ 규칙서의 LifestyleInput과 매핑 필요
- ⚠️ PainPoints가 명시적이지 않음
- ⚠️ DecisionStyle이 없음

### 2.2 규칙서 제안 입력

```typescript
interface BasicInfo {
  housing_type: 'apartment' | 'villa' | 'detached' | 'officetel'
  pyeong: number
  room_count: number
  bathroom_count: number
  building_age: number
  budget_min: number
  budget_max: number
  purpose: 'live' | 'sell' | 'rent'
  family_count: number
}

interface LifestyleInput {
  // 가족 특성
  family_infant: boolean
  family_child: boolean
  family_teen: boolean
  family_elderly: boolean
  family_pregnant: boolean
  family_mobility: boolean
  family_pet: boolean
  
  // 일상 패턴
  remote_work: boolean
  remote_work_days?: 1 | 2 | 3 | 4 | 5
  cook_often: boolean
  cook_frequency?: 'daily' | 'often' | 'sometimes'
  guests_often: boolean
  guests_frequency?: 'twice_month' | 'sometimes' | 'rarely'
  ...
}

interface PainPoints {
  // 입지형
  noise_neighbor: boolean
  commute_distance: boolean
  school_district: boolean
  neighborhood: boolean
  
  // 공간형
  kitchen_small: boolean
  storage_lack: boolean
  layout_bad: boolean
  bathroom_old: boolean
  ...
}

interface DecisionStyle {
  decision_type: 'solo' | 'joint' | 'split' | 'extended'
  budget_type: 'strict' | 'flexible' | 'uncertain'
  style_type: 'trendy' | 'timeless' | 'uncertain'
  participation: ('diy' | 'delegate' | 'select_materials')[]
  age_group: '20대' | '30대' | '40대' | '50대' | '60대+'
}
```

**특징:**
- ✅ 명확한 구조화
- ✅ PainPoints 분리 (입지형/공간형)
- ✅ DecisionStyle 명시
- ❌ 현재 시스템과 매핑 필요

### 2.3 매핑 방안

**현재 → 규칙서 변환 함수 필요:**

```typescript
function convertToRuleInput(current: CompleteAnalysisRequest): RuleInput {
  return {
    basic: {
      housing_type: mapHousingType(current.spaceInfo.housingType),
      pyeong: current.spaceInfo.pyeong,
      room_count: current.spaceInfo.rooms,
      bathroom_count: current.spaceInfo.bathrooms,
      building_age: calculateBuildingAge(current.spaceInfo),
      budget_min: extractBudgetMin(current.spaceInfo.budgetAmount),
      budget_max: extractBudgetMax(current.spaceInfo.budgetAmount),
      purpose: mapPurpose(current.spaceInfo.livingPurpose),
      family_count: current.spaceInfo.totalPeople || 1
    },
    lifestyle: {
      family_infant: current.spaceInfo.ageRanges?.includes('baby') || false,
      family_child: current.spaceInfo.ageRanges?.includes('child') || false,
      family_teen: current.spaceInfo.ageRanges?.includes('teen') || false,
      family_elderly: current.spaceInfo.specialConditions?.hasElderly || false,
      family_pregnant: current.spaceInfo.specialConditions?.hasPregnant || false,
      family_pet: current.spaceInfo.specialConditions?.hasPets || false,
      remote_work: current.spaceInfo.lifestyleTags?.includes('remoteWork') || false,
      ...
    },
    pain: extractPainPoints(current), // 불편 사항 추출
    decision: extractDecisionStyle(current) // 결정 스타일 추출
  }
}
```

**권장사항:**
1. **현재 입력 구조 유지** (이미 잘 구조화됨)
2. **변환 함수 추가**: 규칙서 분류 엔진 사용 시 변환
3. **점진적 확장**: PainPoints, DecisionStyle 필드 추가

---

## 3. 분류 엔진 비교

### 3.1 현재 시스템 분류

**파일**: `lib/analysis/engine-v3/engines/TraitEngine.ts`

```typescript
// 현재: 답변 → 점수 변환
TraitEngine.analyze() {
  // 1. 답변에서 영향(impact) 추출
  // 2. TraitIndicators12 점수 계산
  // 3. SpaceInfo 기반 조정
  // 4. 우선 문제 영역 도출
}
```

**특징:**
- ✅ 점수 기반 정량 분석
- ✅ 12개 지표 (수납중요도, 동선중요도, 소음민감도 등)
- ✅ V3.1 설계서 준수
- ❌ 타입 분류 없음 (예: "재택근무형")
- ❌ 문제유형 분류 없음 (입지형/공간형)

### 3.2 규칙서 제안 분류

```typescript
// 규칙서: 입력 → 타입 분류
classifyLifestyle(input: LifestyleInput): string[] {
  // 'lifestyle_remote', 'lifestyle_cook', 'lifestyle_social' 등
}

classifyFamily(input: LifestyleInput): string[] {
  // 'family_infant', 'family_child', 'family_elderly' 등
}

classifyProblem(pain: PainPoints): ProblemClassification {
  // location_score, space_score, recommendation
}

assessRisk(decision, basic, pain): RiskAssessment {
  // total_risk_score, risk_level, triggered_risks, buffer_percentage
}

classifyDecision(decision: DecisionStyle): DecisionClassification {
  // type, ai_response_style, features
}

classifyBudget(decision, basic, risk): BudgetClassification {
  // type, quote_strategy, adjusted_budget
}
```

**특징:**
- ✅ 직관적인 타입 분류
- ✅ 문제유형 분류 (입지형/공간형)
- ✅ 후회위험 평가 (연구 기반)
- ✅ 결정구조 분류
- ❌ 점수 기반 정량 분석 없음

### 3.3 통합 방안

**하이브리드 접근 (권장):**

```typescript
// 1단계: 현재 TraitEngine 실행 (점수 계산)
const traitResult = await traitEngine.analyze(input);

// 2단계: 규칙서 분류 엔진 실행 (타입 분류)
const lifestyleTypes = classifyLifestyle(ruleInput.lifestyle);
const familyTypes = classifyFamily(ruleInput.lifestyle);
const problem = classifyProblem(ruleInput.pain);
const risk = assessRisk(ruleInput.decision, ruleInput.basic, ruleInput.pain);
const decision = classifyDecision(ruleInput.decision);
const budget = classifyBudget(ruleInput.decision, ruleInput.basic, risk);

// 3단계: 점수 + 타입 통합
const integratedResult = {
  // 점수 기반 (기존)
  indicators: traitResult.indicators,
  priorityAreas: traitResult.priorityAreas,
  
  // 타입 기반 (신규)
  lifestyleTypes,
  familyTypes,
  problemClassification: problem,
  riskAssessment: risk,
  decisionClassification: decision,
  budgetClassification: budget
};
```

**장점:**
- ✅ 기존 점수 시스템 유지
- ✅ 타입 분류 추가로 직관성 향상
- ✅ 문제유형 분류로 이사/리모델링 구분
- ✅ 후회위험 평가로 예비비 계산

---

## 4. DB 쿼리 함수 비교

### 4.1 현재 시스템 DB 사용

**파일**: `lib/db/adapters/personality-adapter.ts`

```typescript
// 현재 사용 중
- getTraitScoresFromAnswers(): 답변 → 점수 매핑
- getRecommendedMaterialsFromDB(): 성향 점수 → 자재 추천
```

**특징:**
- ✅ personality_traits, personality_materials 사용
- ✅ answer_score_mapping 사용
- ❌ 평형/연식/가족/연령 DB 미사용
- ❌ 경고 템플릿 미사용

### 4.2 규칙서 제안 DB 쿼리

```typescript
// 규칙서 제안 함수들
- getPyeongCharacteristics(pyeong): 평형별 특성
- getBuildingAgeRisks(age): 연식별 위험
- getAgePreferences(age_group): 연령별 선호
- getFamilyNeeds(family_types): 가족 니즈
- getBudgetBenchmark(pyeong, budget_max): 예산 기준
- getWarnings(triggered_risks): 경고 문구
- getMaterialRecommendations(personality_codes, category): 자재 추천
```

**특징:**
- ✅ 상세 정보 DB 활용
- ✅ 템플릿 시스템
- ✅ 연구 기반 데이터
- ❌ 현재 시스템에 없음

### 4.3 통합 방안

**Phase 1: 즉시 도입 (DB 쿼리 함수 추가)**

```typescript
// lib/db/adapters/pyeong-adapter.ts (신규)
export async function getPyeongCharacteristics(pyeong: number) {
  const pyeong_range = convertPyeongToRange(pyeong);
  const { data } = await supabase
    .from('pyeong_characteristics')
    .select('*')
    .eq('pyeong_range', pyeong_range)
    .single();
  return data;
}

// lib/db/adapters/building-adapter.ts (신규)
export async function getBuildingAgeRisks(age: number) {
  const age_range = convertAgeToRange(age);
  const { data } = await supabase
    .from('building_age_risks')
    .select('*')
    .eq('age_range', age_range)
    .order('priority', { ascending: true });
  return data;
}

// lib/db/adapters/family-adapter.ts (신규)
export async function getFamilyNeeds(familyTypes: string[]) {
  const typeMap = { ... };
  const familyNames = familyTypes.map(t => typeMap[t]).filter(Boolean);
  const { data } = await supabase
    .from('family_needs')
    .select('*')
    .in('family_type', familyNames);
  return data;
}

// lib/db/adapters/warning-adapter.ts (신규)
export async function getWarnings(triggeredRisks: string[]) {
  const { data } = await supabase
    .from('warning_templates')
    .select('*')
    .in('warning_type', triggeredRisks);
  return data;
}
```

**Phase 2: 기존 시스템 확장**

```typescript
// TraitEngine에서 DB 정보 활용
async analyze(input: TraitEngineInput) {
  // 기존 로직
  const indicators = await this.calculateIndicators(input);
  
  // 신규: DB 정보로 보강
  const pyeongInfo = await getPyeongCharacteristics(input.spaceInfo.pyeong);
  const ageRisks = await getBuildingAgeRisks(input.spaceInfo.buildingAge);
  const familyNeeds = await getFamilyNeeds(input.spaceInfo.familyTypes);
  
  // DB 정보 반영
  if (pyeongInfo?.pain_points) {
    // 평형별 불편 요소 반영
  }
  if (ageRisks?.length > 0) {
    // 연식별 위험 반영
  }
  if (familyNeeds?.length > 0) {
    // 가족 니즈 반영
  }
  
  return { indicators, pyeongInfo, ageRisks, familyNeeds };
}
```

---

## 5. 맥락 변환 및 AI 프롬프트 비교

### 5.1 현재 시스템 AI 프롬프트

**파일**: `app/api/analyze/complete/route.ts` - buildAnalysisPrompt()

```typescript
function buildAnalysisPrompt(data: CompleteAnalysisRequest): string {
  // V3.1 설계서 기반 프롬프트
  // Trait → Needs → Resolution → Action 구조
  // 고객 정보 요약
  // 분석 지시사항
}
```

**특징:**
- ✅ V3.1 설계서 준수
- ✅ 단계적 사고 구조
- ✅ 고객 맞춤 분석 강조
- ⚠️ DB 정보 활용 제한적
- ⚠️ 경고 시스템 제한적

### 5.2 규칙서 제안 맥락 변환

```typescript
// 규칙서: 분류 결과 + DB 데이터 → 맥락 문장
function generateContext(
  input: AllInputs,
  classifications: AllClassifications,
  dbData: AllDBData
): AnalysisContext {
  return {
    basic_summary: "...",
    lifestyle_summary: "...",
    problem_summary: "...",
    risk_summary: "...",
    decision_summary: "...",
    budget_summary: "...",
    pyeong_insights: "...", // DB에서 가져온 평형 인사이트
    age_insights: "...", // DB에서 가져온 연식 인사이트
    family_insights: "...", // DB에서 가져온 가족 인사이트
    warnings: [...], // DB에서 가져온 경고
    question_directions: [...] // 맞춤 질문 방향
  };
}

function generateSystemPrompt(context: AnalysisContext): string {
  // 맥락 기반 시스템 프롬프트
  // 연구 데이터 기반 경고 포함
  // 맞춤 질문 방향 포함
}
```

**특징:**
- ✅ DB 정보 기반 상세 맥락
- ✅ 연구 데이터 기반 경고
- ✅ 맞춤 질문 방향 생성
- ✅ 견적 연동 파라미터 생성
- ❌ 현재 시스템과 구조 다름

### 5.3 통합 방안

**현재 프롬프트 확장:**

```typescript
function buildEnhancedAnalysisPrompt(
  data: CompleteAnalysisRequest,
  classifications: AllClassifications,
  dbData: AllDBData
): string {
  // 기존 프롬프트
  let prompt = buildAnalysisPrompt(data);
  
  // 신규: DB 정보 추가
  prompt += `\n\n## 📊 상세 정보 (DB 기반)\n\n`;
  
  // 평형 인사이트
  if (dbData.pyeong) {
    prompt += `### 평형별 특성 (${dbData.pyeong.pyeong_range}평)\n`;
    prompt += `- 일반 구조: ${dbData.pyeong.common_layout}\n`;
    prompt += `- 흔한 불편: ${JSON.parse(dbData.pyeong.pain_points).join(', ')}\n`;
    prompt += `- 리모델링 우선순위: ${JSON.parse(dbData.pyeong.reno_priorities)[0]}\n\n`;
  }
  
  // 연식 인사이트
  if (dbData.ageRisks?.length > 0) {
    const topRisk = dbData.ageRisks.find(r => r.priority === 1);
    prompt += `### 연식별 주의사항 (${data.spaceInfo.buildingAge}년차)\n`;
    prompt += `- 1순위 점검: ${topRisk.risk_category}\n`;
    prompt += `- 항목: ${topRisk.risk_items.join(', ')}\n`;
    prompt += `- 추가비용 예상: ${topRisk.cost_impact}\n`;
    if (topRisk.warning_text) {
      prompt += `- 경고: ${topRisk.warning_text}\n`;
    }
    prompt += `\n`;
  }
  
  // 가족 인사이트
  if (dbData.familyNeeds?.length > 0) {
    prompt += `### 가족 구성 고려사항\n`;
    dbData.familyNeeds.forEach(need => {
      prompt += `- ${need.family_type}: 위험요소(${need.danger_items.join(', ')}), 필수항목(${need.required_items.join(', ')})\n`;
    });
    prompt += `\n`;
  }
  
  // 경고 사항
  if (dbData.warnings?.length > 0) {
    prompt += `### ⚠️ 경고 사항\n`;
    dbData.warnings.forEach((w, i) => {
      prompt += `${i + 1}. [${w.severity}] ${w.template_ko}\n`;
      if (w.suggestion_ko) {
        prompt += `   → ${w.suggestion_ko}\n`;
      }
    });
    prompt += `\n`;
  }
  
  // 문제유형 분석
  if (classifications.problem) {
    prompt += `### 문제유형 분석\n`;
    prompt += `- 입지형 불편: ${Math.round(classifications.problem.location_score * 100)}%\n`;
    prompt += `- 공간형 불편: ${Math.round(classifications.problem.space_score * 100)}%\n`;
    prompt += `- 권장: ${classifications.problem.recommendation === 'move' ? '이사 검토' : '리모델링'}\n`;
    prompt += `- 메시지: ${classifications.problem.message}\n\n`;
  }
  
  // 후회위험 평가
  if (classifications.risk) {
    prompt += `### 후회위험 평가\n`;
    prompt += `- 위험도: ${classifications.risk.risk_level}\n`;
    prompt += `- 예비비 권장: ${classifications.risk.buffer_percentage}%\n`;
    prompt += `- 주의 항목: ${classifications.risk.triggered_risks.join(', ')}\n\n`;
  }
  
  return prompt;
}
```

---

## 6. 실행 흐름 비교

### 6.1 현재 시스템 실행 흐름

```
[사용자 입력]
    ↓
[CompleteAnalysisRequest]
    ↓
[V3Engine.analyze()]
    ├── TraitEngine: 답변 → 점수
    ├── NeedsEngine: 점수 → Needs
    ├── ProcessEngine: Needs → 공정
    ├── InterventionEngine: 공정 축소
    ├── RiskEngine: 리스크 탐지
    └── ExplanationEngine: 설명 생성
    ↓
[AI 프롬프트 생성]
    ↓
[OpenAI API 호출]
    ↓
[분석 결과 반환]
```

### 6.2 규칙서 제안 실행 흐름

```
[사용자 입력]
    ↓
[입력 파싱]
    ├── BasicInfo
    ├── LifestyleInput
    ├── PainPoints
    └── DecisionStyle
    ↓
[분류 엔진]
    ├── 생활유형 분류
    ├── 가족유형 분류
    ├── 문제유형 분류
    ├── 후회위험 평가
    ├── 결정구조 분류
    └── 예산유연성 분류
    ↓
[DB 쿼리 (병렬)]
    ├── 평형 특성
    ├── 연식 위험
    ├── 연령 선호
    ├── 가족 니즈
    ├── 예산 기준
    ├── 경고 문구
    └── 자재 추천
    ↓
[맥락 변환]
    ↓
[AI 프롬프트 생성]
    ↓
[OpenAI API 호출]
    ↓
[맞춤 질문/추천/경고 생성]
```

### 6.3 통합 실행 흐름 (권장)

```
[사용자 입력]
    ↓
[CompleteAnalysisRequest]
    ↓
[입력 변환]
    ├── 현재 입력 → 규칙서 입력 변환
    └── 규칙서 분류 엔진 실행
    ↓
[V3Engine.analyze() + 규칙서 분류]
    ├── TraitEngine: 답변 → 점수 (기존)
    ├── 규칙서 분류: 타입 분류 (신규)
    ├── DB 쿼리: 상세 정보 조회 (신규)
    ├── NeedsEngine: 점수 → Needs (기존)
    ├── ProcessEngine: Needs → 공정 (기존)
    ├── RiskEngine: 리스크 + 경고 템플릿 (확장)
    └── ExplanationEngine: 설명 생성 (확장)
    ↓
[통합 맥락 생성]
    ├── 점수 기반 분석 (기존)
    ├── 타입 기반 분류 (신규)
    ├── DB 정보 인사이트 (신규)
    └── 경고 및 제안 (신규)
    ↓
[AI 프롬프트 생성 (확장)]
    ↓
[OpenAI API 호출]
    ↓
[통합 분석 결과 반환]
```

---

## 7. 통합 구현 방안

### 7.1 Phase 1: DB 테이블 생성 및 쿼리 함수 추가

**우선순위: 높음, 리스크: 낮음**

1. **DB 테이블 생성**
   - `pyeong_characteristics`
   - `building_age_risks`
   - `family_needs`
   - `age_preferences`
   - `budget_benchmarks`
   - `warning_templates`
   - `risk_factors`

2. **쿼리 함수 추가**
   - `lib/db/adapters/pyeong-adapter.ts`
   - `lib/db/adapters/building-adapter.ts`
   - `lib/db/adapters/family-adapter.ts`
   - `lib/db/adapters/warning-adapter.ts`

3. **기존 시스템 확장**
   - TraitEngine에서 DB 정보 조회 추가
   - RiskEngine에 경고 템플릿 연동

### 7.2 Phase 2: 분류 엔진 통합

**우선순위: 중간, 리스크: 중간**

1. **분류 함수 구현**
   - `lib/analysis/classification/lifestyle-classifier.ts`
   - `lib/analysis/classification/family-classifier.ts`
   - `lib/analysis/classification/problem-classifier.ts`
   - `lib/analysis/classification/risk-assessor.ts`
   - `lib/analysis/classification/decision-classifier.ts`
   - `lib/analysis/classification/budget-classifier.ts`

2. **입력 변환 함수**
   - `lib/analysis/classification/input-converter.ts`

3. **V3Engine 확장**
   - 분류 결과를 V3Engine에 통합
   - 점수 + 타입 하이브리드 결과 생성

### 7.3 Phase 3: 맥락 변환 및 프롬프트 확장

**우선순위: 중간, 리스크: 낮음**

1. **맥락 생성 함수**
   - `lib/analysis/context/context-generator.ts`

2. **프롬프트 확장**
   - `app/api/analyze/complete/route.ts` 수정
   - DB 정보 기반 상세 맥락 추가

3. **견적 연동**
   - `lib/analysis/classification/quote-parameter-generator.ts`

### 7.4 Phase 4: UI 확장 (선택사항)

**우선순위: 낮음, 리스크: 낮음**

1. **입력 UI 확장**
   - PainPoints 입력 화면
   - DecisionStyle 입력 화면

2. **결과 표시 확장**
   - 타입 분류 표시
   - 문제유형 분석 표시
   - 경고 사항 강조

---

## 8. 구체적 마이그레이션 계획

### 8.1 Week 1: DB 및 쿼리 함수

**목표**: DB 테이블 생성 및 기본 쿼리 함수 구현

**작업:**
1. Supabase SQL Editor에서 테이블 생성
2. 초기 데이터 INSERT
3. 쿼리 함수 구현 (adapter 파일들)
4. 단위 테스트

**체크리스트:**
- [ ] pyeong_characteristics 테이블 생성
- [ ] building_age_risks 테이블 생성
- [ ] family_needs 테이블 생성
- [ ] age_preferences 테이블 생성
- [ ] budget_benchmarks 테이블 생성
- [ ] warning_templates 테이블 생성
- [ ] risk_factors 테이블 생성
- [ ] 쿼리 함수 구현 및 테스트

### 8.2 Week 2: 분류 엔진 구현

**목표**: 규칙서 분류 엔진 구현 및 통합

**작업:**
1. 분류 함수 구현
2. 입력 변환 함수 구현
3. V3Engine에 통합
4. 통합 테스트

**체크리스트:**
- [ ] classifyLifestyle 구현
- [ ] classifyFamily 구현
- [ ] classifyProblem 구현
- [ ] assessRisk 구현
- [ ] classifyDecision 구현
- [ ] classifyBudget 구현
- [ ] 입력 변환 함수 구현
- [ ] V3Engine 통합
- [ ] 통합 테스트

### 8.3 Week 3: 맥락 변환 및 프롬프트 확장

**목표**: DB 정보 기반 맥락 생성 및 프롬프트 확장

**작업:**
1. 맥락 생성 함수 구현
2. 프롬프트 확장
3. 경고 시스템 연동
4. E2E 테스트

**체크리스트:**
- [ ] context-generator.ts 구현
- [ ] 프롬프트 확장 함수 구현
- [ ] RiskEngine에 경고 템플릿 연동
- [ ] E2E 테스트
- [ ] 성능 테스트

### 8.4 Week 4: 최적화 및 문서화

**목표**: 성능 최적화 및 문서화

**작업:**
1. DB 쿼리 최적화 (캐싱)
2. 코드 리팩토링
3. 문서화
4. 사용자 가이드 작성

**체크리스트:**
- [ ] 캐싱 구현 (Redis 또는 메모리)
- [ ] 코드 리팩토링
- [ ] API 문서화
- [ ] 사용자 가이드 작성

---

## 9. 예상 효과

### 9.1 정량적 효과

- **분석 정확도**: +20% (DB 정보 기반 상세 분석)
- **경고 정확도**: +30% (연구 기반 위험 데이터)
- **견적 정확도**: +15% (평형별 예산 기준)
- **사용자 만족도**: +25% (맞춤 질문 및 경고)

### 9.2 정성적 효과

- **직관성 향상**: 타입 분류로 이해하기 쉬움
- **신뢰도 향상**: 연구 기반 데이터 활용
- **확장성 향상**: DB 기반 템플릿 시스템
- **유지보수성 향상**: 하드코딩 감소

---

## 10. 결론

규칙서와 DB 설계서는 현재 인테리봇 시스템을 **크게 보완할 수 있는 구조**를 제시합니다. 특히:

1. **DB 기반 상세 정보**: 평형/연식/가족/연령 정보는 즉시 도입 가치 높음
2. **타입 기반 분류**: 점수 시스템과 병행하여 직관성 향상
3. **연구 기반 위험 평가**: 후회위험 평가로 예비비 계산 정확도 향상
4. **템플릿 시스템**: 경고 문구를 DB화하여 확장성 향상

**핵심 권장사항:**
- ✅ 하이브리드 접근: 점수 시스템 유지 + 타입 분류 추가
- ✅ 점진적 통합: Phase별로 단계적 도입
- ✅ 기존 시스템 안정성 유지: 새 기능을 보조 정보로 활용

---

**작성 완료일**: 2025년 12월 16일  
**다음 단계**: Phase 1 DB 테이블 생성 및 쿼리 함수 구현












