# 집중 기준 선언 규칙 명세서 분석 리포트

**작성일**: 2024-12-XX  
**분석 대상**: 성향 분석 결과 화면 – 집중 기준 선언 규칙 명세서  
**현재 구현 파일**: `app/onboarding/ai-recommendation/page.tsx`

---

## 📋 명세서 핵심 요구사항 요약

### 1. 목적
- 화면 역할: **"설명"이 아니라 "결정 정리"**
- 고객이 가져가야 할 것: **"이 집은 어떤 기준으로 이미 결정되었는가"**

### 2. 핵심 원칙 (절대 규칙)

#### 2-1. 집중 기준은 항상 1개만 선언
- 복합 성향이어도 선언 문장은 단일 기준만 허용
- 병렬 기준 선언 금지 (예: "수납+안전", "편의+분위기")

#### 2-2. 선언 문장은 '결정 완료형'으로만 작성
- ❌ 금지: "분석 중", "추천 중", "제안 중"
- ✅ 허용: "이미 정리됐다"는 느낌
- ✅ 허용 예시: "이 집은 ○○을 기준으로 결정했습니다."

#### 2-3. 감정·추상 표현 전면 금지
- ❌ 금지 단어: 안심, 편안, 따뜻, 만족, 안정감, 쾌적, 라이프스타일, 무드, 감성
- ✅ 허용: 행동 기준 + 물리적 결과만 (동선, 위험 요소, 유지관리, 청소, 수납 방식 등)

#### 2-4. 선언 문장은 화면 내 최상위 법칙
- 선언된 기준이 모든 하위 문구를 지배
- 중간에 다른 기준이 등장하면 오류

### 3. 집중 기준 선언 문장 템플릿

**기본 템플릿 (필수 사용)**:
```
이 집은 [집중 기준]을 최우선으로 결정했습니다.
```

**집중 기준 작성 규칙**:
- 명사형 또는 행동 기준만 허용
- 형용사 금지
- 쉼표 금지
- 두 문장 이상 금지

### 4. 허용되는 집중 기준 유형 예시
- 아이 안전
- 정리 스트레스 최소화
- 유지관리 부담 최소화
- 공간 활용 효율
- 공사 범위 최소화
- 예산 통제 우선
- 동선 단순화

❌ **선언 불가**: "고급", "분위기", "트렌드" 계열

### 5. 복합 성향 처리 규칙
- 선언 문장: 단일 기준만
- 보조 기준: 선언 직후 1문장만 허용
  - 형식: "이 기준에 따라, [보조 요소]는 [제한된 방식]으로 반영됩니다."

---

## 🔍 현재 구현 상태 분석

### 현재 상단 헤더 (521-528줄)
```tsx
<h1 className="text-2xl font-bold text-gray-900 mb-2">
  이번 조건에서는<br />
  {getFocusedCategory(analysisResult)} 외 공정은<br />
  검토하지 않도록 정리했습니다.
</h1>
<p className="text-sm text-gray-500">
  구조·설비 공사는 이번 분석에서 제외되었습니다.
</p>
```

### 현재 V3 분석 카드 (557-564줄)
```tsx
<h2 className="text-2xl font-bold mb-3">
  {spaceInfo?.pyeong || 0}평 · {spaceInfo?.totalPeople || spaceInfo?.familySizeRange || 'N'}가구 기준<br />
  '{getFocusedCategory(analysisResult)}만 집중' 판단 결과입니다.
</h2>
<p className="text-lg leading-relaxed text-white/95">
  이번 분석은 생활 불편 요소 중<br />
  {getFocusedCategory(analysisResult)} 문제만 해결하도록 범위를 제한했습니다.
</p>
```

### 현재 getFocusedCategory() 함수 (42-62줄)
```typescript
function getFocusedCategory(result: V31AnalysisResult): string {
  // needs에서 level === 'high'인 것 중 가장 우선순위 높은 것
  const highNeeds = result.needs?.filter(n => n.level === 'high') || []
  if (highNeeds.length > 0) {
    const topNeed = highNeeds.sort((a, b) => b.priority - a.priority)[0]
    return topNeed.name || '수납'
  }
  // fallback: processes에서 가장 많이 언급된 카테고리
  // ...
  return '수납'
}
```

---

## ⚠️ 명세서 요구사항 vs 현재 구현 비교

### ✅ 잘 구현된 부분

1. **단일 기준 선언**: `getFocusedCategory()`가 1개만 반환
2. **결정 완료형 톤**: "정리했습니다", "제한했습니다" 사용
3. **금지 표현 제거**: "추천", "권장", "제안" 제거 완료

### ❌ 명세서와 불일치하는 부분

#### 1. **집중 기준 선언 문장 템플릿 미사용**
- **명세서 요구**: `"이 집은 [집중 기준]을 최우선으로 결정했습니다."`
- **현재 구현**: `"이번 조건에서는 {집중 카테고리} 외 공정은 검토하지 않도록 정리했습니다."`
- **문제점**: 
  - 명세서의 필수 템플릿을 사용하지 않음
  - "이 집은"이 아닌 "이번 조건에서는"으로 시작
  - "최우선으로 결정했습니다"가 아닌 "검토하지 않도록 정리했습니다"

#### 2. **집중 기준 변환 로직 필요**
- **현재**: `getFocusedCategory()`가 `needs.name`을 그대로 반환 (예: "수납 강화", "안전성 강화")
- **명세서 요구**: 허용 기준 유형으로 변환 필요
  - 예: "수납 강화" → "정리 스트레스 최소화" 또는 "공간 활용 효율"
  - 예: "안전성 강화" → "아이 안전"
- **문제점**: `needs.name`이 명세서의 허용 기준 형식과 다를 수 있음

#### 3. **보조 기준 문장 누락**
- **명세서 요구**: 복합 성향일 때 "이 기준에 따라, [보조 요소]는 [제한된 방식]으로 반영됩니다." 문장 추가
- **현재 구현**: 보조 기준 문장 없음

#### 4. **감정·추상 표현 검증 필요**
- **명세서 요구**: 감정 단어(안심, 편안, 따뜻 등) 전면 금지
- **현재 구현**: `getFocusedCategory()` 반환값에 감정 단어가 포함될 수 있음
- **필요 작업**: 반환값 검증 및 변환 로직 추가

---

## 🔧 수정 필요 사항

### 1. 집중 기준 선언 문장 템플릿 적용

**현재**:
```tsx
<h1>
  이번 조건에서는<br />
  {getFocusedCategory(analysisResult)} 외 공정은<br />
  검토하지 않도록 정리했습니다.
</h1>
```

**명세서 요구**:
```tsx
<h1>
  이 집은 {getFocusedCriteria(analysisResult)}을 최우선으로 결정했습니다.
</h1>
```

### 2. 집중 기준 변환 함수 추가

**새로운 함수 필요**:
```typescript
function getFocusedCriteria(result: V31AnalysisResult): string {
  const category = getFocusedCategory(result)
  
  // needs.name을 명세서 허용 기준으로 변환
  const criteriaMap: Record<string, string> = {
    '수납 강화': '정리 스트레스 최소화',
    '안전성 강화': '아이 안전',
    '유지관리': '유지관리 부담 최소화',
    '공간 활용': '공간 활용 효율',
    '예산 통제': '예산 통제 우선',
    '동선 최적화': '동선 단순화',
    // ... 추가 매핑
  }
  
  // 감정 단어 검증 및 제거
  // 형용사 제거
  // 명사형/행동 기준으로 변환
  
  return criteriaMap[category] || category
}
```

### 3. 보조 기준 문장 추가 (복합 성향일 때)

**추가 필요**:
```tsx
{hasMultipleHighNeeds(analysisResult) && (
  <p className="text-sm text-gray-600 mt-2">
    이 기준에 따라, {getSecondaryCriteria(analysisResult)}는<br />
    {getLimitedReflection(analysisResult)}으로 반영됩니다.
  </p>
)}
```

### 4. 감정·추상 표현 필터링

**필터링 로직 추가**:
```typescript
const FORBIDDEN_WORDS = [
  '안심', '편안', '따뜻', '만족', '안정감', '쾌적',
  '라이프스타일', '무드', '감성', '고급', '분위기', '트렌드'
]

function sanitizeCriteria(criteria: string): string {
  // 금지 단어 제거
  // 형용사 제거
  // 명사형/행동 기준으로 변환
  return sanitized
}
```

---

## 📊 실패 판정 기준 체크리스트

명세서의 실패 판정 기준에 따라 현재 구현 검증:

| 기준 | 현재 상태 | 판정 |
|------|----------|------|
| 선언 문장을 읽고 "왜?"라는 질문이 먼저 든다 | ❌ | **실패** - 템플릿 미사용 |
| 기준이 2개 이상으로 해석된다 | ✅ | 통과 - 단일 기준 반환 |
| 감정 단어가 들어간다 | ⚠️ | **위험** - 검증 로직 없음 |
| 이후 문장에서 다른 기준이 튀어나온다 | ✅ | 통과 - 일관성 유지 |
| '추천', '제안' 같은 미결정 표현이 나온다 | ✅ | 통과 - 제거 완료 |

**결론**: **명세서 요구사항과 부분적으로 불일치**. 집중 기준 선언 문장 템플릿 적용 및 기준 변환 로직 추가 필요.

---

## 🎯 다음 단계 제안

### Phase 1: 집중 기준 변환 로직 구현
1. `getFocusedCriteria()` 함수 추가
2. `needs.name` → 명세서 허용 기준 매핑 테이블 생성
3. 감정 단어 필터링 로직 추가

### Phase 2: 선언 문장 템플릿 적용
1. 상단 헤더를 명세서 템플릿으로 교체
2. 보조 기준 문장 추가 (복합 성향일 때)

### Phase 3: 검증 및 테스트
1. 다양한 `needs` 조합으로 테스트
2. 감정 단어 포함 케이스 테스트
3. 복합 성향 케이스 테스트

---

## 📝 참고사항

- 이 명세서는 **문구 규칙**만 다룸 (로직, 계산, LOCK 구조는 변경 없음)
- 다음 명세서 연결 포인트:
  - '남은 선택' 문구 규칙 명세서
  - 집중 기준별 공정 설명 문장 매핑 명세서
  - 기존 화면 문장 폐기/수정 리스트 명세서












