# 인테리봇 성향분석 로직 설계안 (3가지)

## 📋 목차

1. [개요](#개요)
2. [설계안 1: 다차원 프로파일링 엔진](#설계안-1-다차원-프로파일링-엔진)
3. [설계안 2: 행동 패턴 기반 추론 엔진](#설계안-2-행동-패턴-기반-추론-엔진)
4. [설계안 3: 맥락 인식 하이브리드 엔진](#설계안-3-맥락-인식-하이브리드-엔진)
5. [비교 분석표](#비교-분석표)
6. [구현 우선순위](#구현-우선순위)

---

## 개요

인테리봇 V5 Ultimate 시스템의 성향분석 로직을 개선하기 위한 3가지 설계안을 제시합니다.

### 현재 시스템의 한계점

1. **단순 점수 합산**: 태그 기반 단순 점수 계산으로 정확도 한계
2. **맥락 무시**: 입력 데이터 간의 관계와 맥락을 고려하지 않음
3. **설명 부족**: "왜 이 DNA인가"에 대한 명확한 근거 부재
4. **확장성 부족**: 새로운 성향 추가 시 로직 수정 필요

### 설계 목표

- ✅ **정확도 향상**: 고객 만족도 90% 이상
- ✅ **설명 가능성**: DNA 결정 근거 명확히 제시
- ✅ **확장성**: 새로운 성향/패턴 추가 용이
- ✅ **맥락 인식**: 모든 입력 데이터를 통합적으로 고려

---

## 설계안 1: 다차원 프로파일링 엔진

### 핵심 개념

고객을 **5개 차원**에서 프로파일링하고, 각 차원의 가중치를 적용하여 DNA 타입을 결정합니다.

### 아키텍처 다이어그램

```
┌─────────────────────────────────────────────────┐
│              입력 데이터                        │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐    │
│  │ 사진 분석 │  │ 대화 분석 │  │ 집 정보  │    │
│  └──────────┘  └──────────┘  └──────────┘    │
└─────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────┐
│        5개 차원 프로파일러                       │
│  ┌─────────────────────────────────────────┐   │
│  │ 1. 라이프스타일 차원 (40% 가중치)       │   │
│  │    - 가족 구성 영향도                    │   │
│  │    - 일상 패턴                          │   │
│  │    - 사교 패턴                          │   │
│  │    - 관리 스타일                        │   │
│  └─────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────┐   │
│  │ 2. 공간 활용 차원 (25% 가중치)          │   │
│  │    - 공간 효율                          │   │
│  │    - 정리 수준                          │   │
│  │    - 수납 필요도                        │   │
│  │    - 동선 최적화                        │   │
│  └─────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────┐   │
│  │ 3. 미적 선호 차원 (20% 가중치)          │   │
│  │    - 스타일 고집도                      │   │
│  │    - 트렌드 민감도                      │   │
│  │    - 색상 선호                          │   │
│  │    - 자재 취향                          │   │
│  └─────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────┐   │
│  │ 4. 실용성 차원 (10% 가중치)              │   │
│  │    - 내구성 중시                        │   │
│  │    - 관리 편의                          │   │
│  │    - 가성비                             │   │
│  │    - 기능성                             │   │
│  └─────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────┐   │
│  │ 5. 투자 가치 차원 (5% 가중치)           │   │
│  │    - 매도 고려                          │   │
│  │    - 장기 가치                          │   │
│  │    - 시장 트렌드                        │   │
│  │    - 주거형태                           │   │
│  └─────────────────────────────────────────┘   │
└─────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────┐
│         차원별 점수 계산                         │
│  각 DNA 타입별로 5개 차원 점수 계산              │
└─────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────┐
│         가중 평균 + 상관관계 보정                │
│  - 가중 평균 계산                                │
│  - 상관관계 규칙 적용 (예: 수납+가족 → bear/fox)│
└─────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────┐
│         DNA 타입 결정 + 신뢰도 계산               │
│  - 최고 점수 DNA 선택                            │
│  - 차원별 매칭 이유 생성                         │
└─────────────────────────────────────────────────┘
```

### 데이터 구조

#### DimensionProfile (차원 프로파일)

```typescript
interface DimensionProfile {
  lifestyle: {
    score: number;        // 0-100
    factors: {
      familyStructure: number;    // 가족 구성 영향도 (0-100)
      dailyRoutine: number;       // 일상 패턴 (0-100)
      socialPattern: number;       // 사교 패턴 (0-100)
      maintenanceStyle: number;    // 관리 스타일 (0-100)
    };
    confidence: number;    // 0.0-1.0
  };
  spaceUtilization: {
    score: number;
    factors: {
      efficiency: number;          // 공간 효율 (0-100)
      organization: number;         // 정리 수준 (0-100)
      storageNeed: number;          // 수납 필요도 (0-100)
      flowOptimization: number;     // 동선 최적화 (0-100)
    };
    confidence: number;
  };
  aestheticPreference: {
    score: number;
    factors: {
      styleCommitment: number;     // 스타일 고집도 (0-100)
      trendSensitivity: number;     // 트렌드 민감도 (0-100)
      colorPreference: number;      // 색상 선호 (0-100)
      materialTaste: number;         // 자재 취향 (0-100)
    };
    confidence: number;
  };
  practicality: {
    score: number;
    factors: {
      durability: number;           // 내구성 중시 (0-100)
      maintenanceEase: number;      // 관리 편의 (0-100)
      costEfficiency: number;       // 가성비 (0-100)
      functionality: number;        // 기능성 (0-100)
    };
    confidence: number;
  };
  investmentValue: {
    score: number;
    factors: {
      resaleConsideration: number;  // 매도 고려 (0-100)
      longTermValue: number;        // 장기 가치 (0-100)
      marketTrend: number;          // 시장 트렌드 (0-100)
      propertyType: number;         // 주거형태 (0-100)
    };
    confidence: number;
  };
}
```

#### DNACandidate (DNA 후보)

```typescript
interface DNACandidate {
  type: DNAType;
  dimensionScores: {
    lifestyle: number;           // 라이프스타일 차원 점수
    spaceUtilization: number;    // 공간 활용 차원 점수
    aestheticPreference: number; // 미적 선호 차원 점수
    practicality: number;       // 실용성 차원 점수
    investmentValue: number;     // 투자 가치 차원 점수
  };
  weightedScore: number;        // 가중 평균 점수
  matchReasons: string[];       // 매칭 이유 배열
  confidence: number;            // 신뢰도 (0.0-1.0)
}
```

### 분석표 설계

#### 차원별 점수 계산표

| 차원 | 가중치 | 하위 요소 | 계산 방식 | 데이터 소스 |
|------|--------|----------|----------|------------|
| 라이프스타일 | 40% | 가족 구성 영향도 | `familyInfo.totalMembers > 3 ? 80 : 50` | chatAnalysis.familyInfo |
| | | 일상 패턴 | `cleaningStyle === 'diligent' ? 70 : 50` | chatAnalysis.cleaningStyle |
| | | 사교 패턴 | `GUEST_FREQUENT 태그 ? 80 : 30` | tags |
| | | 관리 스타일 | `CLEANING_SYSTEM_NEED 태그 ? 90 : 50` | tags |
| 공간 활용 | 25% | 공간 효율 | `pyeong < 20 ? 90 : 50` | spaceInfo.pyeong |
| | | 정리 수준 | `organizationScore * 10` | photoAnalysis.organizationScore |
| | | 수납 필요도 | `STORAGE_NEED 태그 ? 85 : 40` | tags |
| | | 동선 최적화 | `SPACE_EFFICIENT 태그 ? 75 : 50` | tags |
| 미적 선호 | 20% | 스타일 고집도 | `styleTag 선택 ? 80 : 50` | moodResult.styleTag |
| | | 트렌드 민감도 | `MODERN_LOVER 태그 ? 70 : 40` | tags |
| | | 색상 선호 | `colorPalette.length > 2 ? 60 : 40` | photoAnalysis.colorPalette |
| | | 자재 취향 | `VINTAGE_LOVER 태그 ? 75 : 50` | tags |
| 실용성 | 10% | 내구성 중시 | `VALUE_PROTECTION 태그 ? 85 : 50` | tags |
| | | 관리 편의 | `CLEANING_SYSTEM_NEED 태그 ? 80 : 50` | tags |
| | | 가성비 | `BUDGET_STRICT 태그 ? 90 : 50` | tags |
| | | 기능성 | `STORAGE_NEED 태그 ? 75 : 50` | tags |
| 투자 가치 | 5% | 매도 고려 | `purpose === 'sell' ? 80 : 30` | spaceInfo.purpose |
| | | 장기 가치 | `housingType === '아파트' ? 70 : 40` | spaceInfo.housingType |
| | | 시장 트렌드 | `pyeong >= 24 && pyeong <= 34 ? 75 : 50` | spaceInfo.pyeong |
| | | 주거형태 | `아파트: 70, 오피스텔: 60, 빌라: 40` | spaceInfo.housingType |

#### DNA 타입별 차원 점수 매핑표

| DNA 타입 | 라이프스타일 | 공간 활용 | 미적 선호 | 실용성 | 투자 가치 | 주요 특성 |
|----------|------------|----------|----------|--------|----------|----------|
| 🦊 Fox | 60 | **90** | 50 | **85** | 60 | 수납 중시, 효율 극대화 |
| 🦁 Lion | 50 | 40 | **95** | 40 | 50 | 스타일 고집, 개성 강함 |
| 🐻 Bear | **90** | 60 | 60 | 70 | 60 | 가족 중심, 편안함 |
| 🦉 Owl | 40 | 50 | 50 | 60 | 50 | 독립 공간, 조용함 |
| 🐬 Dolphin | **85** | 50 | 60 | 50 | 50 | 사교형, 손님 맞이 |
| 🦢 Swan | 50 | 70 | **90** | 60 | 70 | 미니멀, 우아함 |
| 🐝 Bee | 60 | **85** | 50 | **90** | 60 | 청소 시스템, 자동화 |
| 🦋 Butterfly | 50 | 40 | **85** | 40 | 40 | 트렌드세터, 변화 즐김 |
| 🐢 Turtle | 60 | 50 | 50 | **90** | **85** | 내구성, 집값 방어 |
| 🐰 Rabbit | 60 | 50 | **80** | 50 | 50 | 소품 사랑, 디테일 |
| 🦅 Eagle | 50 | **85** | 60 | 60 | 60 | 오픈 플로어, 동선 중시 |
| 🐺 Wolf | 40 | 50 | 50 | 60 | 50 | 프라이버시, 방음 |

**굵은 숫자**: 해당 DNA 타입의 강점 차원

#### 상관관계 보정 규칙표

| 조건 1 | 조건 2 | 보정 대상 | 보정 점수 | 이유 |
|--------|--------|----------|----------|------|
| 수납 필요도 > 70 | 가족 구성 > 60 | Bear, Fox | +15, +10 | 가족 + 수납 → bear/fox 강화 |
| 청소 시스템 필요 | 효율 중시 | Bee | +20 | 시스템 + 효율 → bee 강화 |
| 스타일 고집 > 70 | 트렌드 민감 > 60 | Lion, Butterfly | +15, +10 | 고집 + 트렌드 → lion/butterfly 강화 |
| 작은 공간 (< 20평) | 수납 필요 | Fox | +25 | 작은 공간 → fox 강화 |
| 작은 공간 (< 20평) | 오픈 플로어 선호 | Eagle | -15 | 작은 공간 → eagle 제약 |
| 가족 구성 (3인 이상) | 편안함 중시 | Bear | +20 | 가족 + 편안 → bear 강화 |
| 재택근무 | 독립 공간 필요 | Owl, Wolf | +15, +15 | 재택 → owl/wolf 강화 |

### 계산 공식

#### 차원별 점수 계산

```typescript
// 라이프스타일 차원 점수
lifestyle.score = (
  familyStructure * 0.3 +
  dailyRoutine * 0.3 +
  socialPattern * 0.2 +
  maintenanceStyle * 0.2
);

// 공간 활용 차원 점수
spaceUtilization.score = (
  efficiency * 0.3 +
  organization * 0.3 +
  storageNeed * 0.25 +
  flowOptimization * 0.15
);

// 미적 선호 차원 점수
aestheticPreference.score = (
  styleCommitment * 0.35 +
  trendSensitivity * 0.25 +
  colorPreference * 0.2 +
  materialTaste * 0.2
);

// 실용성 차원 점수
practicality.score = (
  durability * 0.3 +
  maintenanceEase * 0.3 +
  costEfficiency * 0.2 +
  functionality * 0.2
);

// 투자 가치 차원 점수
investmentValue.score = (
  resaleConsideration * 0.3 +
  longTermValue * 0.3 +
  marketTrend * 0.2 +
  propertyType * 0.2
);
```

#### DNA 타입별 가중 점수 계산

```typescript
// 각 DNA 타입별 가중 점수
weightedScore = (
  dimensionScores.lifestyle * 0.4 +
  dimensionScores.spaceUtilization * 0.25 +
  dimensionScores.aestheticPreference * 0.2 +
  dimensionScores.practicality * 0.1 +
  dimensionScores.investmentValue * 0.05
) + correlationCorrection;
```

### 장점

1. ✅ **명확한 설명**: 차원별 분석으로 "왜 이 DNA인가" 설명 가능
2. ✅ **가중치 조정**: 정확도 개선을 위해 가중치 조정 가능
3. ✅ **상관관계 반영**: 예외 케이스도 상관관계 보정으로 처리
4. ✅ **투명성**: 신뢰도 표시로 분석 과정 투명

### 단점

1. ❌ **차원 추가 어려움**: 새로운 차원 추가 시 전체 로직 수정 필요
2. ❌ **가중치 튜닝 필요**: 최적 가중치 찾기 위해 데이터 필요
3. ❌ **복잡도 증가**: 5개 차원 × 12개 DNA = 60개 점수 계산

---

## 설계안 2: 행동 패턴 기반 추론 엔진

### 핵심 개념

명시적 답변보다 **행동 패턴**과 **맥락**을 분석하여 성향을 추론합니다.

### 아키텍처 다이어그램

```
┌─────────────────────────────────────────────────┐
│              입력 데이터                        │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐    │
│  │ 대화 내역 │  │ 사진 분석 │  │ 답변 시간 │    │
│  └──────────┘  └──────────┘  └──────────┘    │
└─────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────┐
│         행동 패턴 추출기                         │
│  ┌─────────────────────────────────────────┐   │
│  │ 대화 패턴 분석                          │   │
│  │  - 직접성 (짧고 명확한 답변)            │   │
│  │  - 상세도 (긴 답변 vs 짧은 답변)       │   │
│  │  - 감정 톤 (긍정/부정 키워드)           │   │
│  │  - 질문 빈도                            │   │
│  │  - 망설임 정도                          │   │
│  └─────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────┐   │
│  │ 선택 패턴 분석                           │   │
│  │  - 일관성 (비슷한 선택 반복)            │   │
│  │  - 위험 감수도 (과감한 선택)             │   │
│  │  - 트렌드 추종도                        │   │
│  │  - 독특함 선호도                        │   │
│  └─────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────┐   │
│  │ 시간 패턴 분석                           │   │
│  │  - 평균 답변 시간                       │   │
│  │  - 답변 시간 분산                        │   │
│  │  - 빠른 결정 vs 신중한 결정             │   │
│  └─────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────┐   │
│  │ 맥락 패턴 분석                           │   │
│  │  - 질문 순서 영향                        │   │
│  │  - 이전 답변과의 연관성                  │   │
│  │  - 맥락 변화 감지                       │   │
│  └─────────────────────────────────────────┘   │
└─────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────┐
│         패턴 매칭 엔진                           │
│  ┌─────────────────────────────────────────┐   │
│  │ 패턴 라이브러리 (100+ 패턴)              │   │
│  │  - 효율 추구자 패턴                      │   │
│  │  - 가족 중심형 패턴                      │   │
│  │  - 스타일 리더 패턴                      │   │
│  │  - 실용주의자 패턴                       │   │
│  │  - ... (더 많은 패턴)                   │   │
│  └─────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────┐   │
│  │ 유사도 계산                               │   │
│  │  - 코사인 유사도                         │   │
│  │  - 유클리드 거리                         │   │
│  │  - 가중 유사도                           │   │
│  └─────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────┐   │
│  │ 패턴 조합 추론                           │   │
│  │  - 다중 패턴 매칭                        │   │
│  │  - 패턴 간 상호작용                      │   │
│  └─────────────────────────────────────────┘   │
└─────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────┐
│         성향 추론                                │
│  ┌─────────────────────────────────────────┐   │
│  │ 주요 성향 (Primary)                      │   │
│  │  - 가장 높은 매칭 점수                   │   │
│  └─────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────┐   │
│  │ 보조 성향 (Secondary)                   │   │
│  │  - 2-3위 매칭 점수                      │   │
│  └─────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────┐   │
│  │ 잠재 성향 (Latent)                      │   │
│  │  - 낮은 점수지만 의미 있는 패턴          │   │
│  └─────────────────────────────────────────┘   │
└─────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────┐
│         DNA 타입 결정                            │
│  - 패턴 친화도 기반 DNA 선택                     │
│  - 추론 근거 생성                                │
└─────────────────────────────────────────────────┘
```

### 데이터 구조

#### BehavioralPattern (행동 패턴)

```typescript
interface BehavioralPattern {
  id: string;                    // 패턴 ID (예: 'PATTERN_001')
  name: string;                   // 패턴 이름 (예: '효율 추구자')
  description: string;            // 패턴 설명
  indicators: {
    chat: string[];              // 대화에서 나타나는 패턴
    photo: string[];              // 사진에서 나타나는 패턴
    choice: string[];              // 선택에서 나타나는 패턴
    timing: string[];             // 시간 패턴
  };
  dnaAffinity: Record<DNAType, number>;  // DNA 타입별 친화도 (0-100)
  confidence: number;              // 패턴 신뢰도 (0.0-1.0)
}
```

#### PatternMatch (패턴 매칭 결과)

```typescript
interface PatternMatch {
  pattern: BehavioralPattern;
  matchScore: number;             // 매칭 점수 (0-100)
  matchedIndicators: string[];    // 매칭된 지표들
  context: string;                // 맥락 설명
}
```

#### InferredTrait (추론된 성향)

```typescript
interface InferredTrait {
  trait: string;                  // 성향 이름
  confidence: number;             // 신뢰도 (0.0-1.0)
  evidence: {
    source: 'chat' | 'photo' | 'behavior' | 'context';
    description: string;           // 증거 설명
    strength: number;              // 증거 강도 (0.0-1.0)
  }[];
}
```

### 분석표 설계

#### 행동 패턴 라이브러리 (주요 패턴 20개)

| 패턴 ID | 패턴 이름 | 설명 | 주요 지표 | DNA 친화도 (상위 3개) |
|---------|----------|------|----------|---------------------|
| PATTERN_001 | 효율 추구자 | 짧고 명확한 답변, 실용적 선택 | 직접성 > 70, 짧은 답변, 빠른 선택 | Fox(90), Bee(80), Turtle(70) |
| PATTERN_002 | 가족 중심형 | 가족 언급, 안전/편안함 강조 | 가족 키워드, 안전 언급, 신중한 선택 | Bear(95), Dolphin(80), Fox(70) |
| PATTERN_003 | 스타일 리더 | 상세한 설명, 독특한 선택, 트렌드 언급 | 긴 답변, 스타일 키워드, 독특함 | Lion(95), Butterfly(85), Rabbit(70) |
| PATTERN_004 | 실용주의자 | 가성비, 내구성, 기능성 중시 | 가성비 키워드, 내구성 언급 | Turtle(90), Fox(80), Bee(75) |
| PATTERN_005 | 미니멀리스트 | 정리됨, 여백, 단순함 선호 | 정리 키워드, 짧은 답변, 단순함 | Swan(95), Owl(70), Fox(60) |
| PATTERN_006 | 사교형 | 손님 언급, 거실 중심, 밝은 분위기 | 손님 키워드, 거실 언급, 밝음 | Dolphin(95), Bear(70), Lion(60) |
| PATTERN_007 | 시스템 구축자 | 자동화, 효율, 청소 시스템 | 자동화 키워드, 시스템 언급 | Bee(95), Fox(80), Eagle(60) |
| PATTERN_008 | 트렌드세터 | 트렌드 언급, 변화 즐김, SNS 감성 | 트렌드 키워드, 변화 언급 | Butterfly(95), Lion(80), Rabbit(70) |
| PATTERN_009 | 독립 추구자 | 프라이버시, 방음, 개인 공간 | 방음 키워드, 개인 공간 언급 | Wolf(95), Owl(85), Eagle(60) |
| PATTERN_010 | 디테일리스트 | 소품 사랑, 컬러풀, 아기자기 | 소품 키워드, 컬러 언급 | Rabbit(95), Butterfly(80), Lion(70) |
| PATTERN_011 | 오픈 플로어 선호 | 시원함, 동선, 구조 변경 | 동선 키워드, 시원함 언급 | Eagle(95), Dolphin(70), Fox(60) |
| PATTERN_012 | 장기 투자자 | 집값 방어, 내구성, 신중함 | 집값 키워드, 신중한 선택 | Turtle(95), Bear(70), Fox(60) |
| PATTERN_013 | 빠른 결정자 | 빠른 답변, 직접적, 명확함 | 빠른 선택, 직접성 > 80 | Fox(85), Bee(80), Eagle(70) |
| PATTERN_014 | 신중한 결정자 | 망설임, 질문 많음, 상세함 | 망설임 키워드, 긴 답변 | Turtle(85), Bear(75), Owl(70) |
| PATTERN_015 | 일관성 추구자 | 비슷한 선택 반복, 일관된 답변 | 일관성 > 70 | Bear(80), Turtle(75), Swan(70) |
| PATTERN_016 | 변화 추구자 | 다양한 선택, 독특함, 트렌드 | 다양성, 독특함 키워드 | Butterfly(90), Lion(80), Rabbit(75) |
| PATTERN_017 | 가성비 추구자 | 예산 언급, 효율, 실용 | 예산 키워드, 효율 언급 | Fox(90), Turtle(85), Bee(80) |
| PATTERN_018 | 프리미엄 추구자 | 고급, 품질, 가격 덜 중요 | 고급 키워드, 품질 언급 | Swan(85), Lion(80), Bear(70) |
| PATTERN_019 | 건강 중시자 | 환기, 조명, 안전 강조 | 건강 키워드, 안전 언급 | Bear(80), Turtle(75), Bee(70) |
| PATTERN_020 | 재택근무형 | 작업 공간, 조용함, 독립성 | 작업 공간 언급, 조용함 | Owl(90), Wolf(85), Eagle(70) |

#### 대화 패턴 분석표

| 지표 | 계산 방식 | 점수 범위 | 해석 |
|------|----------|----------|------|
| 직접성 | `(100 - 평균 답변 길이/10) * 2` | 0-100 | 높을수록 짧고 명확한 답변 |
| 상세도 | `평균 답변 길이 / 5` | 0-100 | 높을수록 상세한 설명 |
| 감정 톤 | 긍정 키워드(+10) - 부정 키워드(-10) | -100~100 | 양수: 긍정적, 음수: 부정적 |
| 질문 빈도 | `질문 개수 / 전체 답변 수 * 100` | 0-100 | 높을수록 질문 많이 함 |
| 망설임 정도 | `망설임 키워드 개수 / 전체 답변 수 * 100` | 0-100 | 높을수록 신중한 결정 |

#### 선택 패턴 분석표

| 지표 | 계산 방식 | 점수 범위 | 해석 |
|------|----------|----------|------|
| 일관성 | `100 - (고유 답변 수 / 전체 답변 수) * 50` | 0-100 | 높을수록 일관된 선택 |
| 위험 감수도 | `위험 키워드 개수 / 전체 답변 수 * 100` | 0-100 | 높을수록 과감한 선택 |
| 트렌드 추종도 | `트렌드 키워드 개수 / 전체 답변 수 * 100` | 0-100 | 높을수록 트렌드 따름 |
| 독특함 선호도 | `독특함 키워드 개수 / 전체 답변 수 * 100` | 0-100 | 높을수록 개성 추구 |

#### 패턴 매칭 점수 계산표

| 매칭 항목 | 가중치 | 점수 계산 |
|----------|--------|----------|
| 대화 패턴 매칭 | 25% | 지표 일치도 * 25 |
| 사진 패턴 매칭 | 20% | 사진 분석 일치도 * 20 |
| 선택 패턴 매칭 | 25% | 선택 일치도 * 25 |
| 시간 패턴 매칭 | 15% | 시간 패턴 일치도 * 15 |
| 맥락 보정 | 15% | 맥락 일치도 * 15 |

**최소 임계값**: 30점 이상이어야 패턴 매칭으로 인정

#### DNA 친화도 계산표

```typescript
// 패턴의 DNA 친화도 기반 점수 계산
dnaScore = Σ(patternMatch.matchScore * pattern.dnaAffinity[dnaType] / 100)
         / matchedPatternCount
```

예시:
- PATTERN_001 (효율 추구자) 매칭 점수: 80
- Fox DNA 친화도: 90
- Fox 점수 기여도: 80 * 90 / 100 = 72점

### 장점

1. ✅ **직관적**: 행동 패턴 기반으로 이해하기 쉬움
2. ✅ **확장성**: 새로운 패턴 추가가 용이
3. ✅ **맥락 반영**: 시간, 선택 패턴 등 맥락 고려
4. ✅ **숨은 니즈 발견**: 말하지 않은 행동에서 성향 추론

### 단점

1. ❌ **패턴 의존**: 패턴 라이브러리 품질에 정확도 의존
2. ❌ **데이터 필요**: 충분한 행동 데이터 필요
3. ❌ **설명 복잡**: 여러 패턴 조합 시 설명이 복잡해질 수 있음

---

## 설계안 3: 맥락 인식 하이브리드 엔진

### 핵심 개념

모든 입력 데이터를 **맥락 그래프**로 통합하고, **추론 규칙**을 적용하여 DNA 타입을 결정합니다.

### 아키텍처 다이어그램

```
┌─────────────────────────────────────────────────┐
│              입력 데이터                        │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐    │
│  │ 사진 분석 │  │ 대화 분석 │  │ 집 정보  │    │
│  └──────────┘  └──────────┘  └──────────┘    │
└─────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────┐
│         맥락 구축기                              │
│  ┌─────────────────────────────────────────┐   │
│  │ 시간 맥락 (언제?)                       │   │
│  │  - 답변 시간, 질문 순서                  │   │
│  └─────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────┐   │
│  │ 공간 맥락 (어디서?)                     │   │
│  │  - 주거형태, 평수, 방 개수               │   │
│  └─────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────┐   │
│  │ 상황 맥락 (무엇을?)                     │   │
│  │  - 사진 분석, 대화 내용                  │   │
│  └─────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────┐   │
│  │ 관계 맥락 (누구와?)                     │   │
│  │  - 가족 구성, 생활 패턴                  │   │
│  └─────────────────────────────────────────┘   │
└─────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────┐
│         맥락 그래프 구축                        │
│  ┌─────────────────────────────────────────┐   │
│  │ 노드 (Node)                             │   │
│  │  - Fact: 사실 정보                      │   │
│  │  - Inference: 추론 정보                 │   │
│  │  - Preference: 선호도                   │   │
│  │  - Need: 니즈                          │   │
│  │  - Constraint: 제약 조건                │   │
│  └─────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────┐   │
│  │ 엣지 (Edge)                              │   │
│  │  - supports: 지지 관계                  │   │
│  │  - contradicts: 모순 관계               │   │
│  │  - influences: 영향 관계                │   │
│  │  - requires: 필요 관계                  │   │
│  └─────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────┐   │
│  │ 가중치 (Weight)                          │   │
│  │  - 신뢰도 기반 가중치                    │   │
│  │  - 관계 강도                             │   │
│  └─────────────────────────────────────────┘   │
└─────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────┐
│         추론 엔진                                │
│  ┌─────────────────────────────────────────┐   │
│  │ 규칙 기반 추론                            │   │
│  │  - IF-THEN 규칙                          │   │
│  │  - 우선순위 기반 적용                     │   │
│  └─────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────┐   │
│  │ 통계 기반 추론                            │   │
│  │  - 확률 분포                              │   │
│  │  - 베이지안 추론                          │   │
│  └─────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────┐   │
│  │ 머신러닝 기반 추론                        │   │
│  │  - 그래프 신경망 (GNN)                    │   │
│  │  - 임베딩 벡터                            │   │
│  └─────────────────────────────────────────┘   │
└─────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────┐
│         하이브리드 결합                          │
│  - 규칙 기반 점수 (40%)                         │
│  - 통계 기반 점수 (35%)                         │
│  - 머신러닝 기반 점수 (25%)                     │
└─────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────┐
│         DNA 타입 + 설명 생성                     │
│  - 최고 점수 DNA 선택                           │
│  - 추론 경로 시각화                              │
│  - 대안 DNA 제시                                │
└─────────────────────────────────────────────────┘
```

### 데이터 구조

#### ContextNode (맥락 노드)

```typescript
interface ContextNode {
  id: string;                     // 노드 ID (예: 'photo_analysis', 'tag_STORAGE_NEED')
  type: 'fact' | 'inference' | 'preference' | 'need' | 'constraint';
  value: any;                     // 노드 값
  source: 'photo' | 'chat' | 'mood' | 'space' | 'derived';
  confidence: number;             // 신뢰도 (0.0-1.0)
  timestamp: number;              // 생성 시간
  relationships: {
    targetId: string;             // 관계 대상 노드 ID
    relation: 'supports' | 'contradicts' | 'influences' | 'requires';
    strength: number;             // 관계 강도 (0.0-1.0)
  }[];
}
```

#### ContextGraph (맥락 그래프)

```typescript
interface ContextGraph {
  nodes: Map<string, ContextNode>;
  edges: Map<string, { from: string; to: string; weight: number }[]>;
}
```

#### InferenceRule (추론 규칙)

```typescript
interface InferenceRule {
  id: string;                     // 규칙 ID (예: 'RULE_001')
  name: string;                   // 규칙 이름
  condition: (graph: ContextGraph) => boolean;  // 조건 함수
  action: (graph: ContextGraph) => ContextNode[];  // 실행 함수
  priority: number;               // 우선순위 (높을수록 먼저 적용)
}
```

### 분석표 설계

#### 맥락 노드 타입별 정의표

| 노드 타입 | 설명 | 예시 | 신뢰도 범위 |
|----------|------|------|-----------|
| fact | 사실 정보 (사용자 입력, 분석 결과) | `photo_analysis`, `family_info`, `space_info` | 0.7-1.0 |
| inference | 추론된 정보 (태그, 성향) | `tag_STORAGE_NEED`, `tag_HAS_CHILD` | 0.5-0.9 |
| preference | 선호도 (스타일 선택) | `mood_selection`, `style_preference` | 0.8-0.95 |
| need | 니즈 (필요한 것) | `need_storage`, `need_lighting` | 0.6-0.9 |
| constraint | 제약 조건 (공간, 예산 등) | `constraint_small_space`, `constraint_budget` | 0.9-1.0 |

#### 관계 타입별 정의표

| 관계 타입 | 설명 | 예시 | 가중치 범위 |
|----------|------|------|-----------|
| supports | 지지 관계 (A가 B를 지지) | `tag_STORAGE_NEED` → `photo_analysis` | 0.7-1.0 |
| contradicts | 모순 관계 (A가 B와 모순) | `MINIMAL_LOVER` ↔ `SPACE_WASTED` | 0.5-0.9 |
| influences | 영향 관계 (A가 B에 영향) | `constraint_small_space` → `tag_STORAGE_NEED` | 0.6-0.9 |
| requires | 필요 관계 (A가 B를 필요로 함) | `tag_CLEANING_SYSTEM_NEED` → `need_automation` | 0.8-1.0 |

#### 추론 규칙 라이브러리 (주요 규칙 15개)

| 규칙 ID | 규칙 이름 | 조건 | 동작 | 우선순위 |
|---------|----------|------|------|---------|
| RULE_001 | 수납 필요도 추론 | 수납 태그 OR 작은 공간 OR 가족 3인 이상 | 수납 필요도 노드 생성/강화 | 10 |
| RULE_002 | 가족 중심 성향 추론 | 가족 정보 존재 AND 아이 있음 | Bear DNA 친화도 +30 | 9 |
| RULE_003 | 작은 공간 제약 | 평수 < 20평 | 작은 공간 제약 노드 생성, Fox 강화, Eagle 약화 | 9 |
| RULE_004 | 청소 시스템 필요 | 청소 시스템 태그 OR 청소 스타일 'lazy' | Bee DNA 친화도 +20 | 8 |
| RULE_005 | 스타일 고집 추론 | 스타일 태그 선택 AND 트렌드 민감 | Lion/Butterfly DNA 친화도 증가 | 8 |
| RULE_006 | 미니멀 선호 추론 | MINIMAL_LOVER 태그 AND 정리 점수 > 7 | Swan DNA 친화도 +35 | 7 |
| RULE_007 | 사교형 추론 | GUEST_FREQUENT 태그 OR 거실 관심 | Dolphin DNA 친화도 +30 | 7 |
| RULE_008 | 독립 공간 필요 | REMOTE_WORK 태그 OR SOUNDPROOF_NEED | Owl/Wolf DNA 친화도 +25 | 7 |
| RULE_009 | 투자 가치 중시 | VALUE_PROTECTION 태그 OR 매도 목적 | Turtle DNA 친화도 +30 | 6 |
| RULE_010 | 효율 추구 추론 | STORAGE_NEED AND SPACE_EFFICIENT | Fox DNA 친화도 +25 | 6 |
| RULE_011 | 트렌드세터 추론 | 트렌드 키워드 AND 변화 선호 | Butterfly DNA 친화도 +30 | 5 |
| RULE_012 | 디테일 중시 추론 | 소품 언급 AND 컬러 선호 | Rabbit DNA 친화도 +25 | 5 |
| RULE_013 | 오픈 플로어 선호 | 동선 언급 AND 시원함 언급 | Eagle DNA 친화도 +30 | 4 |
| RULE_014 | 프리미엄 추구 추론 | 고급 키워드 AND 예산 유연 | Swan/Lion DNA 친화도 +20 | 4 |
| RULE_015 | 건강 중시 추론 | 환기/조명/안전 언급 | Bear/Turtle DNA 친화도 +15 | 3 |

#### 맥락 그래프 구축 예시

```
노드 구조:
- photo_analysis (fact, confidence: 0.85)
  └─ tag_STORAGE_NEED (inference, confidence: 0.77)
     └─ need_storage (need, confidence: 0.80)
        └─ dna_affinity_fox (inference, confidence: 0.75)

- family_info (fact, confidence: 0.90)
  └─ tag_HAS_CHILD (inference, confidence: 0.95)
     └─ dna_affinity_bear (inference, confidence: 0.85)

- space_info (fact, confidence: 1.0)
  └─ constraint_small_space (constraint, confidence: 1.0)
     └─ tag_STORAGE_NEED (inference, confidence: +0.2)
        └─ dna_affinity_fox (inference, confidence: +0.15)

- mood_selection (preference, confidence: 0.90)
  └─ tag_MINIMAL_LOVER (inference, confidence: 0.85)
     └─ dna_affinity_swan (inference, confidence: 0.80)
```

#### DNA 점수 계산표

| DNA 타입 | 규칙 기반 점수 | 통계 기반 점수 | ML 기반 점수 | 가중 합계 | 최종 점수 |
|----------|--------------|--------------|------------|----------|----------|
| Fox | 72 | 68 | 70 | 72*0.4 + 68*0.35 + 70*0.25 = **70.3** | 70.3 |
| Bear | 85 | 82 | 80 | 85*0.4 + 82*0.35 + 80*0.25 = **82.7** | 82.7 |
| Swan | 78 | 75 | 77 | 78*0.4 + 75*0.35 + 77*0.25 = **76.7** | 76.7 |
| ... | ... | ... | ... | ... | ... |

**최종 선택**: Bear (82.7점)

#### 신뢰도 계산 공식

```typescript
// 신뢰도 = 기본 신뢰도 + 점수 차이 보정 + 증거 수 보정
confidence = 0.5 + 
  (scoreGap / 100) * 0.3 +      // 점수 차이 (최대 30% 보정)
  (evidenceCount / 10) * 0.15 +  // 증거 수 (최대 15% 보정)
  (graphCompleteness * 0.05)     // 그래프 완성도 (최대 5% 보정)

// 최대 0.95로 제한
confidence = Math.min(0.95, confidence);
```

예시:
- 점수 차이: 82.7 - 76.7 = 6점
- 증거 수: 8개
- 그래프 완성도: 0.8
- 신뢰도: 0.5 + (6/100)*0.3 + (8/10)*0.15 + 0.8*0.05 = **0.748**

### 장점

1. ✅ **최고 정확도**: 맥락 통합으로 가장 정확한 분석
2. ✅ **설명 가능성**: 그래프 구조로 추론 과정 시각화 가능
3. ✅ **확장성**: 규칙 추가로 새로운 로직 추가 용이
4. ✅ **대안 제시**: 2-3위 DNA도 제시하여 선택권 제공

### 단점

1. ❌ **복잡도 높음**: 그래프 구축 및 추론 로직 복잡
2. ❌ **성능**: 그래프 연산으로 인한 성능 오버헤드
3. ❌ **구현 난이도**: 규칙 엔진 및 그래프 알고리즘 필요

---

## 비교 분석표

### 종합 비교표

| 항목 | 설계안 1: 다차원 프로파일링 | 설계안 2: 행동 패턴 추론 | 설계안 3: 맥락 인식 하이브리드 |
|------|---------------------------|----------------------|---------------------------|
| **정확도** | ⭐⭐⭐⭐ (85-90%) | ⭐⭐⭐ (80-85%) | ⭐⭐⭐⭐⭐ (90-95%) |
| **설명 가능성** | ⭐⭐⭐⭐⭐ (차원별 명확) | ⭐⭐⭐ (패턴 기반) | ⭐⭐⭐⭐ (그래프 구조) |
| **확장성** | ⭐⭐⭐ (차원 추가 어려움) | ⭐⭐⭐⭐⭐ (패턴 추가 쉬움) | ⭐⭐⭐⭐ (규칙 추가 가능) |
| **구현 복잡도** | 중간 | 낮음 | 높음 |
| **성능** | 빠름 | 빠름 | 중간 (그래프 연산) |
| **데이터 요구사항** | 중간 | 높음 (행동 데이터) | 중간 |
| **고객 만족도** | 높음 (명확한 설명) | 중간 (직관적) | 매우 높음 (맥락 반영) |
| **유지보수성** | 중간 | 높음 | 중간 |
| **학습 곡선** | 낮음 | 낮음 | 높음 |

### 세부 기능 비교표

| 기능 | 설계안 1 | 설계안 2 | 설계안 3 |
|------|---------|---------|---------|
| 차원별 분석 | ✅ 5개 차원 | ❌ | ⚠️ 부분적 |
| 행동 패턴 분석 | ❌ | ✅ 100+ 패턴 | ⚠️ 부분적 |
| 맥락 통합 | ⚠️ 제한적 | ⚠️ 제한적 | ✅ 완전 통합 |
| 상관관계 보정 | ✅ 규칙 기반 | ⚠️ 패턴 기반 | ✅ 그래프 기반 |
| 추론 근거 생성 | ✅ 차원별 | ✅ 패턴별 | ✅ 그래프 경로 |
| 대안 DNA 제시 | ⚠️ 점수만 | ⚠️ 패턴만 | ✅ 상세 설명 |
| 신뢰도 계산 | ✅ 차원 기반 | ✅ 패턴 기반 | ✅ 그래프 기반 |
| 시각화 가능성 | ⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐⭐⭐ |

### 비용/효과 분석표

| 항목 | 설계안 1 | 설계안 2 | 설계안 3 |
|------|---------|---------|---------|
| **개발 시간** | 2-3주 | 1-2주 | 4-5주 |
| **개발 난이도** | 중간 | 낮음 | 높음 |
| **테스트 시간** | 1주 | 1주 | 2주 |
| **유지보수 비용** | 중간 | 낮음 | 중간 |
| **예상 정확도** | 85-90% | 80-85% | 90-95% |
| **고객 만족도** | 높음 | 중간 | 매우 높음 |
| **ROI** | 높음 | 중간 | 매우 높음 |

---

## 구현 우선순위

### 단계별 구현 전략

#### Phase 1: 빠른 개선 (1-2주)
**추천: 설계안 2 (행동 패턴 추론)**
- 구현이 가장 빠름
- 기존 시스템에 최소한의 변경
- 패턴 라이브러리 확장 가능

#### Phase 2: 정확도 향상 (2-3주)
**추천: 설계안 1 (다차원 프로파일링)**
- Phase 1 기반으로 차원 분석 추가
- 가중치 튜닝으로 정확도 개선
- 설명 가능성 향상

#### Phase 3: 최종 완성 (4-5주)
**추천: 설계안 3 (맥락 인식 하이브리드)**
- Phase 1, 2를 통합
- 맥락 그래프 구축
- 최고 정확도 달성

### 즉시 적용 가능한 개선사항

1. **현재 시스템 + 다차원 분석**
   - 기존 로직 유지
   - 차원별 점수 계산 추가
   - 설명 생성 기능 추가

2. **현재 시스템 + 패턴 매칭**
   - 기존 로직 유지
   - 행동 패턴 분석 추가
   - 패턴 기반 DNA 보정

3. **현재 시스템 + 맥락 보정**
   - 기존 로직 유지
   - 간단한 맥락 규칙 추가
   - 점수 보정 적용

---

## 결론 및 추천

### 최종 추천: 설계안 3 (맥락 인식 하이브리드 엔진)

**이유:**
1. ✅ **최고 정확도**: 90-95% 예상 정확도
2. ✅ **완전한 맥락 통합**: 모든 입력 데이터를 통합적으로 고려
3. ✅ **설명 가능성**: 그래프 구조로 추론 과정 시각화
4. ✅ **확장성**: 규칙 추가로 새로운 로직 추가 용이
5. ✅ **고객 만족도**: 맥락 반영으로 가장 정확한 분석

### 단계적 구현 전략

1. **1단계 (1주)**: 설계안 2의 핵심 패턴 20개 구현
2. **2단계 (2주)**: 설계안 1의 5개 차원 분석 추가
3. **3단계 (3주)**: 설계안 3의 맥락 그래프 구축
4. **4단계 (1주)**: 통합 테스트 및 튜닝

**총 예상 기간**: 7주

---

## 부록

### A. 데이터 수집 가이드

#### 필요한 데이터
1. **대화 데이터**
   - 답변 텍스트
   - 답변 시간
   - 질문 순서

2. **선택 데이터**
   - 무드 선택
   - 공간 정보
   - 예산 범위

3. **사진 데이터**
   - 사진 분석 결과
   - 신뢰도 점수

4. **결과 데이터**
   - 최종 DNA 타입
   - 고객 만족도 (피드백)

### B. 테스트 시나리오

#### 시나리오 1: 효율 추구자
- 입력: 작은 공간, 수납 언급, 빠른 답변
- 기대 결과: Fox DNA
- 검증: 차원별 점수, 패턴 매칭, 맥락 그래프

#### 시나리오 2: 가족 중심형
- 입력: 가족 4인, 아이 있음, 편안함 언급
- 기대 결과: Bear DNA
- 검증: 가족 정보 노드, 상관관계 보정

#### 시나리오 3: 스타일 리더
- 입력: 스타일 선택, 상세한 답변, 트렌드 언급
- 기대 결과: Lion DNA
- 검증: 행동 패턴, 미적 선호 차원

---

**문서 작성일**: 2024년
**버전**: 1.0
**작성자**: AI 아키텍처 전문가




