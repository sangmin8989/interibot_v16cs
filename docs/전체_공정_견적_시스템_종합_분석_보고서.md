# ì „ì²´ ê³µì • ê²¬ì  ì‹œìŠ¤í…œ ì¢…í•© ë¶„ì„ ë³´ê³ ì„œ

> **ì‘ì„± ì¼ì‹œ**: 2025-01-21  
> **ë¶„ì„ ë²”ìœ„**: ì¸í…Œë¦¬ë´‡ ì „ì²´ ê³µì • ê²¬ì  ê´€ë ¨ í´ë”, íŒŒì¼, ë°ì´í„°  
> **ëª©ì **: ê²¬ì  ì‹œìŠ¤í…œ ì „ì²´ êµ¬ì¡° íŒŒì•… ë° ë¬¸ì„œí™”

---

## ğŸ“Š í†µê³„ ìš”ì•½

### íŒŒì¼ ìˆ˜
- **ê²¬ì  ì—”ì§„ íŒŒì¼**: 60ê°œ+
- **API ë¼ìš°íŠ¸**: 8ê°œ
- **ë°ì´í„° íŒŒì¼**: 20ê°œ+
- **íƒ€ì… ì •ì˜ íŒŒì¼**: 10ê°œ+
- **ì„œë¹„ìŠ¤ íŒŒì¼**: 4ê°œ
- **ì–´ëŒ‘í„° íŒŒì¼**: 3ê°œ

### í´ë” êµ¬ì¡°
- **ê²¬ì  ì—”ì§„**: `lib/estimate/`, `lib/estimate-v4/`
- **API ë¼ìš°íŠ¸**: `app/api/estimate/`
- **ë°ì´í„°**: `lib/data/`, `lib/data/pricing-v3/`
- **ì„œë¹„ìŠ¤**: `lib/services/`
- **íƒ€ì…**: `lib/types/`, `types/`

---

## ğŸ“ 1. ê²¬ì  ì—”ì§„ í´ë” êµ¬ì¡°

### 1.1 `lib/estimate/` (ë ˆê±°ì‹œ + í—Œë²• v1)

**íŒŒì¼ ëª©ë¡**:
```
lib/estimate/
â”œâ”€â”€ aiSchedule.ts                    # AI ì¼ì • ìƒì„±
â”œâ”€â”€ calculator-v3.ts                 # V3 ê³„ì‚°ê¸°
â”œâ”€â”€ config/
â”‚   â””â”€â”€ process-config.ts           # ê³µì • ì„¤ì •
â”œâ”€â”€ config.ts                       # ê¸°ë³¸ ì„¤ì •
â”œâ”€â”€ constitution-estimate-engine.ts  # í—Œë²• ê²¬ì  ì—”ì§„ (êµ¬ë²„ì „)
â”œâ”€â”€ constitution-v1-engine.ts       # í—Œë²• v1 ì—”ì§„ (ì‹ ê·œ)
â”œâ”€â”€ rule-engine-v0.ts               # ê·œì¹™ ì—”ì§„ v0
â”œâ”€â”€ schedule.ts                     # ì¼ì • ê´€ë¦¬
â”œâ”€â”€ types-v3.ts                     # V3 íƒ€ì…
â”œâ”€â”€ types.ts                        # ê¸°ë³¸ íƒ€ì…
â”œâ”€â”€ unified-calculator.ts            # í†µí•© ê³„ì‚°ê¸° (êµ¬ë²„ì „)
â”œâ”€â”€ unified-calculator-v2.ts        # í†µí•© ê³„ì‚°ê¸° v2
â””â”€â”€ v2/
    â””â”€â”€ indirect-costs.ts           # ê°„ì ‘ë¹„ ê³„ì‚°
```

**ì£¼ìš” ê¸°ëŠ¥**:
- V3 ê³„ì‚°ê¸°: 4ë“±ê¸‰ ì‹œìŠ¤í…œ (êµ¬ë²„ì „)
- í—Œë²• v1 ì—”ì§„: ì•„ë¥´ì   ê¸°ì¤€ ë‹¨ì¼ ê²¬ì 
- ê·œì¹™ ì—”ì§„ v0: ê·œì¹™ ê¸°ë°˜ ê²¬ì 
- í†µí•© ê³„ì‚°ê¸°: V2 í†µí•© ë¡œì§

**ìƒíƒœ**:
- âš ï¸ ì¼ë¶€ëŠ” DEPRECATED
- âœ… í—Œë²• v1 ì—”ì§„ì€ í˜„ì¬ ì‚¬ìš© ì¤‘

---

### 1.2 `lib/estimate-v4/` (V4 ê²¬ì  ì‹œìŠ¤í…œ)

**í´ë” êµ¬ì¡°**:
```
lib/estimate-v4/
â”œâ”€â”€ adapters/
â”‚   â”œâ”€â”€ index.ts
â”‚   â””â”€â”€ UIAdapter.ts                # UI ì–´ëŒ‘í„°
â”œâ”€â”€ converters/
â”‚   â”œâ”€â”€ grade-mapper.ts             # ë“±ê¸‰ ë§¤í•‘
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ input-converter.ts          # ì…ë ¥ ë³€í™˜
â”‚   â”œâ”€â”€ output-converter.ts         # ì¶œë ¥ ë³€í™˜
â”‚   â”œâ”€â”€ risk-mapper.ts              # ë¦¬ìŠ¤í¬ ë§¤í•‘
â”‚   â””â”€â”€ trait-mapper.ts             # ì„±í–¥ ë§¤í•‘
â”œâ”€â”€ engines/
â”‚   â”œâ”€â”€ estimate/
â”‚   â”‚   â”œâ”€â”€ CostCalculator.ts       # ë¹„ìš© ê³„ì‚°ê¸° â­
â”‚   â”‚   â”œâ”€â”€ EstimateEngineV4.ts     # ê²¬ì  ì—”ì§„ â­
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ ValidationGuard.ts     # ê²€ì¦ ê°€ë“œ
â”‚   â”œâ”€â”€ personality/
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ PersonalityEngineV4.ts # ì„±í–¥ ì—”ì§„
â”‚   â”‚   â”œâ”€â”€ RiskAssessor.ts         # ë¦¬ìŠ¤í¬ í‰ê°€
â”‚   â”‚   â”œâ”€â”€ TraitScorer.ts          # ì„±í–¥ ì ìˆ˜
â”‚   â”‚   â””â”€â”€ TypeClassifier.ts       # íƒ€ì… ë¶„ë¥˜
â”‚   â”œâ”€â”€ strategy/
â”‚   â”‚   â”œâ”€â”€ GradeSelector.ts        # ë“±ê¸‰ ì„ íƒ
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ ProcessPicker.ts        # ê³µì • ì„ íƒ
â”‚   â”‚   â””â”€â”€ StrategyEngineV4.ts     # ì „ëµ ì—”ì§„
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ errors/
â”‚   â””â”€â”€ index.ts                    # ì—ëŸ¬ íƒ€ì…
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ estimate.types.ts           # ê²¬ì  íƒ€ì… â­
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ input.types.ts              # ì…ë ¥ íƒ€ì…
â”‚   â”œâ”€â”€ personality.types.ts        # ì„±í–¥ íƒ€ì…
â”‚   â”œâ”€â”€ strategy.types.ts          # ì „ëµ íƒ€ì…
â”‚   â””â”€â”€ v4-estimate-types.ts        # V4 ê²¬ì  íƒ€ì…
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ error-handler.ts            # ì—ëŸ¬ ì²˜ë¦¬
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ logger.ts                   # ë¡œê±°
â”‚   â””â”€â”€ safe-access.ts              # ì•ˆì „ ì ‘ê·¼
â””â”€â”€ index.ts                         # ë©”ì¸ ì—”íŠ¸ë¦¬ â­
```

**í•µì‹¬ íŒŒì¼**:
- `index.ts`: `calculateEstimateV4ForUI()` - ë©”ì¸ ê²¬ì  ê³„ì‚° í•¨ìˆ˜
- `engines/estimate/CostCalculator.ts`: ê³µì •ë³„ ë¹„ìš© ê³„ì‚°
- `engines/estimate/EstimateEngineV4.ts`: ê²¬ì  ì—”ì§„ ë©”ì¸
- `types/estimate.types.ts`: ê²¬ì  íƒ€ì… ì •ì˜

**ìƒíƒœ**: âœ… í˜„ì¬ ì‚¬ìš© ì¤‘ (ê³µì‹ ê²¬ì  ì—”ì§„)

---

## ğŸ“ 2. API ë¼ìš°íŠ¸ êµ¬ì¡°

### 2.1 ê³µì‹ ê²¬ì  API

**íŒŒì¼**: `app/api/estimate/v4/route.ts`
- **ìƒíƒœ**: âœ… ê³µì‹ ê²¬ì  API
- **ê¸°ëŠ¥**: V4 ê²¬ì  ê³„ì‚° + Decision Trace ì €ì¥
- **Phase 0 ë´‰ì¸**: ì ìš©ë¨
- **Phase 1 í™•ì¥**: `decision_explanation_split` ì¶”ê°€

---

### 2.2 êµ¬ë²„ì „ ê²¬ì  API (ì°¨ë‹¨ë¨)

**ì°¨ë‹¨ëœ API**:
```
app/api/estimate/
â”œâ”€â”€ v3/route.ts              # âŒ ì°¨ë‹¨ (410 Gone)
â”œâ”€â”€ calculate/route.ts       # âŒ ì°¨ë‹¨ (410 Gone)
â”œâ”€â”€ constitution/route.ts    # âŒ ì°¨ë‹¨ (410 Gone)
â”œâ”€â”€ argen/route.ts           # âŒ ì°¨ë‹¨ (410 Gone)
â”œâ”€â”€ rule-engine-v0/route.ts # âŒ ì°¨ë‹¨ (410 Gone)
â”œâ”€â”€ materials/route.ts      # âœ… ìœ ì§€ (ìì¬ ì¡°íšŒìš©)
â””â”€â”€ labor/route.ts          # âœ… ìœ ì§€ (ë…¸ë¬´ ì¡°íšŒìš©)
```

**ìƒíƒœ**: Phase 0ì—ì„œ ì°¨ë‹¨ë¨

---

## ğŸ“ 3. ë°ì´í„° íŒŒì¼ êµ¬ì¡°

### 3.1 ê²¬ì  ë§ˆìŠ¤í„° ë°ì´í„°

**íŒŒì¼**:
```
lib/data/
â”œâ”€â”€ estimate-master.json          # JSON ë§ˆìŠ¤í„° ë°ì´í„°
â”œâ”€â”€ estimate-master.ts            # TS ë§ˆìŠ¤í„° ë°ì´í„°
â”œâ”€â”€ estimate-master-v2.ts         # V2 ë§ˆìŠ¤í„° ë°ì´í„°
â”œâ”€â”€ estimate-master-real.ts       # ì‹¤ì œ ê²¬ì ì„œ ê¸°ë°˜
â””â”€â”€ pricing.json                  # ê°€ê²© ë°ì´í„°
```

**ìš©ë„**:
- ë ˆê±°ì‹œ ê²¬ì  ì‹œìŠ¤í…œìš©
- V2/V3 ê³„ì‚°ê¸° ì°¸ì¡°
- âš ï¸ V4ëŠ” DB ê¸°ë°˜ì´ë¯€ë¡œ ì‚¬ìš© ì•ˆ í•¨

---

### 3.2 Pricing V3 ë°ì´í„°

**í´ë”**: `lib/data/pricing-v3/`

**íŒŒì¼ ëª©ë¡**:
```
lib/data/pricing-v3/
â”œâ”€â”€ bathroom.ts              # ìš•ì‹¤ ê°€ê²©
â”œâ”€â”€ common.ts                # ê³µí†µ
â”œâ”€â”€ demolition-packages.ts  # ì² ê±° íŒ¨í‚¤ì§€
â”œâ”€â”€ door.ts                  # ë¬¸
â”œâ”€â”€ doorlock.ts              # ë„ì–´ë½
â”œâ”€â”€ film.ts                  # í•„ë¦„
â”œâ”€â”€ flooring.ts              # ë°”ë‹¥
â”œâ”€â”€ furniture.ts             # ê°€êµ¬
â”œâ”€â”€ kitchen.ts               # ì£¼ë°©
â”œâ”€â”€ labor.ts                 # ë…¸ë¬´ë¹„
â”œâ”€â”€ lighting.ts              # ì¡°ëª…
â”œâ”€â”€ molding.ts               # ëª°ë”©
â”œâ”€â”€ protection.ts            # ë³´ì–‘
â”œâ”€â”€ tile-constants.ts        # íƒ€ì¼ ìƒìˆ˜
â”œâ”€â”€ tile.ts                  # íƒ€ì¼
â”œâ”€â”€ types.ts                 # íƒ€ì…
â”œâ”€â”€ wallpaper.ts             # ë„ë°°
â”œâ”€â”€ waste.ts                 # íê¸°ë¬¼
â””â”€â”€ window.ts                # ì°½í˜¸
```

**ìš©ë„**:
- V3 ê³„ì‚°ê¸° ì°¸ì¡°
- íƒ€ì¼ ê³„ì‚° ë“± íŠ¹ìˆ˜ ì¼€ì´ìŠ¤

---

### 3.3 ê¸°íƒ€ ë°ì´í„° íŒŒì¼

**íŒŒì¼**:
```
lib/data/
â”œâ”€â”€ basePrices.ts            # ê¸°ë³¸ ê°€ê²©
â”œâ”€â”€ gradeSpecs.ts            # ë“±ê¸‰ ìŠ¤í™
â”œâ”€â”€ housing-type-adjustments.ts  # ì£¼ê±°í˜•íƒœ ì¡°ì •
â”œâ”€â”€ itemMaster.ts            # í’ˆëª© ë§ˆìŠ¤í„°
â”œâ”€â”€ priceRanges.ts           # ê°€ê²© ë²”ìœ„
â””â”€â”€ trait-weights.json       # ì„±í–¥ ê°€ì¤‘ì¹˜
```

---

## ğŸ“ 4. ì„œë¹„ìŠ¤ íŒŒì¼ êµ¬ì¡°

### 4.1 í—Œë²• v1.1 ì „ìš© ì„œë¹„ìŠ¤

**íŒŒì¼**:
```
lib/services/
â”œâ”€â”€ material-service-strict.ts  # ìì¬ ê°€ê²© ì¡°íšŒ (Strict) â­
â””â”€â”€ labor-service-strict.ts     # ë…¸ë¬´ë¹„ ì¡°íšŒ (Strict) â­
```

**ê¸°ëŠ¥**:
- `getMaterialPriceStrict()`: ìì¬ ê°€ê²© ì¡°íšŒ (ì‹¤íŒ¨ ì‹œ throw)
- `getLaborRateStrict()`: ë…¸ë¬´ë¹„ ì¡°íšŒ (ì‹¤íŒ¨ ì‹œ throw)
- í—Œë²• v1.1 ì „ìš©: `constitution-v1-engine.ts`ì—ì„œë§Œ í˜¸ì¶œ

**ìƒíƒœ**: âœ… í˜„ì¬ ì‚¬ìš© ì¤‘

---

### 4.2 ê¸°íƒ€ ì„œë¹„ìŠ¤

**íŒŒì¼**:
```
lib/services/
â”œâ”€â”€ material-service.ts      # ìì¬ ì„œë¹„ìŠ¤ (êµ¬ë²„ì „)
â””â”€â”€ simpleEstimate.ts        # ê°„ë‹¨ ê²¬ì  ì—”ì§„
```

**ìƒíƒœ**: âš ï¸ ì¼ë¶€ëŠ” DEPRECATED

---

## ğŸ“ 5. íƒ€ì… ì •ì˜ êµ¬ì¡°

### 5.1 í—Œë²• ê²¬ì  íƒ€ì…

**íŒŒì¼**: `lib/types/í—Œë²•_ê²¬ì _íƒ€ì….ts`

**ì£¼ìš” íƒ€ì…**:
- `ProcessId`: ê³µì • ID (demolition, finish, kitchen, bathroom ë“±)
- `SelectedSpace`: ì„ íƒ ê°€ëŠ¥í•œ ê³µê°„
- `MaterialRequest`: ìì¬ ìš”ì²­
- `LaborRequest`: ë…¸ë¬´ ìš”ì²­
- `MaterialDbResult`: ìì¬ DB ê²°ê³¼
- `LaborDbResult`: ë…¸ë¬´ DB ê²°ê³¼
- `ProcessEstimateBlock`: ê³µì • ê²¬ì  ë¸”ë¡
- `EstimateValidationError`: ê²¬ì  ê²€ì¦ ì—ëŸ¬

**ìƒíƒœ**: âœ… í—Œë²• v1.1 ê¸°ì¤€ íƒ€ì…

---

### 5.2 V4 ê²¬ì  íƒ€ì…

**íŒŒì¼**: `lib/estimate-v4/types/`

**ì£¼ìš” íƒ€ì…**:
- `ProcessBlockV4`: V4 ê³µì • ë¸”ë¡
- `MaterialItemV4`: V4 ìì¬ í•­ëª©
- `LaborItemV4`: V4 ë…¸ë¬´ í•­ëª©
- `EstimateResultV4`: V4 ê²¬ì  ê²°ê³¼
- `UIEstimateV4`: V4 UI ê²¬ì  ê²°ê³¼
- `SpaceInfoV4`: V4 ê³µê°„ ì •ë³´
- `GradeV4`: V4 ë“±ê¸‰

**ìƒíƒœ**: âœ… í˜„ì¬ ì‚¬ìš© ì¤‘

---

### 5.3 ê¸°íƒ€ íƒ€ì…

**íŒŒì¼**:
```
types/
â”œâ”€â”€ estimate.ts              # ê¸°ë³¸ ê²¬ì  íƒ€ì…
â””â”€â”€ process-options.ts        # ê³µì • ì˜µì…˜ íƒ€ì…
```

---

## ğŸ“ 6. DB ì–´ëŒ‘í„° êµ¬ì¡°

### 6.1 DB ì–´ëŒ‘í„°

**í´ë”**: `lib/db/adapters/`

**íŒŒì¼**:
```
lib/db/adapters/
â”œâ”€â”€ demolition-adapter.ts    # ì² ê±° ì–´ëŒ‘í„°
â”œâ”€â”€ personality-adapter.ts   # ì„±í–¥ ì–´ëŒ‘í„°
â””â”€â”€ tile-adapter.ts          # íƒ€ì¼ ì–´ëŒ‘í„°
```

**ê¸°ëŠ¥**:
- DB ë°ì´í„°ë¥¼ ê²¬ì  ì‹œìŠ¤í…œ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
- ìºì‹± ì§€ì›

---

## ğŸ“ 7. Supabase í…Œì´ë¸” êµ¬ì¡°

### 7.1 ìì¬ ê´€ë ¨ í…Œì´ë¸”

**í…Œì´ë¸”**: `materials`

**ì£¼ìš” ì»¬ëŸ¼**:
- `material_id`: UUID (Primary Key)
- `material_code`: ìì¬ ì½”ë“œ
- `product_name`: ì œí’ˆëª…
- `category_1`: ëŒ€ë¶„ë¥˜ (ë°”ë‹¥, ìš•ì‹¤, ì£¼ë°© ë“±)
- `category_2`: ì¤‘ë¶„ë¥˜ (ë§ˆë£¨, ìš•ì‹¤ì„¸íŠ¸, ì‹œìŠ¤í…œì£¼ë°© ë“±)
- `category_3`: ì†Œë¶„ë¥˜ (ì„ íƒ)
- `grade`: ë“±ê¸‰ (ARGEN_E, ARGEN_S, ARGEN_O)
- `price`: ê°€ê²©
- `price_argen`: ì•„ë¥´ì   ê°€ê²©
- `is_argen_standard`: ì•„ë¥´ì   ê¸°ì¤€ ì—¬ë¶€
- `brand_argen`: ì•„ë¥´ì   ë¸Œëœë“œ
- `argen_priority`: ì•„ë¥´ì   ìš°ì„ ìˆœìœ„
- `is_active`: í™œì„±í™” ì—¬ë¶€

**ì¸ë±ìŠ¤**:
- `idx_materials_code`
- `idx_materials_grade`
- `idx_materials_category`
- `idx_materials_active`

---

### 7.2 ë…¸ë¬´ë¹„ ê´€ë ¨ í…Œì´ë¸”

**í…Œì´ë¸”**: `labor_productivity`

**ì£¼ìš” ì»¬ëŸ¼**:
- `labor_id`: UUID (Primary Key)
- `phase_id`: ê³µì • ID (finish, kitchen, bathroom ë“±)
- `labor_unit`: ë…¸ë¬´ ë‹¨ìœ„ (m2, EA, SET, day)
- `daily_output`: 1ì¼ ì‘ì—…ëŸ‰
- `crew_size`: íˆ¬ì… ì¸ì›
- `output_factor_by_difficulty`: ë‚œì´ë„ë³„ ì‘ì—…ëŸ‰ ê³„ìˆ˜
- `is_active`: í™œì„±í™” ì—¬ë¶€

**í…Œì´ë¸”**: `labor_costs`

**ì£¼ìš” ì»¬ëŸ¼**:
- `labor_id`: UUID (Primary Key)
- `phase_id`: ê³µì • ID
- `rate_per_person_day`: 1ì¸ 1ì¼ ë…¸ë¬´ ë‹¨ê°€ (ì›)
- `is_active`: í™œì„±í™” ì—¬ë¶€

**ì¸ë±ìŠ¤**:
- `idx_labor_process`
- `idx_labor_active`

---

### 7.3 ì² ê±° ê´€ë ¨ í…Œì´ë¸”

**í…Œì´ë¸”**:
- `demolition_packages`: ì² ê±° íŒ¨í‚¤ì§€
- `demolition_items`: ì² ê±° í•­ëª©
- `demolition_waste_config`: íê¸°ë¬¼ ì„¤ì •
- `demolition_protection`: ë³´ì–‘ ì„¤ì •

---

### 7.4 Decision Trace í…Œì´ë¸”

**í…Œì´ë¸”**:
- `v5_question_logs`: ì§ˆë¬¸ ë¡œê·¸
- `v5_question_answers`: ë‹µë³€ ë¡œê·¸
- `v5_estimate_results`: ê²¬ì  ê²°ê³¼ ìŠ¤ëƒ…ìƒ·
- `v5_decision_impacts`: ì§ˆë¬¸-ê²¬ì  ì˜í–¥ ì¶”ì 

---

## ğŸ“ 8. ê³µì • ì •ì˜ êµ¬ì¡°

### 8.1 ê³µì • ì •ì˜ íŒŒì¼

**íŒŒì¼**: `constants/process-definitions.ts`

**ë‚´ìš©**:
- ê³µì • ID ì •ì˜
- ê³µì •ëª… ë§¤í•‘
- ê³µì •ë³„ ì˜µì…˜ ì •ì˜

---

## ğŸ“ 9. ê²¬ì  ê³„ì‚° íë¦„

### 9.1 ê³µì‹ ê²¬ì  ê²½ë¡œ (Phase 0 ë´‰ì¸)

**UI**: `/onboarding/estimate`
**API**: `/api/estimate/v4`

**íë¦„**:
```
1. í”„ë¡ íŠ¸: /onboarding/estimate
   â†“
2. API: POST /api/estimate/v4
   â†“
3. V5 ë¶„ì„: analyzeV5Complete()
   â†“
4. V4 ê²¬ì  ê³„ì‚°: calculateEstimateV4ForUI()
   â”œâ”€ PersonalityEngineV4: ì„±í–¥ ë¶„ì„
   â”œâ”€ StrategyEngineV4: ì „ëµ ê²°ì •
   â””â”€ EstimateEngineV4: ê²¬ì  ê³„ì‚°
      â”œâ”€ CostCalculator: ê³µì •ë³„ ë¹„ìš© ê³„ì‚°
      â”‚  â”œâ”€ getMaterialPriceStrict(): ìì¬ ê°€ê²© ì¡°íšŒ
      â”‚  â””â”€ getLaborRateStrict(): ë…¸ë¬´ë¹„ ì¡°íšŒ
      â””â”€ ValidationGuard: ê²€ì¦
   â†“
5. UIAdapter: UI í˜•ì‹ ë³€í™˜
   â†“
6. Decision Trace ì €ì¥
   â”œâ”€ v5_estimate_results: ê²¬ì  ìŠ¤ëƒ…ìƒ·
   â”œâ”€ v5_decision_impacts: ì˜í–¥ ì¶”ì 
   â””â”€ decision_explanation_split: ì„¤ëª… ë¶„ê¸°
   â†“
7. í”„ë¡ íŠ¸: ê²°ê³¼ í‘œì‹œ
```

---

### 9.2 ê³µì •ë³„ ë¹„ìš© ê³„ì‚° ìƒì„¸

**íŒŒì¼**: `lib/estimate-v4/engines/estimate/CostCalculator.ts`

**í•¨ìˆ˜**: `calculateProcessCosts()`

**ë‹¨ê³„**:
1. ê³µì • ID â†’ í—Œë²• ProcessId ë§¤í•‘
2. ìì¬ ë§¤í•‘ ì¡°íšŒ (`PROCESS_MATERIAL_MAP`)
3. ìì¬ ê°€ê²© ì¡°íšŒ (`getMaterialPriceStrict`)
4. ë…¸ë¬´ ë§¤í•‘ ì¡°íšŒ (`PROCESS_LABOR_MAP`)
5. ë…¸ë¬´ë¹„ ì¡°íšŒ (`getLaborRateStrict`)
6. ì‘ì—… ì¼ìˆ˜ ê³„ì‚°
7. ì´ ë…¸ë¬´ë¹„ ê³„ì‚°
8. ê²€ì¦ (`validateProcessBlock`)
9. í•©ê³„ ê³„ì‚°

---

## ğŸ“ 10. ê³µì • ID ë§¤í•‘

### 10.1 í—Œë²• ProcessId

**ì •ì˜**: `lib/types/í—Œë²•_ê²¬ì _íƒ€ì….ts`

**ProcessId ëª©ë¡**:
- `demolition`: ì² ê±°
- `finish`: ë§ˆê° (ë„ë°°/ë°”ë‹¥)
- `electric`: ì¡°ëª…/ì „ê¸°
- `kitchen`: ì£¼ë°©
- `bathroom`: ìš•ì‹¤
- `door`: ë¬¸
- `window`: ì°½í˜¸
- `storage`: ìˆ˜ë‚©
- `waterproof`: ë°©ìˆ˜
- `plumbing`: ì„¤ë¹„
- `waste`: íê¸°ë¬¼
- `SYSTEM`: ì‹œìŠ¤í…œ ë ˆë²¨ ê²€ì¦

---

### 10.2 V4 ProcessId â†’ í—Œë²• ProcessId ë§¤í•‘

**íŒŒì¼**: `lib/estimate-v4/engines/estimate/CostCalculator.ts`

**ë§¤í•‘**:
```typescript
const V4_PROCESS_TO_HEONGBEOP: Record<string, ProcessId> = {
  kitchen_core: 'kitchen',
  bathroom_waterproof: 'bathroom',
  storage_system: 'storage',
  soundproof: 'finish',
  lighting: 'electric',
  flooring: 'finish',
  wallpaper: 'finish',
  window: 'window',
  door: 'door',
  demolition: 'demolition',
}
```

---

## ğŸ“ 11. ìì¬/ë…¸ë¬´ ë§¤í•‘

### 11.1 ìì¬ ë§¤í•‘

**íŒŒì¼**: `lib/estimate-v4/engines/estimate/CostCalculator.ts`

**ë§¤í•‘**: `PROCESS_MATERIAL_MAP`

**ì˜ˆì‹œ**:
```typescript
kitchen_core: {
  category1: 'ì£¼ë°©',
  category2: 'ì‹œìŠ¤í…œì£¼ë°©',
  spec: 'SET',
  quantity: () => ({ value: 1, unit: 'SET', basis: 'ì£¼ë°© 1ì„¸íŠ¸' }),
}
```

---

### 11.2 ë…¸ë¬´ ë§¤í•‘

**íŒŒì¼**: `lib/estimate-v4/engines/estimate/CostCalculator.ts`

**ë§¤í•‘**: `PROCESS_LABOR_MAP`

**ì˜ˆì‹œ**:
```typescript
kitchen: {
  unit: 'SET',
  totalQuantity: () => 1,
  dailyOutput: 0.5,
  crewSize: 2,
}
```

---

## ğŸ“ 12. ë°ì´í„° ì†ŒìŠ¤

### 12.1 DB ê¸°ë°˜ (í˜„ì¬ ì‚¬ìš©)

**ì†ŒìŠ¤**: Supabase
- `materials`: ìì¬ ì •ë³´
- `labor_productivity`: ë…¸ë¬´ ìƒì‚°ì„±
- `labor_costs`: ë…¸ë¬´ ë‹¨ê°€

**ì„œë¹„ìŠ¤**: 
- `material-service-strict.ts`
- `labor-service-strict.ts`

---

### 12.2 íŒŒì¼ ê¸°ë°˜ (ë ˆê±°ì‹œ)

**ì†ŒìŠ¤**: JSON/TS íŒŒì¼
- `lib/data/estimate-master.json`
- `lib/data/pricing-v3/*.ts`

**ìƒíƒœ**: âš ï¸ ì¼ë¶€ëŠ” DEPRECATED

---

## ğŸ“ 13. ê²€ì¦ ë° ì—ëŸ¬ ì²˜ë¦¬

### 13.1 ê²€ì¦ ê°€ë“œ

**íŒŒì¼**: `lib/estimate-v4/engines/estimate/ValidationGuard.ts`

**í•¨ìˆ˜**:
- `validateProcessBlock()`: ê³µì • ë¸”ë¡ ê²€ì¦
- `safeValidateProcessBlock()`: ì•ˆì „í•œ ê²€ì¦

---

### 13.2 ì—ëŸ¬ íƒ€ì…

**íŒŒì¼**: `lib/types/í—Œë²•_ê²¬ì _íƒ€ì….ts`

**ì—ëŸ¬**:
- `EstimateValidationError`: ê²¬ì  ê²€ì¦ ì—ëŸ¬
- `EstimateCalculationError`: ê²¬ì  ê³„ì‚° ì—ëŸ¬

---

## ğŸ“ 14. UI ì–´ëŒ‘í„°

### 14.1 UI ì–´ëŒ‘í„°

**íŒŒì¼**: `lib/estimate-v4/adapters/UIAdapter.ts`

**í•¨ìˆ˜**: `adaptForUI()`

**ê¸°ëŠ¥**:
- `EstimateResultV4` â†’ `UIEstimateV4` ë³€í™˜
- í¬ë§·íŒ… (ê¸ˆì•¡, í‰ë‹¹ ë‹¨ê°€)
- ê³µê°„ í•„í„°ë§ (ë²„ê·¸ 1 ë°©ì§€)

---

## ğŸ“ 15. í”„ë¡ íŠ¸ì—”ë“œ êµ¬ì¡°

### 15.1 ê²¬ì  í˜ì´ì§€

**íŒŒì¼**: `app/onboarding/estimate/page.tsx`

**ê¸°ëŠ¥**:
- ê²¬ì  ê³„ì‚° ìš”ì²­
- ê²°ê³¼ í‘œì‹œ
- ë“±ê¸‰ë³„ ê²¬ì  ë¹„êµ
- Phase 0 BLOCK ì²˜ë¦¬
- Phase 1 Decision Trace ì„¤ëª… í‘œì‹œ

---

## ğŸ“Š 16. ê²¬ì  ì—”ì§„ ë²„ì „ ë¹„êµ

| ë²„ì „ | ìƒíƒœ | ì‚¬ìš© ìœ„ì¹˜ | íŠ¹ì§• |
|------|------|----------|------|
| V2 | âš ï¸ DEPRECATED | `lib/estimate/unified-calculator-v2.ts` | 4ë“±ê¸‰ ì‹œìŠ¤í…œ |
| V3 | âš ï¸ DEPRECATED | `lib/estimate/calculator-v3.ts` | 4ë“±ê¸‰ ì‹œìŠ¤í…œ |
| V4 | âœ… ê³µì‹ | `lib/estimate-v4/` | 3ë“±ê¸‰ (ARGEN_E/S/O) |
| í—Œë²• v1 | âœ… ì‚¬ìš© | `lib/estimate/constitution-v1-engine.ts` | ì•„ë¥´ì   ê¸°ì¤€ ë‹¨ì¼ |
| ê·œì¹™ ì—”ì§„ v0 | âš ï¸ DEPRECATED | `lib/estimate/rule-engine-v0.ts` | ê·œì¹™ ê¸°ë°˜ |

---

## ğŸ” 17. í•µì‹¬ ì˜ì¡´ì„± ê´€ê³„

### 17.1 ê²¬ì  ê³„ì‚° ì˜ì¡´ì„±

```
calculateEstimateV4ForUI()
  â”œâ”€ analyzePersonality() â†’ PersonalityEngineV4
  â”œâ”€ determineStrategy() â†’ StrategyEngineV4
  â””â”€ calculateEstimate() â†’ EstimateEngineV4
      â””â”€ calculateProcessCosts() â†’ CostCalculator
          â”œâ”€ getMaterialPriceStrict() â†’ material-service-strict.ts
          â”‚   â””â”€ Supabase: materials í…Œì´ë¸”
          â””â”€ getLaborRateStrict() â†’ labor-service-strict.ts
              â”œâ”€ Supabase: labor_productivity í…Œì´ë¸”
              â””â”€ Supabase: labor_costs í…Œì´ë¸”
```

---

### 17.2 ë°ì´í„° íë¦„

```
ì…ë ¥ (CollectedInputV4)
  â†“
V5 ë¶„ì„ (analyzeV5Complete)
  â†“
V4 ê²¬ì  ê³„ì‚° (calculateEstimateV4ForUI)
  â”œâ”€ ì„±í–¥ ë¶„ì„
  â”œâ”€ ì „ëµ ê²°ì •
  â””â”€ ê²¬ì  ê³„ì‚°
      â”œâ”€ ìì¬ ê°€ê²© ì¡°íšŒ (DB)
      â””â”€ ë…¸ë¬´ë¹„ ì¡°íšŒ (DB)
  â†“
UI ì–´ëŒ‘í„° (adaptForUI)
  â†“
ê²°ê³¼ (UIEstimateV4)
  â†“
Decision Trace ì €ì¥
  â”œâ”€ v5_estimate_results
  â”œâ”€ v5_decision_impacts
  â””â”€ decision_explanation_split
```

---

## ğŸ“‹ 18. íŒŒì¼ë³„ ì—­í•  ìš”ì•½

### 18.1 í•µì‹¬ ê²¬ì  ì—”ì§„

| íŒŒì¼ | ì—­í•  | ìƒíƒœ |
|------|------|------|
| `lib/estimate-v4/index.ts` | ë©”ì¸ ì—”íŠ¸ë¦¬, `calculateEstimateV4ForUI()` | âœ… ê³µì‹ |
| `lib/estimate-v4/engines/estimate/EstimateEngineV4.ts` | ê²¬ì  ì—”ì§„ ë©”ì¸ | âœ… ì‚¬ìš© ì¤‘ |
| `lib/estimate-v4/engines/estimate/CostCalculator.ts` | ê³µì •ë³„ ë¹„ìš© ê³„ì‚° | âœ… ì‚¬ìš© ì¤‘ |
| `lib/estimate-v4/engines/estimate/ValidationGuard.ts` | ê²€ì¦ ê°€ë“œ | âœ… ì‚¬ìš© ì¤‘ |

---

### 18.2 ì„œë¹„ìŠ¤ ë ˆì´ì–´

| íŒŒì¼ | ì—­í•  | ìƒíƒœ |
|------|------|------|
| `lib/services/material-service-strict.ts` | ìì¬ ê°€ê²© ì¡°íšŒ (Strict) | âœ… ê³µì‹ |
| `lib/services/labor-service-strict.ts` | ë…¸ë¬´ë¹„ ì¡°íšŒ (Strict) | âœ… ê³µì‹ |

---

### 18.3 íƒ€ì… ì •ì˜

| íŒŒì¼ | ì—­í•  | ìƒíƒœ |
|------|------|------|
| `lib/types/í—Œë²•_ê²¬ì _íƒ€ì….ts` | í—Œë²• v1.1 íƒ€ì… | âœ… ê³µì‹ |
| `lib/estimate-v4/types/estimate.types.ts` | V4 ê²¬ì  íƒ€ì… | âœ… ì‚¬ìš© ì¤‘ |

---

## ğŸ¯ 19. í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ ê³µì‹ ê²½ë¡œ

### 19.1 ê³µì‹ ê²¬ì  ê²½ë¡œ (Phase 0 ë´‰ì¸)

**UI**: `/onboarding/estimate`
**API**: `/api/estimate/v4`

**ì—”ì§„**: `lib/estimate-v4/`
**ì„œë¹„ìŠ¤**: `lib/services/material-service-strict.ts`, `lib/services/labor-service-strict.ts`
**DB**: Supabase (`materials`, `labor_productivity`, `labor_costs`)

---

### 19.2 êµ¬ë²„ì „ ê²½ë¡œ (ì°¨ë‹¨ë¨)

- `/estimate` â†’ `/onboarding/estimate`ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
- `/api/estimate/v3` â†’ 410 Gone
- `/api/estimate/calculate` â†’ 410 Gone
- `/api/estimate/constitution` â†’ 410 Gone
- `/api/estimate/argen` â†’ 410 Gone
- `/api/estimate/rule-engine-v0` â†’ 410 Gone

---

## ğŸ“Š 20. ë°ì´í„° íŒŒì¼ ìƒì„¸

### 20.1 ê²¬ì  ë§ˆìŠ¤í„° ë°ì´í„°

**íŒŒì¼**: `lib/data/estimate-master.json`

**êµ¬ì¡°**:
```json
{
  "metadata": { ... },
  "categories": {
    "ì² ê±°": { "í•­ëª©": [...] },
    "ë§ˆê°": { "í•­ëª©": [...] },
    ...
  }
}
```

**ìš©ë„**: ë ˆê±°ì‹œ ê²¬ì  ì‹œìŠ¤í…œ ì°¸ì¡°

---

### 20.2 Pricing V3 ë°ì´í„°

**í´ë”**: `lib/data/pricing-v3/`

**ì£¼ìš” íŒŒì¼**:
- `tile.ts`: íƒ€ì¼ ê°€ê²© ê³„ì‚°
- `bathroom.ts`: ìš•ì‹¤ ê°€ê²©
- `kitchen.ts`: ì£¼ë°© ê°€ê²©
- `labor.ts`: ë…¸ë¬´ë¹„

**ìš©ë„**: V3 ê³„ì‚°ê¸° ë° íŠ¹ìˆ˜ ì¼€ì´ìŠ¤

---

## ğŸ”’ 21. Phase 0/1 ë´‰ì¸ ìƒíƒœ

### 21.1 Phase 0 ë´‰ì¸

- âœ… êµ¬ë²„ì „ ë¼ìš°íŠ¸ ì°¨ë‹¨ (middleware.ts)
- âœ… êµ¬ë²„ì „ API ì°¨ë‹¨ (410 Gone)
- âœ… DB ê²Œì´íŠ¸ (í•„ìˆ˜ ë°ì´í„° ì—†ìœ¼ë©´ BLOCK)

---

### 21.2 Phase 1 í™•ì¥

- âœ… í•„ìˆ˜ DB ìµœì†Œ íŒ¨í‚¤ì§€ ì •ì˜
- âœ… DB ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸
- âœ… Decision Trace Step 4 (ì„¤ëª… ë¶„ê¸°)
- âœ… API ì‘ë‹µ í™•ì¥
- âœ… í”„ë¡ íŠ¸ ë…¸ì¶œ ê·œì¹™ (ì ìˆ˜ ì œê±°, ì„¤ëª…ë§Œ í‘œì‹œ)

---

## ğŸ“ˆ 22. ê²¬ì  ê³„ì‚° ìƒì„¸ íë¦„

### 22.1 ì „ì²´ íŒŒì´í”„ë¼ì¸

```
1. ì…ë ¥ ìˆ˜ì§‘ (CollectedInputV4)
   â”œâ”€ spaceInfo: ê³µê°„ ì •ë³´
   â”œâ”€ answers: ë‹µë³€
   â”œâ”€ preferences: ì„ í˜¸ë„
   â”œâ”€ selectedSpaces: ì„ íƒëœ ê³µê°„
   â””â”€ selectedProcesses: ì„ íƒëœ ê³µì •

2. V5 ë¶„ì„ (analyzeV5Complete)
   â””â”€ processChanges: ê³µì • ë³€ê²½ì‚¬í•­

3. V4 ê²¬ì  ê³„ì‚° (calculateEstimateV4ForUI)
   â”œâ”€ Step 1: ì„±í–¥ ë¶„ì„ (PersonalityEngineV4)
   â”œâ”€ Step 2: ì „ëµ ê²°ì • (StrategyEngineV4)
   â”‚   â”œâ”€ ë“±ê¸‰ ì„ íƒ (GradeSelector)
   â”‚   â””â”€ ê³µì • ì„ íƒ (ProcessPicker)
   â””â”€ Step 3: ê²¬ì  ê³„ì‚° (EstimateEngineV4)
       â””â”€ ê³µì •ë³„ ë¹„ìš© ê³„ì‚° (CostCalculator)
           â”œâ”€ ìì¬ ê°€ê²© ì¡°íšŒ (getMaterialPriceStrict)
           â””â”€ ë…¸ë¬´ë¹„ ì¡°íšŒ (getLaborRateStrict)

4. UI ì–´ëŒ‘í„° (adaptForUI)
   â””â”€ EstimateResultV4 â†’ UIEstimateV4

5. Decision Trace ì €ì¥
   â”œâ”€ v5_estimate_results: ê²¬ì  ìŠ¤ëƒ…ìƒ·
   â”œâ”€ v5_decision_impacts: ì˜í–¥ ì¶”ì 
   â””â”€ decision_explanation_split: ì„¤ëª… ë¶„ê¸°

6. ì‘ë‹µ ë°˜í™˜
   â””â”€ { result, decision_explanation_split }
```

---

### 22.2 ê³µì •ë³„ ë¹„ìš© ê³„ì‚° ìƒì„¸

**í•¨ìˆ˜**: `calculateProcessCosts(processId, spaceInfo, grade, selectedSpaces)`

**ë‹¨ê³„**:
1. ê³µì • ID â†’ í—Œë²• ProcessId ë§¤í•‘
2. ê³µê°„ ë§¤í•‘ (selectedSpaces í•„í„°ë§)
3. ìì¬ ë§¤í•‘ ì¡°íšŒ
4. ìˆ˜ëŸ‰ ê³„ì‚° (í‰ìˆ˜ ê¸°ë°˜)
5. ìì¬ ê°€ê²© ì¡°íšŒ (DB)
6. ë…¸ë¬´ ë§¤í•‘ ì¡°íšŒ
7. ë…¸ë¬´ë¹„ ì¡°íšŒ (DB)
8. ì‘ì—… ì¼ìˆ˜ ê³„ì‚°
9. ì´ ë…¸ë¬´ë¹„ ê³„ì‚°
10. ê²€ì¦ (ValidationGuard)
11. í•©ê³„ ê³„ì‚°

---

## ğŸ“Š 23. íŒŒì¼ í†µê³„

### 23.1 ê²¬ì  ì—”ì§„ íŒŒì¼

| ì¹´í…Œê³ ë¦¬ | íŒŒì¼ ìˆ˜ | ì£¼ìš” íŒŒì¼ |
|----------|---------|-----------|
| V4 ì—”ì§„ | 30+ | `lib/estimate-v4/` |
| ë ˆê±°ì‹œ ì—”ì§„ | 10+ | `lib/estimate/` |
| API ë¼ìš°íŠ¸ | 8 | `app/api/estimate/` |
| ë°ì´í„° íŒŒì¼ | 20+ | `lib/data/` |
| íƒ€ì… ì •ì˜ | 10+ | `lib/types/`, `lib/estimate-v4/types/` |
| ì„œë¹„ìŠ¤ | 4 | `lib/services/` |
| ì–´ëŒ‘í„° | 3 | `lib/db/adapters/` |

---

## ğŸ¯ 24. í•µì‹¬ ê³µì • ì •ì˜

### 24.1 í—Œë²• ProcessId (12ê°œ)

1. `demolition`: ì² ê±°
2. `finish`: ë§ˆê° (ë„ë°°/ë°”ë‹¥)
3. `electric`: ì¡°ëª…/ì „ê¸°
4. `kitchen`: ì£¼ë°©
5. `bathroom`: ìš•ì‹¤
6. `door`: ë¬¸
7. `window`: ì°½í˜¸
8. `storage`: ìˆ˜ë‚©
9. `waterproof`: ë°©ìˆ˜
10. `plumbing`: ì„¤ë¹„
11. `waste`: íê¸°ë¬¼
12. `SYSTEM`: ì‹œìŠ¤í…œ ë ˆë²¨ ê²€ì¦

---

### 24.2 í•„ìˆ˜ ê³µì • (Phase 1 ìµœì†Œ íŒ¨í‚¤ì§€)

1. `finish`: ë°”ë‹¥(ë§ˆê°) - í•„ìˆ˜
2. `bathroom`: ìš•ì‹¤ - í•„ìˆ˜
3. `kitchen`: ì£¼ë°© - í•„ìˆ˜

---

## ğŸ“‹ 25. DB í…Œì´ë¸” ìš”ì•½

### 25.1 ìì¬ ê´€ë ¨

| í…Œì´ë¸” | ìš©ë„ | í•„ìˆ˜ ì»¬ëŸ¼ |
|--------|------|-----------|
| `materials` | ìì¬ ì •ë³´ | category_1, category_2, price, is_argen_standard |
| `materials_pricing` | ìì¬ ê°€ê²© | grade, price_min, price_max |

---

### 25.2 ë…¸ë¬´ë¹„ ê´€ë ¨

| í…Œì´ë¸” | ìš©ë„ | í•„ìˆ˜ ì»¬ëŸ¼ |
|--------|------|-----------|
| `labor_productivity` | ë…¸ë¬´ ìƒì‚°ì„± | phase_id, daily_output, crew_size |
| `labor_costs` | ë…¸ë¬´ ë‹¨ê°€ | phase_id, rate_per_person_day |

---

### 25.3 ì² ê±° ê´€ë ¨

| í…Œì´ë¸” | ìš©ë„ |
|--------|------|
| `demolition_packages` | ì² ê±° íŒ¨í‚¤ì§€ |
| `demolition_items` | ì² ê±° í•­ëª© |
| `demolition_waste_config` | íê¸°ë¬¼ ì„¤ì • |
| `demolition_protection` | ë³´ì–‘ ì„¤ì • |

---

### 25.4 Decision Trace ê´€ë ¨

| í…Œì´ë¸” | ìš©ë„ |
|--------|------|
| `v5_question_logs` | ì§ˆë¬¸ ë¡œê·¸ |
| `v5_question_answers` | ë‹µë³€ ë¡œê·¸ |
| `v5_estimate_results` | ê²¬ì  ê²°ê³¼ ìŠ¤ëƒ…ìƒ· |
| `v5_decision_impacts` | ì§ˆë¬¸-ê²¬ì  ì˜í–¥ ì¶”ì  |

---

## ğŸ” 26. ì£¼ìš” í•¨ìˆ˜ ëª©ë¡

### 26.1 ê²¬ì  ê³„ì‚° í•¨ìˆ˜

| í•¨ìˆ˜ | íŒŒì¼ | ìš©ë„ |
|------|------|------|
| `calculateEstimateV4ForUI()` | `lib/estimate-v4/index.ts` | ë©”ì¸ ê²¬ì  ê³„ì‚° |
| `calculateEstimate()` | `lib/estimate-v4/engines/estimate/EstimateEngineV4.ts` | ê²¬ì  ì—”ì§„ |
| `calculateProcessCosts()` | `lib/estimate-v4/engines/estimate/CostCalculator.ts` | ê³µì •ë³„ ë¹„ìš© |
| `calculateFinalEstimateV1()` | `lib/estimate/constitution-v1-engine.ts` | í—Œë²• v1 ê²¬ì  |

---

### 26.2 ì„œë¹„ìŠ¤ í•¨ìˆ˜

| í•¨ìˆ˜ | íŒŒì¼ | ìš©ë„ |
|------|------|------|
| `getMaterialPriceStrict()` | `lib/services/material-service-strict.ts` | ìì¬ ê°€ê²© ì¡°íšŒ |
| `getLaborRateStrict()` | `lib/services/labor-service-strict.ts` | ë…¸ë¬´ë¹„ ì¡°íšŒ |

---

### 26.3 ì–´ëŒ‘í„° í•¨ìˆ˜

| í•¨ìˆ˜ | íŒŒì¼ | ìš©ë„ |
|------|------|------|
| `adaptForUI()` | `lib/estimate-v4/adapters/UIAdapter.ts` | UI í˜•ì‹ ë³€í™˜ |

---

## ğŸ“Š 27. ë°ì´í„° íë¦„ ë‹¤ì´ì–´ê·¸ë¨

```
[í”„ë¡ íŠ¸] /onboarding/estimate
    â†“
[API] POST /api/estimate/v4
    â†“
[V5 ë¶„ì„] analyzeV5Complete()
    â†“
[V4 ê²¬ì ] calculateEstimateV4ForUI()
    â”œâ”€ [ì„±í–¥] PersonalityEngineV4
    â”œâ”€ [ì „ëµ] StrategyEngineV4
    â””â”€ [ê²¬ì ] EstimateEngineV4
        â””â”€ [ë¹„ìš©] CostCalculator
            â”œâ”€ [ìì¬] getMaterialPriceStrict()
            â”‚   â””â”€ [DB] materials í…Œì´ë¸”
            â””â”€ [ë…¸ë¬´] getLaborRateStrict()
                â”œâ”€ [DB] labor_productivity í…Œì´ë¸”
                â””â”€ [DB] labor_costs í…Œì´ë¸”
    â†“
[ì–´ëŒ‘í„°] adaptForUI()
    â†“
[Decision Trace] ì €ì¥
    â”œâ”€ v5_estimate_results
    â”œâ”€ v5_decision_impacts
    â””â”€ decision_explanation_split
    â†“
[ì‘ë‹µ] { result, decision_explanation_split }
    â†“
[í”„ë¡ íŠ¸] ê²°ê³¼ í‘œì‹œ
```

---

## ğŸ¯ 28. í•µì‹¬ íŒŒì¼ ìš°ì„ ìˆœìœ„

### 28.1 ìµœìš°ì„  íŒŒì¼ (ê³µì‹ ê²¬ì  ê²½ë¡œ)

1. **`app/api/estimate/v4/route.ts`** - ê³µì‹ ê²¬ì  API
2. **`lib/estimate-v4/index.ts`** - ë©”ì¸ ê²¬ì  ê³„ì‚°
3. **`lib/estimate-v4/engines/estimate/EstimateEngineV4.ts`** - ê²¬ì  ì—”ì§„
4. **`lib/estimate-v4/engines/estimate/CostCalculator.ts`** - ë¹„ìš© ê³„ì‚°
5. **`lib/services/material-service-strict.ts`** - ìì¬ ì¡°íšŒ
6. **`lib/services/labor-service-strict.ts`** - ë…¸ë¬´ ì¡°íšŒ

---

### 28.2 ì¤‘ìš” íŒŒì¼ (íƒ€ì…/ì–´ëŒ‘í„°)

1. **`lib/types/í—Œë²•_ê²¬ì _íƒ€ì….ts`** - í—Œë²• íƒ€ì…
2. **`lib/estimate-v4/types/estimate.types.ts`** - V4 íƒ€ì…
3. **`lib/estimate-v4/adapters/UIAdapter.ts`** - UI ì–´ëŒ‘í„°

---

### 28.3 ì°¸ê³  íŒŒì¼ (ë ˆê±°ì‹œ)

1. **`lib/estimate/calculator-v3.ts`** - V3 ê³„ì‚°ê¸° (DEPRECATED)
2. **`lib/estimate/constitution-v1-engine.ts`** - í—Œë²• v1 ì—”ì§„
3. **`lib/data/estimate-master.json`** - ë§ˆìŠ¤í„° ë°ì´í„°

---

## ğŸ“‹ 29. ê³µì •ë³„ ìƒì„¸ ì •ë³´

### 29.1 ë°”ë‹¥(ë§ˆê°) - `finish`

**ìì¬**:
- `category_1 = 'ë°”ë‹¥'`
- `category_2 = 'ë§ˆë£¨'`
- ë“±ê¸‰: ARGEN_E ë˜ëŠ” ARGEN_S

**ë…¸ë¬´**:
- `phase_id = 'finish'`
- `labor_unit = 'm2'`
- `daily_output = 40`
- `crew_size = 2`

---

### 29.2 ìš•ì‹¤ - `bathroom`

**ìì¬**:
- `category_1 = 'ìš•ì‹¤'`
- `category_2 = 'ìš•ì‹¤ì„¸íŠ¸'`
- ë“±ê¸‰: ARGEN_E ë˜ëŠ” ARGEN_S

**ë…¸ë¬´**:
- `phase_id = 'bathroom'`
- `labor_unit = 'SET'`
- `daily_output = 0.7`
- `crew_size = 2`

---

### 29.3 ì£¼ë°© - `kitchen`

**ìì¬**:
- `category_1 = 'ì£¼ë°©'`
- `category_2 = 'ì‹œìŠ¤í…œì£¼ë°©'`
- ë“±ê¸‰: ARGEN_E ë˜ëŠ” ARGEN_S

**ë…¸ë¬´**:
- `phase_id = 'kitchen'`
- `labor_unit = 'SET'`
- `daily_output = 0.5`
- `crew_size = 2`

---

## ğŸ”’ 30. Phase 0/1 ë´‰ì¸ ìƒíƒœ ìš”ì•½

### 30.1 Phase 0 ë´‰ì¸

- âœ… êµ¬ë²„ì „ ë¼ìš°íŠ¸ ì°¨ë‹¨
- âœ… êµ¬ë²„ì „ API ì°¨ë‹¨
- âœ… DB ê²Œì´íŠ¸ (í•„ìˆ˜ ë°ì´í„° ì—†ìœ¼ë©´ BLOCK)

---

### 30.2 Phase 1 í™•ì¥

- âœ… í•„ìˆ˜ DB ìµœì†Œ íŒ¨í‚¤ì§€ ì •ì˜
- âœ… DB ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸
- âœ… Decision Trace Step 4
- âœ… API ì‘ë‹µ í™•ì¥
- âœ… í”„ë¡ íŠ¸ ë…¸ì¶œ ê·œì¹™

---

## ğŸ“Š 31. íŒŒì¼ í¬ê¸° ë° ë³µì¡ë„

### 31.1 ëŒ€í˜• íŒŒì¼ (500+ ë¼ì¸)

| íŒŒì¼ | ë¼ì¸ ìˆ˜ | ìš©ë„ |
|------|---------|------|
| `app/onboarding/estimate/page.tsx` | 1800+ | ê²¬ì  UI í˜ì´ì§€ |
| `lib/estimate/constitution-v1-engine.ts` | 2500+ | í—Œë²• v1 ì—”ì§„ |
| `lib/estimate-v4/engines/estimate/CostCalculator.ts` | 450+ | ë¹„ìš© ê³„ì‚°ê¸° |

---

## ğŸ¯ 32. ê²°ë¡ 

### 32.1 í˜„ì¬ ìƒíƒœ

- **ê³µì‹ ê²¬ì  ê²½ë¡œ**: `/onboarding/estimate` + `/api/estimate/v4`
- **ê²¬ì  ì—”ì§„**: V4 (`lib/estimate-v4/`)
- **ë°ì´í„° ì†ŒìŠ¤**: Supabase (DB ê¸°ë°˜)
- **Phase 0/1 ë´‰ì¸**: ì™„ë£Œ

---

### 32.2 ì£¼ìš” íŠ¹ì§•

1. **ë‹¤ì¤‘ ë²„ì „ ê³µì¡´**: V2, V3, V4, í—Œë²• v1 ëª¨ë‘ ì¡´ì¬
2. **DB ê¸°ë°˜**: í˜„ì¬ëŠ” Supabase ì‚¬ìš©
3. **Decision Trace**: ì™„ì „í•œ ì¶”ì  ì‹œìŠ¤í…œ êµ¬ì¶•
4. **Phase 0/1 ë´‰ì¸**: êµ¬ë²„ì „ ì°¨ë‹¨, í•„ìˆ˜ ë°ì´í„° ê²€ì¦

---

### 32.3 ê¶Œì¥ ì‚¬í•­

1. **ë ˆê±°ì‹œ ì •ë¦¬**: DEPRECATED íŒŒì¼ ì œê±° ê²€í† 
2. **DB ë°ì´í„° ë³´ì™„**: í•„ìˆ˜ DB ìµœì†Œ íŒ¨í‚¤ì§€ ì…ë ¥
3. **ë¬¸ì„œí™” ê°•í™”**: ê° ì—”ì§„ë³„ ìƒì„¸ ë¬¸ì„œ ì‘ì„±

---

**ë³´ê³ ì„œ ì‘ì„± ì™„ë£Œ** âœ…


