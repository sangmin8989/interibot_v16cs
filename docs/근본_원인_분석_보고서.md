# ì¸í…Œë¦¬ë´‡ ê²¬ì  ì‹œìŠ¤í…œ ê·¼ë³¸ ì›ì¸ ë¶„ì„ ë³´ê³ ì„œ

## ğŸ“‹ ê°œìš”

**ì‘ì„±ì¼**: 2024ë…„ 12ì›”  
**ë¶„ì„ ëŒ€ìƒ**: ìµœì¢… ê²¬ì  ì˜¤ë¥˜ ë° ìŠˆí¼ë² ì´ìŠ¤ DB ì¡°íšŒ ì‹¤íŒ¨ ë¬¸ì œ  
**ëª©ì **: ë‘ ê°€ì§€ í•µì‹¬ ë¬¸ì œì˜ ê·¼ë³¸ ì›ì¸ íŒŒì•…

---

## ğŸ”´ ë¬¸ì œ 1: ìµœì¢… ê²¬ì ì´ ê³ ê° ì…ë ¥ ì •ë³´ì™€ ë‹¤ë¥´ê²Œ ë‚˜ì˜´

### ê·¼ë³¸ ì›ì¸

#### 1. **ë°ì´í„° íë¦„ì´ ë„ˆë¬´ ë³µì¡í•¨ (Data Flow Complexity)**

**ë¬¸ì œì **:
```
ê³ ê° ì…ë ¥ (spaceInfo.pyeong)
  â†“
í‰ìˆ˜ ê³„ì‚° ë¡œì§ (ì—¬ëŸ¬ ë‹¨ê³„)
  â†“
finalPyForEstimate ë³€ìˆ˜
  â†“
ë¶ˆì¼ì¹˜ ê°ì§€ ë° ê°•ì œ ìˆ˜ì •
  â†“
baseInput.py
  â†“
API ì „ë‹¬
  â†“
calculator-v3.tsì—ì„œ py ì‚¬ìš©
```

**ë¬¸ì œ**:
- í‰ìˆ˜ê°€ ì—¬ëŸ¬ ë³€ìˆ˜(`py`, `finalPyForEstimate`, `baseInput.py`)ë¥¼ ê±°ì¹˜ë©´ì„œ ë³€ê²½ë  ìˆ˜ ìˆìŒ
- ë¶ˆì¼ì¹˜ ê°ì§€ ë¡œì§ì´ ìˆì§€ë§Œ, ì´ë¯¸ APIì— ì „ë‹¬ëœ í›„ì¼ ìˆ˜ ìˆìŒ
- ê° ë‹¨ê³„ì—ì„œ í‰ìˆ˜ê°€ ì¬ê³„ì‚°ë˜ê±°ë‚˜ ë³€ê²½ë  ìˆ˜ ìˆìŒ

**ìœ„ì¹˜**: `app/onboarding/estimate/page.tsx` (443-525ì¤„, 799-815ì¤„)

---

#### 2. **í‰ìˆ˜ ê³„ì‚° ë¡œì§ì˜ ê³¼ë„í•œ ë³µì¡ì„±**

**í˜„ì¬ ë¡œì§**:
```typescript
// 1ë‹¨ê³„: spaceInfo.pyeong í™•ì¸
if (spaceInfo.pyeong && spaceInfo.pyeong > 0) {
  py = spaceInfo.pyeong
  finalPyForEstimate = spaceInfo.pyeong
}

// 2ë‹¨ê³„: approximateRange fallback
else if (spaceInfo.approximateRange) {
  py = approximateToActual[spaceInfo.approximateRange] || 32
  finalPyForEstimate = py
}

// 3ë‹¨ê³„: ë¶ˆì¼ì¹˜ ê°ì§€ ë° ê°•ì œ ìˆ˜ì •
if (spaceInfo.pyeong && spaceInfo.pyeong > 0 && finalPyForEstimate !== spaceInfo.pyeong) {
  finalPyForEstimate = spaceInfo.pyeong
  py = spaceInfo.pyeong
}
```

**ë¬¸ì œ**:
- í‰ìˆ˜ ê³„ì‚°ì´ 3ë‹¨ê³„ë¡œ ë‚˜ë‰˜ì–´ ìˆì–´ì„œ ì¤‘ê°„ì— ë³€ê²½ë  ìˆ˜ ìˆìŒ
- ë¶ˆì¼ì¹˜ ê°ì§€ ë¡œì§ì´ ìˆì§€ë§Œ, ì´ë¯¸ ë‹¤ë¥¸ ê³³ì—ì„œ ì‚¬ìš©ëœ í›„ì¼ ìˆ˜ ìˆìŒ
- `calculatedPy` ìƒíƒœ ë³€ìˆ˜ë„ ìˆì–´ì„œ ë” ë³µì¡í•¨

**ìœ„ì¹˜**: `app/onboarding/estimate/page.tsx` (448-525ì¤„)

---

#### 3. **ê³µì • ì„ íƒ ë¡œì§ì˜ ë³µì¡ì„±**

**í˜„ì¬ ë¡œì§**:
```
1. ì„ íƒëœ ê³µê°„ í•„í„°ë§
2. ê³ ê° ì •ë³´ ê¸°ë°˜ ìë™ ê³µì • ì¶”ê°€
3. mergedProcessesBySpace ë³‘í•©
4. processSelectionsì—ì„œ ê³µì • ì¶”ì¶œ (Bì•ˆ)
5. tierSelectionsì—ì„œ ê³µì • ì¶”ì¶œ (Aì•ˆ)
6. ê³µê°„ ê¸°ë°˜ ê³µì • ì¶”ë¡  (3ì°¨ fallback)
```

**ë¬¸ì œ**:
- ê³µì • ì¶”ì¶œ ê²½ë¡œê°€ 3ê°œë‚˜ ìˆì–´ì„œ ì˜ˆìƒì¹˜ ëª»í•œ ê³µì •ì´ í¬í•¨ë˜ê±°ë‚˜ ëˆ„ë½ë  ìˆ˜ ìˆìŒ
- ê° ê²½ë¡œì˜ ìš°ì„ ìˆœìœ„ê°€ ëª…í™•í•˜ì§€ ì•ŠìŒ
- ê³ ê°ì´ ì„ íƒí•œ ê³µì •ê³¼ ì‹¤ì œ ê³„ì‚°ì— ì‚¬ìš©ëœ ê³µì •ì´ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ

**ìœ„ì¹˜**: `app/onboarding/estimate/page.tsx` (615-780ì¤„)

---

### í•´ê²° ë°©ì•ˆ

#### Priority 1: í‰ìˆ˜ ê³„ì‚° ë‹¨ìˆœí™”

**ì›ì¹™**: ì…ë ¥í•œ í‰ìˆ˜ë¥¼ ì ˆëŒ€ ë³€ê²½í•˜ì§€ ì•ŠìŒ

```typescript
// âœ… ë‹¨ìˆœí™”ëœ ë¡œì§
let finalPyForEstimate = spaceInfo.pyeong || 0

// approximateRangeëŠ” fallbackìœ¼ë¡œë§Œ ì‚¬ìš© (ì…ë ¥í•œ í‰ìˆ˜ê°€ ì—†ì„ ë•Œë§Œ)
if (finalPyForEstimate <= 0 && spaceInfo.approximateRange) {
  const approximateToActual: Record<string, number> = {
    '20í‰ëŒ€': 22,
    '30í‰ëŒ€': 32, 
    '40í‰ëŒ€': 42,
    '50í‰ ì´ìƒ': 55
  }
  finalPyForEstimate = approximateToActual[spaceInfo.approximateRange] || 32
}

// ê²€ì¦
if (finalPyForEstimate <= 0) {
  setError('í‰ìˆ˜ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.')
  return
}

// âœ… ì´í›„ ì ˆëŒ€ ë³€ê²½í•˜ì§€ ì•ŠìŒ
// ë¶ˆì¼ì¹˜ ê°ì§€ ë¡œì§ ì œê±° (ë¶ˆí•„ìš”)
```

---

#### Priority 2: ê³µì • ì„ íƒ ë¡œì§ ë‹¨ìˆœí™”

**ì›ì¹™**: processSelections ìš°ì„ , tierSelections fallback

```typescript
// âœ… ë‹¨ìˆœí™”ëœ ë¡œì§
let enabledProcessIds: string[] = []

// 1ìˆœìœ„: processSelectionsì—ì„œ ì¶”ì¶œ
if (mergedProcessesBySpace && Object.keys(mergedProcessesBySpace).length > 0) {
  enabledProcessIds = extractFromProcessSelections(mergedProcessesBySpace)
}

// 2ìˆœìœ„: tierSelectionsì—ì„œ ì¶”ì¶œ (processSelections ì—†ì„ ë•Œë§Œ)
if (enabledProcessIds.length === 0 && tierSelections) {
  enabledProcessIds = extractFromTierSelections(tierSelections)
}

// 3ì°¨ fallback ì œê±° (ë³µì¡ì„± ì¦ê°€)
```

---

## ğŸ”´ ë¬¸ì œ 2: ìŠˆí¼ë² ì´ìŠ¤ DBë¥¼ ì œëŒ€ë¡œ ëª» ê°€ì ¸ì˜´

### ê·¼ë³¸ ì›ì¸

#### 1. **Fallbackì´ ë„ˆë¬´ ë¹¨ë¦¬ ì‘ë™í•¨ (Premature Fallback)**

**ë¬¸ì œì **:
```typescript
// lib/db/adapters/demolition-adapter.ts (76-78ì¤„)
if (!process.env.NEXT_PUBLIC_SUPABASE_URL || !process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY) {
  console.warn('âš ï¸ Supabase í™˜ê²½ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. Fallback ì‚¬ìš©')
  return null  // âŒ ë°”ë¡œ null ë°˜í™˜, DB ì¡°íšŒ ì‹œë„ì¡°ì°¨ ì•ˆ í•¨
}
```

**ë¬¸ì œ**:
- í™˜ê²½ ë³€ìˆ˜ê°€ ì—†ìœ¼ë©´ DB ì¡°íšŒë¥¼ ì‹œë„ì¡°ì°¨ í•˜ì§€ ì•Šê³  ë°”ë¡œ null ë°˜í™˜
- í™˜ê²½ ë³€ìˆ˜ê°€ ìˆì–´ë„ DB ì¡°íšŒ ì‹¤íŒ¨ ì‹œ ë°”ë¡œ null ë°˜í™˜í•˜ê³  fallback ì‚¬ìš©
- ì‹¤ì œ DB ì—°ê²° ë¬¸ì œì¸ì§€, í™˜ê²½ ë³€ìˆ˜ ë¬¸ì œì¸ì§€ êµ¬ë¶„í•˜ì§€ ì•ŠìŒ

**ìœ„ì¹˜**: `lib/db/adapters/demolition-adapter.ts` (76-107ì¤„)

---

#### 2. **ì—ëŸ¬ ì²˜ë¦¬ê°€ ë„ˆë¬´ ê´€ëŒ€í•¨ (Too Lenient Error Handling)**

**ë¬¸ì œì **:
```typescript
// lib/db/adapters/demolition-adapter.ts (92-95ì¤„)
if (error) {
  console.error('âŒ ì „ì²´ ì² ê±° íŒ¨í‚¤ì§€ ì¡°íšŒ ì—ëŸ¬:', error)
  return null  // âŒ ì—ëŸ¬ë¥¼ ë¬´ì‹œí•˜ê³  null ë°˜í™˜
}

if (!data) {
  console.warn(`âš ï¸ ${pyeong}í‰ ${propertyType} ì „ì²´ ì² ê±° íŒ¨í‚¤ì§€ ì—†ìŒ`)
  return null  // âŒ ë°ì´í„° ì—†ìŒë„ null ë°˜í™˜
}
```

**ë¬¸ì œ**:
- DB ì¡°íšŒ ì—ëŸ¬ë¥¼ ë¡œê·¸ë§Œ ë‚¨ê¸°ê³  ì‹¤ì œë¡œëŠ” ë¬´ì‹œí•¨
- ë°ì´í„°ê°€ ì—†ì„ ë•Œì™€ ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ë•Œë¥¼ êµ¬ë¶„í•˜ì§€ ì•ŠìŒ
- ì‹¤ì œ ë¬¸ì œ(ì—°ê²° ì‹¤íŒ¨, ê¶Œí•œ ë¬¸ì œ, í…Œì´ë¸” ì—†ìŒ ë“±)ë¥¼ íŒŒì•…í•˜ì§€ ëª»í•¨

**ìœ„ì¹˜**: `lib/db/adapters/demolition-adapter.ts` (92-100ì¤„)

---

#### 3. **Fallback ë¡œì§ì´ ë„ˆë¬´ ì‰½ê²Œ ì‘ë™í•¨ (Easy Fallback)**

**ë¬¸ì œì **:
```typescript
// lib/data/pricing-v3/demolition-packages.ts (31-44ì¤„)
export async function getFullDemolitionPackagePrice(
  pyeong: number,
  propertyType: string = 'apartment'
): Promise<number> {
  try {
    // 1. DBì—ì„œ ì¡°íšŒ ì‹œë„
    const packageData = await getFullDemolitionPackageFromDB(pyeong, propertyType)
    if (packageData) {
      return packageData.total_price
    }

    // 2. Fallback: Config ê¸°ë°˜ ê³„ì‚° (âŒ ë„ˆë¬´ ì‰½ê²Œ fallback ì‚¬ìš©)
    console.warn(`âš ï¸ ${pyeong}í‰ ì „ì²´ ì² ê±° íŒ¨í‚¤ì§€ DB ì—†ìŒ, Fallback ì‚¬ìš©`)
    return calculateFromConfig(pyeong, propertyType)
  } catch (err: any) {
    console.error('âŒ getFullDemolitionPackagePrice ì—ëŸ¬:', err)
    return calculateFromConfig(pyeong, propertyType)  // âŒ ì—ëŸ¬ ë°œìƒ ì‹œ ë¬´ì¡°ê±´ fallback
  }
}
```

**ë¬¸ì œ**:
- DB ì¡°íšŒê°€ ì‹¤íŒ¨í•˜ë©´ ë°”ë¡œ fallback ì‚¬ìš©
- ì‹¤ì œ DB ë¬¸ì œ(ì—°ê²° ì‹¤íŒ¨, ê¶Œí•œ ë¬¸ì œ ë“±)ë¥¼ í•´ê²°í•˜ì§€ ì•Šê³  fallbackìœ¼ë¡œ íšŒí”¼
- ì‚¬ìš©ìëŠ” DB ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ëŠ”ì§€ fallback ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ëŠ”ì§€ ì•Œ ìˆ˜ ì—†ìŒ

**ìœ„ì¹˜**: `lib/data/pricing-v3/demolition-packages.ts` (27-45ì¤„)

---

#### 4. **í™˜ê²½ ë³€ìˆ˜ ì²´í¬ê°€ ë„ˆë¬´ ì—„ê²©í•¨ (Too Strict Environment Check)**

**ë¬¸ì œì **:
```typescript
// lib/db/adapters/demolition-adapter.ts (76-78ì¤„)
if (!process.env.NEXT_PUBLIC_SUPABASE_URL || !process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY) {
  console.warn('âš ï¸ Supabase í™˜ê²½ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. Fallback ì‚¬ìš©')
  return null  // âŒ í™˜ê²½ ë³€ìˆ˜ ì—†ìœ¼ë©´ ë°”ë¡œ null ë°˜í™˜
}
```

**ë¬¸ì œ**:
- í™˜ê²½ ë³€ìˆ˜ê°€ ì—†ìœ¼ë©´ DB ì¡°íšŒë¥¼ ì‹œë„ì¡°ì°¨ í•˜ì§€ ì•ŠìŒ
- í™˜ê²½ ë³€ìˆ˜ê°€ ëŸ°íƒ€ì„ì— ì„¤ì •ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ë„ ìˆìŒ (Next.js ë¹Œë“œ íƒ€ì„ vs ëŸ°íƒ€ì„)
- ì‹¤ì œë¡œëŠ” í™˜ê²½ ë³€ìˆ˜ê°€ ìˆëŠ”ë° ì²´í¬ ë¡œì§ì´ ì˜ëª»ë˜ì–´ ìˆì„ ìˆ˜ ìˆìŒ

**ìœ„ì¹˜**: `lib/db/adapters/demolition-adapter.ts` (76-78ì¤„)

---

### í•´ê²° ë°©ì•ˆ

#### Priority 1: DB ì¡°íšŒ ì‹¤íŒ¨ ì‹œ ìƒì„¸ ì—ëŸ¬ ë¡œê¹…

**ì›ì¹™**: ì—ëŸ¬ë¥¼ ë¬´ì‹œí•˜ì§€ ë§ê³  ìƒì„¸íˆ ë¡œê¹…í•˜ê³ , ì‹¤ì œ ë¬¸ì œë¥¼ íŒŒì•…

```typescript
// âœ… ê°œì„ ëœ ì—ëŸ¬ ì²˜ë¦¬
export async function getFullDemolitionPackageFromDB(
  pyeong: number,
  propertyType: string = 'apartment'
): Promise<DemolitionPackage | null> {
  try {
    // í™˜ê²½ ë³€ìˆ˜ ì²´í¬ (ê²½ê³ ë§Œ, null ë°˜í™˜í•˜ì§€ ì•ŠìŒ)
    if (!process.env.NEXT_PUBLIC_SUPABASE_URL || !process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY) {
      console.error('âŒ Supabase í™˜ê²½ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', {
        hasUrl: !!process.env.NEXT_PUBLIC_SUPABASE_URL,
        hasKey: !!process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY
      })
      // âŒ ë°”ë¡œ null ë°˜í™˜í•˜ì§€ ë§ê³ , ì‹¤ì œ DB ì¡°íšŒ ì‹œë„ (ì—ëŸ¬ë¡œ ì‹¤íŒ¨í•  ê²ƒ)
    }

    // âœ… ì‹¤ì œ DB ì¡°íšŒ ì‹œë„
    const { data, error } = await supabase
      .from('demolition_packages')
      .select('*')
      .eq('property_type', propertyType)
      .eq('is_active', true)
      .lte('pyeong', pyeong)
      .order('pyeong', { ascending: false })
      .limit(1)
      .maybeSingle()

    // âœ… ìƒì„¸ ì—ëŸ¬ ë¡œê¹…
    if (error) {
      console.error('âŒ ì „ì²´ ì² ê±° íŒ¨í‚¤ì§€ ì¡°íšŒ ì—ëŸ¬:', {
        code: error.code,
        message: error.message,
        details: error.details,
        hint: error.hint,
        pyeong,
        propertyType
      })
      // âŒ ë°”ë¡œ null ë°˜í™˜í•˜ì§€ ë§ê³ , ì—ëŸ¬ ì •ë³´ë¥¼ í¬í•¨í•´ì„œ ë°˜í™˜í•˜ê±°ë‚˜ throw
      throw new Error(`DB ì¡°íšŒ ì‹¤íŒ¨: ${error.message}`)
    }

    if (!data) {
      console.warn(`âš ï¸ ${pyeong}í‰ ${propertyType} ì „ì²´ ì² ê±° íŒ¨í‚¤ì§€ ì—†ìŒ (ë°ì´í„° ì—†ìŒ)`)
      return null  // âœ… ë°ì´í„° ì—†ìŒì€ ì •ìƒì ì¸ ê²½ìš° (null ë°˜í™˜ OK)
    }

    console.log(`âœ… ì „ì²´ ì² ê±° íŒ¨í‚¤ì§€ ì¡°íšŒ ì„±ê³µ: ${pyeong}í‰ â†’ ${data.package_name}`)
    return data as DemolitionPackage
  } catch (err: any) {
    // âœ… ìƒì„¸ ì—ëŸ¬ ë¡œê¹…
    console.error('âŒ getFullDemolitionPackageFromDB ì˜ˆì™¸ ë°œìƒ:', {
      name: err?.name,
      message: err?.message,
      stack: err?.stack,
      pyeong,
      propertyType
    })
    // âŒ ë°”ë¡œ null ë°˜í™˜í•˜ì§€ ë§ê³ , ì—ëŸ¬ë¥¼ ë‹¤ì‹œ throwí•˜ê±°ë‚˜ ìƒì„¸ ì •ë³´ì™€ í•¨ê»˜ ë°˜í™˜
    throw err
  }
}
```

---

#### Priority 2: Fallback ë¡œì§ ê°œì„ 

**ì›ì¹™**: DB ì¡°íšŒë¥¼ ìµœëŒ€í•œ ì‹œë„í•˜ê³ , ëª…í™•í•œ ì‹¤íŒ¨ ì‹œì—ë§Œ fallback ì‚¬ìš©

```typescript
// âœ… ê°œì„ ëœ Fallback ë¡œì§
export async function getFullDemolitionPackagePrice(
  pyeong: number,
  propertyType: string = 'apartment'
): Promise<number> {
  try {
    // 1. DBì—ì„œ ì¡°íšŒ ì‹œë„
    const packageData = await getFullDemolitionPackageFromDB(pyeong, propertyType)
    if (packageData) {
      console.log(`âœ… DBì—ì„œ ì¡°íšŒ ì„±ê³µ: ${packageData.total_price.toLocaleString()}ì›`)
      return packageData.total_price
    }

    // 2. Fallback ì‚¬ìš© (ëª…í™•í•œ ê²½ìš°ì—ë§Œ)
    console.warn(`âš ï¸ ${pyeong}í‰ ${propertyType} ì „ì²´ ì² ê±° íŒ¨í‚¤ì§€ DBì— ì—†ìŒ, Fallback ì‚¬ìš©`)
    const fallbackPrice = calculateFromConfig(pyeong, propertyType)
    console.log(`âš ï¸ Fallback ê°€ê²©: ${fallbackPrice.toLocaleString()}ì›`)
    return fallbackPrice
  } catch (err: any) {
    // âœ… DB ì—°ê²° ì‹¤íŒ¨ ë“± ì‹¤ì œ ì—ëŸ¬ì¸ ê²½ìš°
    console.error('âŒ getFullDemolitionPackagePrice DB ì¡°íšŒ ì‹¤íŒ¨:', {
      error: err.message,
      pyeong,
      propertyType
    })
    
    // âœ… Fallback ì‚¬ìš© (í•˜ì§€ë§Œ ê²½ê³  ë¡œê·¸ ë‚¨ê¹€)
    const fallbackPrice = calculateFromConfig(pyeong, propertyType)
    console.warn(`âš ï¸ DB ì¡°íšŒ ì‹¤íŒ¨ë¡œ Fallback ì‚¬ìš©: ${fallbackPrice.toLocaleString()}ì›`)
    return fallbackPrice
  }
}
```

---

#### Priority 3: í™˜ê²½ ë³€ìˆ˜ ì²´í¬ ê°œì„ 

**ì›ì¹™**: í™˜ê²½ ë³€ìˆ˜ ì²´í¬ë¥¼ ì™„í™”í•˜ê³ , ì‹¤ì œ DB ì¡°íšŒ ì‹œë„ í›„ ì—ëŸ¬ ì²˜ë¦¬

```typescript
// âœ… ê°œì„ ëœ í™˜ê²½ ë³€ìˆ˜ ì²´í¬
export async function getFullDemolitionPackageFromDB(
  pyeong: number,
  propertyType: string = 'apartment'
): Promise<DemolitionPackage | null> {
  try {
    // âœ… í™˜ê²½ ë³€ìˆ˜ ì²´í¬ (ê²½ê³ ë§Œ, ì¡°íšŒëŠ” ì‹œë„)
    const hasEnvVars = process.env.NEXT_PUBLIC_SUPABASE_URL && process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY
    if (!hasEnvVars) {
      console.error('âŒ Supabase í™˜ê²½ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', {
        hasUrl: !!process.env.NEXT_PUBLIC_SUPABASE_URL,
        hasKey: !!process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,
        nodeEnv: process.env.NODE_ENV
      })
      // âŒ ë°”ë¡œ null ë°˜í™˜í•˜ì§€ ë§ê³ , ì‹¤ì œ DB ì¡°íšŒ ì‹œë„ (ì—ëŸ¬ë¡œ ì‹¤íŒ¨í•  ê²ƒ)
    }

    // âœ… ì‹¤ì œ DB ì¡°íšŒ ì‹œë„ (í™˜ê²½ ë³€ìˆ˜ ì—†ì–´ë„ ì‹œë„)
    const { data, error } = await supabase
      .from('demolition_packages')
      // ...
```

---

## ğŸ¯ ì¢…í•© í•´ê²° ë°©ì•ˆ

### 1. ë°ì´í„° íë¦„ ë‹¨ìˆœí™”

**ì›ì¹™**: ì…ë ¥ê°’ì„ ì ˆëŒ€ ë³€ê²½í•˜ì§€ ì•Šê³ , ë‹¨ì¼ ê²½ë¡œë¡œ ì „ë‹¬

```typescript
// âœ… ë‹¨ìˆœí™”ëœ ë°ì´í„° íë¦„
const inputPy = spaceInfo.pyeong || getApproximatePyeong(spaceInfo.approximateRange)
const baseInput = {
  py: inputPy,  // âœ… ì…ë ¥ê°’ ê·¸ëŒ€ë¡œ ì‚¬ìš©, ì ˆëŒ€ ë³€ê²½í•˜ì§€ ì•ŠìŒ
  // ...
}
```

---

### 2. DB ì¡°íšŒ ì‹¤íŒ¨ ì‹œ ëª…í™•í•œ ì—ëŸ¬ ì²˜ë¦¬

**ì›ì¹™**: ì—ëŸ¬ë¥¼ ë¬´ì‹œí•˜ì§€ ë§ê³ , ìƒì„¸íˆ ë¡œê¹…í•˜ê³ , ì‹¤ì œ ë¬¸ì œë¥¼ íŒŒì•…

```typescript
// âœ… ê°œì„ ëœ ì—ëŸ¬ ì²˜ë¦¬
try {
  const data = await getDataFromDB()
  if (!data) {
    // ë°ì´í„° ì—†ìŒ (ì •ìƒì ì¸ ê²½ìš°)
    return null
  }
  return data
} catch (error) {
  // âœ… ì‹¤ì œ ì—ëŸ¬ (ì—°ê²° ì‹¤íŒ¨, ê¶Œí•œ ë¬¸ì œ ë“±)
  console.error('âŒ DB ì¡°íšŒ ì‹¤íŒ¨:', {
    code: error.code,
    message: error.message,
    details: error.details
  })
  throw error  // âœ… ì—ëŸ¬ë¥¼ ë‹¤ì‹œ throwí•˜ì—¬ ìƒìœ„ì—ì„œ ì²˜ë¦¬
}
```

---

### 3. Fallback ë¡œì§ ê°œì„ 

**ì›ì¹™**: DB ì¡°íšŒë¥¼ ìµœëŒ€í•œ ì‹œë„í•˜ê³ , ëª…í™•í•œ ì‹¤íŒ¨ ì‹œì—ë§Œ fallback ì‚¬ìš©

```typescript
// âœ… ê°œì„ ëœ Fallback ë¡œì§
try {
  const dbData = await getDataFromDB()
  if (dbData) {
    return dbData
  }
  // ë°ì´í„° ì—†ìŒ (ì •ìƒì ì¸ ê²½ìš°) â†’ Fallback ì‚¬ìš©
  return getFallbackData()
} catch (error) {
  // âœ… ì‹¤ì œ ì—ëŸ¬ì¸ ê²½ìš°ì—ë„ Fallback ì‚¬ìš© (í•˜ì§€ë§Œ ê²½ê³  ë¡œê·¸)
  console.error('âŒ DB ì¡°íšŒ ì‹¤íŒ¨, Fallback ì‚¬ìš©:', error)
  return getFallbackData()
}
```

---

## ğŸ“Š ìš°ì„ ìˆœìœ„ë³„ ìˆ˜ì • ê³„íš

### Priority 1 (ì¦‰ì‹œ ìˆ˜ì •)
1. âœ… í‰ìˆ˜ ê³„ì‚° ë¡œì§ ë‹¨ìˆœí™”
2. âœ… DB ì¡°íšŒ ì‹¤íŒ¨ ì‹œ ìƒì„¸ ì—ëŸ¬ ë¡œê¹…

### Priority 2 (ë‹¨ê¸° ìˆ˜ì •)
1. âœ… ê³µì • ì„ íƒ ë¡œì§ ë‹¨ìˆœí™”
2. âœ… Fallback ë¡œì§ ê°œì„ 

### Priority 3 (ì¤‘ê¸° ìˆ˜ì •)
1. âœ… í™˜ê²½ ë³€ìˆ˜ ì²´í¬ ê°œì„ 
2. âœ… ë°ì´í„° íë¦„ ë‹¨ìˆœí™”

---

## ğŸ¯ ê²°ë¡ 

### ê·¼ë³¸ ì›ì¸ ìš”ì•½

1. **ìµœì¢… ê²¬ì  ì˜¤ë¥˜**: ë°ì´í„° íë¦„ì´ ë„ˆë¬´ ë³µì¡í•˜ê³ , í‰ìˆ˜ ê³„ì‚° ë¡œì§ì´ ê³¼ë„í•˜ê²Œ ë³µì¡í•¨
2. **ìŠˆí¼ë² ì´ìŠ¤ DB ì¡°íšŒ ì‹¤íŒ¨**: Fallbackì´ ë„ˆë¬´ ë¹¨ë¦¬ ì‘ë™í•˜ê³ , ì—ëŸ¬ ì²˜ë¦¬ê°€ ë„ˆë¬´ ê´€ëŒ€í•¨

### í•´ê²° ë°©í–¥

1. **ë‹¨ìˆœí™”**: ë³µì¡í•œ ë¡œì§ì„ ë‹¨ìˆœí™”í•˜ê³ , ë°ì´í„° íë¦„ì„ ëª…í™•íˆ í•¨
2. **ëª…í™•í•œ ì—ëŸ¬ ì²˜ë¦¬**: ì—ëŸ¬ë¥¼ ë¬´ì‹œí•˜ì§€ ë§ê³ , ìƒì„¸íˆ ë¡œê¹…í•˜ê³ , ì‹¤ì œ ë¬¸ì œë¥¼ íŒŒì•…
3. **Fallback ê°œì„ **: DB ì¡°íšŒë¥¼ ìµœëŒ€í•œ ì‹œë„í•˜ê³ , ëª…í™•í•œ ì‹¤íŒ¨ ì‹œì—ë§Œ fallback ì‚¬ìš©

---

## ğŸ“… ì‘ì„±ì¼
2024ë…„ 12ì›”

## ğŸ“Œ ë²„ì „
V3 (calculator-v3.ts ê¸°ì¤€)









