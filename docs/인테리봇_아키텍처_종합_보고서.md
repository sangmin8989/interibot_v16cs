# ì¸í…Œë¦¬ë´‡ ì•„í‚¤í…ì²˜ ì¢…í•© ë³´ê³ ì„œ

> **ì‘ì„±ì¼**: 2025-01-21  
> **ì‘ì„±ì**: ì¸í…Œë¦¬ë´‡ ì•„í‚¤í…ì²˜ ì´ ì±…ì„ì  
> **í”„ë¡œì íŠ¸**: Argen Interibot  
> **ë²„ì „**: 0.1.0

---

## ğŸ“‹ ëª©ì°¨

1. [í”„ë¡œì íŠ¸ ê°œìš”](#1-í”„ë¡œì íŠ¸-ê°œìš”)
2. [ì „ì²´ í´ë” ë° íŒŒì¼ êµ¬ì¡°](#2-ì „ì²´-í´ë”-ë°-íŒŒì¼-êµ¬ì¡°)
3. [ê³ ê° ì„±í–¥ ë¶„ì„ í”Œë¡œìš°](#3-ê³ ê°-ì„±í–¥-ë¶„ì„-í”Œë¡œìš°)
4. [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#4-ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
5. [ì£¼ìš” ì»´í¬ë„ŒíŠ¸ ìƒì„¸](#5-ì£¼ìš”-ì»´í¬ë„ŒíŠ¸-ìƒì„¸)
6. [ë°ì´í„° íë¦„](#6-ë°ì´í„°-íë¦„)
7. [API êµ¬ì¡°](#7-api-êµ¬ì¡°)

---

## 1. í”„ë¡œì íŠ¸ ê°œìš”

### 1.1 ê¸°ìˆ  ìŠ¤íƒ

| ì¹´í…Œê³ ë¦¬ | ê¸°ìˆ  | ë²„ì „ | ìš©ë„ |
|---------|------|------|------|
| **í”„ë ˆì„ì›Œí¬** | Next.js | 14.0.0 | App Router ê¸°ë°˜ í’€ìŠ¤íƒ í”„ë ˆì„ì›Œí¬ |
| **ì–¸ì–´** | TypeScript | 5.0.0 | íƒ€ì… ì•ˆì •ì„± ë³´ì¥ |
| **ìŠ¤íƒ€ì¼ë§** | Tailwind CSS | 3.3.0 | ìœ í‹¸ë¦¬í‹° ê¸°ë°˜ CSS |
| **ìƒíƒœ ê´€ë¦¬** | Zustand | 5.0.8 | í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ ê´€ë¦¬ |
| **ì• ë‹ˆë©”ì´ì…˜** | Framer Motion | 10.18.0 | UI ì• ë‹ˆë©”ì´ì…˜ |
| **AI** | OpenAI API | 4.20.0 | GPT-4, GPT-4o-mini, DALLÂ·E 3 |
| **ë°ì´í„°ë² ì´ìŠ¤** | Supabase | 2.89.0 | PostgreSQL ê¸°ë°˜ ë°±ì—”ë“œ |
| **ORM** | Prisma | 7.0.0 | ë°ì´í„°ë² ì´ìŠ¤ ORM |
| **ì•„ì´ì½˜** | Lucide React | 0.554.0 | ì•„ì´ì½˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ |

### 1.2 í”„ë¡œì íŠ¸ ëª©ì 

ì¸í…Œë¦¬ë´‡ì€ **AI ê¸°ë°˜ ì¸í…Œë¦¬ì–´ ìƒë‹´ ë° ê²¬ì  ì‹œìŠ¤í…œ**ìœ¼ë¡œ, ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤:

- **ê³ ê° ì„±í–¥ ë¶„ì„**: ëŒ€í™”í˜• ì§ˆë¬¸ì„ í†µí•œ ì¸í…Œë¦¬ì–´ ì„±í–¥ íŒŒì•…
- **ìŠ¤íƒ€ì¼ ì¶”ì²œ**: AI ê¸°ë°˜ ì¸í…Œë¦¬ì–´ ìŠ¤íƒ€ì¼ ë§¤ì¹­
- **ê³µì • ì¶”ì²œ**: ê³ ê° ì„±í–¥ì— ë§ëŠ” ê³µì‚¬ ê³µì • ì¶”ì²œ
- **ê²¬ì  ê³„ì‚°**: ì‹¤ì‹œê°„ ìì¬ ë° ê³µì‚¬ë¹„ ê²¬ì 
- **ì´ë¯¸ì§€ ìƒì„±**: DALLÂ·E 3 ê¸°ë°˜ ì¸í…Œë¦¬ì–´ ì‹œë®¬ë ˆì´ì…˜

---

## 2. ì „ì²´ í´ë” ë° íŒŒì¼ êµ¬ì¡°

### 2.1 ë£¨íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
interibot/
â”œâ”€â”€ app/                          # Next.js App Router (í˜ì´ì§€ ë° API)
â”‚   â”œâ”€â”€ api/                      # API ë¼ìš°íŠ¸ (45ê°œ íŒŒì¼)
â”‚   â”œâ”€â”€ onboarding/               # ì˜¨ë³´ë”© í”Œë¡œìš° (8ê°œ í˜ì´ì§€)
â”‚   â”œâ”€â”€ v5/                       # V5 Ultimate í”Œë¡œìš° (7ê°œ í˜ì´ì§€)
â”‚   â”œâ”€â”€ result/                   # ê²°ê³¼ í˜ì´ì§€
â”‚   â”œâ”€â”€ estimate/                 # ê²¬ì  í˜ì´ì§€
â”‚   â”œâ”€â”€ layout.tsx                # ë£¨íŠ¸ ë ˆì´ì•„ì›ƒ
â”‚   â””â”€â”€ page.tsx                  # í™ˆ í˜ì´ì§€
â”‚
â”œâ”€â”€ components/                   # React ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ v5-ultimate/              # V5 Ultimate ì „ìš© ì»´í¬ë„ŒíŠ¸ (9ê°œ)
â”‚   â”œâ”€â”€ v5/                       # V5 ì „ìš© ì»´í¬ë„ŒíŠ¸ (10ê°œ)
â”‚   â”œâ”€â”€ onboarding/               # ì˜¨ë³´ë”© ì»´í¬ë„ŒíŠ¸ (15ê°œ)
â”‚   â”œâ”€â”€ analysis/                 # ë¶„ì„ ì»´í¬ë„ŒíŠ¸ (5ê°œ)
â”‚   â”œâ”€â”€ estimate/                 # ê²¬ì  ì»´í¬ë„ŒíŠ¸ (8ê°œ)
â”‚   â””â”€â”€ landing/                  # ëœë”© í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ (4ê°œ)
â”‚
â”œâ”€â”€ lib/                          # í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚   â”œâ”€â”€ analysis/                 # ë¶„ì„ ì—”ì§„ (117ê°œ íŒŒì¼)
â”‚   â”‚   â”œâ”€â”€ v5-ultimate/          # V5 Ultimate ì—”ì§„ (9ê°œ)
â”‚   â”‚   â”œâ”€â”€ v5/                   # V5 ì—”ì§„ (37ê°œ)
â”‚   â”‚   â”œâ”€â”€ engine-v3/            # V3 ì—”ì§„ (6ê°œ)
â”‚   â”‚   â””â”€â”€ engine-v3.1-core/     # V3.1 Core ì—”ì§„
â”‚   â”œâ”€â”€ estimate/                 # ê²¬ì  ê³„ì‚° (13ê°œ)
â”‚   â”œâ”€â”€ estimate-v4/              # V4 ê²¬ì  ì—”ì§„ (34ê°œ)
â”‚   â”œâ”€â”€ store/                    # Zustand ìƒíƒœ ê´€ë¦¬ (6ê°œ)
â”‚   â”œâ”€â”€ api/                      # API ìœ í‹¸ë¦¬í‹° (1ê°œ)
â”‚   â”œâ”€â”€ data/                     # ì •ì  ë°ì´í„° (48ê°œ)
â”‚   â””â”€â”€ utils/                    # ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ (19ê°œ)
â”‚
â”œâ”€â”€ constants/                    # ìƒìˆ˜ ì •ì˜
â”‚   â”œâ”€â”€ process-definitions.ts    # ê³µì • ì •ì˜
â”‚   â”œâ”€â”€ processes.ts              # ê³µì • ëª©ë¡
â”‚   â””â”€â”€ spaces.ts                 # ê³µê°„ ì •ì˜
â”‚
â”œâ”€â”€ types/                        # TypeScript íƒ€ì… ì •ì˜
â”‚   â”œâ”€â”€ estimate.ts               # ê²¬ì  íƒ€ì…
â”‚   â”œâ”€â”€ image-generation.ts        # ì´ë¯¸ì§€ ìƒì„± íƒ€ì…
â”‚   â””â”€â”€ process-options.ts        # ê³µì • ì˜µì…˜ íƒ€ì…
â”‚
â”œâ”€â”€ prisma/                       # Prisma ìŠ¤í‚¤ë§ˆ
â”‚   â”œâ”€â”€ schema.prisma             # ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ
â”‚   â””â”€â”€ dev.db                    # SQLite ê°œë°œ DB
â”‚
â”œâ”€â”€ docs/                         # ë¬¸ì„œ (229ê°œ íŒŒì¼)
â”‚   â”œâ”€â”€ *.md                      # ë§ˆí¬ë‹¤ìš´ ë¬¸ì„œ (179ê°œ)
â”‚   â””â”€â”€ *.sql                     # SQL ìŠ¤í¬ë¦½íŠ¸ (49ê°œ)
â”‚
â”œâ”€â”€ scripts/                      # ìŠ¤í¬ë¦½íŠ¸ (18ê°œ)
â”‚   â”œâ”€â”€ *.ts                      # TypeScript ìŠ¤í¬ë¦½íŠ¸ (14ê°œ)
â”‚   â””â”€â”€ *.js                      # JavaScript ìŠ¤í¬ë¦½íŠ¸ (2ê°œ)
â”‚
â”œâ”€â”€ tests/                        # í…ŒìŠ¤íŠ¸ íŒŒì¼
â”‚   â””â”€â”€ v5/                       # V5 í…ŒìŠ¤íŠ¸ (10ê°œ)
â”‚
â””â”€â”€ assets/                       # ì •ì  ìì› (ì´ë¯¸ì§€ ë“±)
```

### 2.2 ì£¼ìš” ë””ë ‰í† ë¦¬ ìƒì„¸

#### 2.2.1 `app/` - Next.js App Router

**í˜ì´ì§€ êµ¬ì¡°**:
```
app/
â”œâ”€â”€ page.tsx                      # í™ˆ (ëœë”© í˜ì´ì§€)
â”œâ”€â”€ layout.tsx                    # ë£¨íŠ¸ ë ˆì´ì•„ì›ƒ
â”œâ”€â”€ globals.css                   # ì „ì—­ ìŠ¤íƒ€ì¼
â”‚
â”œâ”€â”€ onboarding/                   # ì˜¨ë³´ë”© í”Œë¡œìš°
â”‚   â”œâ”€â”€ personality/              # ì„±í–¥ ë¶„ì„ í˜ì´ì§€
â”‚   â”œâ”€â”€ scope/                    # ê³µì‚¬ ë²”ìœ„ ì„ íƒ
â”‚   â”œâ”€â”€ process/                  # ê³µì • ì„ íƒ (êµ¬ë²„ì „)
â”‚   â”œâ”€â”€ process-new/              # ê³µì • ì„ íƒ (ì‹ ë²„ì „)
â”‚   â”œâ”€â”€ detail-options/           # ì„¸ë¶€ ì˜µì…˜ ì„ íƒ
â”‚   â”œâ”€â”€ ai-recommendation/        # AI ì¶”ì²œ
â”‚   â”œâ”€â”€ ai-scope-recommendation/  # AI ë²”ìœ„ ì¶”ì²œ
â”‚   â””â”€â”€ estimate/                 # ê²¬ì  ê²°ê³¼
â”‚
â”œâ”€â”€ v5/                           # V5 Ultimate í”Œë¡œìš°
â”‚   â”œâ”€â”€ page.tsx                  # V5 ë©”ì¸ (ìŠ¤í… ê´€ë¦¬)
â”‚   â”œâ”€â”€ process-select/           # ê³µì • ì„ íƒ
â”‚   â”œâ”€â”€ process-detail/           # ê³µì • ìƒì„¸
â”‚   â”œâ”€â”€ options/                  # ì˜µì…˜ ì„ íƒ
â”‚   â”œâ”€â”€ additional-options/       # ì¶”ê°€ ì˜µì…˜
â”‚   â”œâ”€â”€ analysis-phase2/          # 2ì°¨ ë¶„ì„
â”‚   â””â”€â”€ dna-result-2/            # 2ì°¨ DNA ê²°ê³¼
â”‚
â”œâ”€â”€ result/                       # ê²°ê³¼ í˜ì´ì§€
â”‚   â”œâ”€â”€ page.tsx                  # ê²°ê³¼ ë©”ì¸
â”‚   â”œâ”€â”€ ResultContent.tsx        # ê²°ê³¼ ì½˜í…ì¸ 
â”‚   â””â”€â”€ v5/                       # V5 ê²°ê³¼
â”‚
â””â”€â”€ api/                          # API ë¼ìš°íŠ¸ (45ê°œ)
    â”œâ”€â”€ v5/                       # V5 API
    â”‚   â”œâ”€â”€ analyze/
    â”‚   â”‚   â”œâ”€â”€ chat/route.ts     # ì±„íŒ… ë¶„ì„
    â”‚   â”‚   â”œâ”€â”€ photo/route.ts     # ì‚¬ì§„ ë¶„ì„
    â”‚   â”‚   â””â”€â”€ fusion/route.ts   # í†µí•© ë¶„ì„
    â”‚   â””â”€â”€ generate-question/route.ts
    â”‚
    â”œâ”€â”€ analysis/                 # ë¶„ì„ API
    â”‚   â”œâ”€â”€ submit/route.ts       # ë¶„ì„ ì œì¶œ
    â”‚   â”œâ”€â”€ preference/route.ts    # ì„ í˜¸ë„ ë¶„ì„
    â”‚   â””â”€â”€ v5/route.ts           # V5 ë¶„ì„
    â”‚
    â”œâ”€â”€ analyze/                  # ë¶„ì„ ì²˜ë¦¬
    â”‚   â”œâ”€â”€ complete/route.ts     # ì™„ë£Œ ë¶„ì„
    â”‚   â”œâ”€â”€ preference/route.ts   # ì„ í˜¸ë„
    â”‚   â”œâ”€â”€ vision/route.ts       # ë¹„ì „ ë¶„ì„
    â”‚   â””â”€â”€ v31/route.ts          # V31 ë¶„ì„
    â”‚
    â”œâ”€â”€ estimate/                 # ê²¬ì  API
    â”‚   â”œâ”€â”€ calculate/route.ts     # ê²¬ì  ê³„ì‚°
    â”‚   â”œâ”€â”€ materials/route.ts     # ìì¬ ê²¬ì 
    â”‚   â”œâ”€â”€ labor/route.ts         # ì¸ê±´ë¹„
    â”‚   â”œâ”€â”€ v3/route.ts            # V3 ê²¬ì 
    â”‚   â””â”€â”€ v4/route.ts            # V4 ê²¬ì 
    â”‚
    â”œâ”€â”€ generate-questions/       # ì§ˆë¬¸ ìƒì„±
    â”‚   â”œâ”€â”€ route.ts               # ê¸°ë³¸ ì§ˆë¬¸ ìƒì„±
    â”‚   â””â”€â”€ v5/route.ts            # V5 ì§ˆë¬¸ ìƒì„±
    â”‚
    â”œâ”€â”€ image/                     # ì´ë¯¸ì§€ ìƒì„±
    â”‚   â”œâ”€â”€ generate/route.ts      # ì´ë¯¸ì§€ ìƒì„±
    â”‚   â””â”€â”€ prompt/route.ts        # í”„ë¡¬í”„íŠ¸ ìƒì„±
    â”‚
    â”œâ”€â”€ recommend/                 # ì¶”ì²œ API
    â”‚   â”œâ”€â”€ process/route.ts       # ê³µì • ì¶”ì²œ
    â”‚   â””â”€â”€ argen/route.ts        # ì•„ë¥´ì   ì¶”ì²œ
    â”‚
    â””â”€â”€ kpi/                       # KPI ì¶”ì 
        â”œâ”€â”€ events/route.ts        # ì´ë²¤íŠ¸ ë¡œê¹…
        â””â”€â”€ session/[sessionId]/route.ts
```

#### 2.2.2 `lib/analysis/` - ë¶„ì„ ì—”ì§„

**V5 Ultimate ì—”ì§„** (`lib/analysis/v5-ultimate/`):
```
v5-ultimate/
â”œâ”€â”€ question-engine.ts            # ì§ˆë¬¸ ìƒì„± ì—”ì§„
â”œâ”€â”€ prompts.ts                    # AI í”„ë¡¬í”„íŠ¸
â”œâ”€â”€ types.ts                      # íƒ€ì… ì •ì˜
â”œâ”€â”€ analyzers/
â”‚   â”œâ”€â”€ chat-analyzer.ts          # ì±„íŒ… ë¶„ì„
â”‚   â”œâ”€â”€ photo-analyzer.ts         # ì‚¬ì§„ ë¶„ì„
â”‚   â””â”€â”€ fusion-analyzer.ts        # í†µí•© ë¶„ì„
â””â”€â”€ ...
```

**V5 ì—”ì§„** (`lib/analysis/v5/`):
```
v5/
â”œâ”€â”€ index.ts                      # ë©”ì¸ ì—”ì§„
â”œâ”€â”€ question-selector.ts          # ì§ˆë¬¸ ì„ ë³„
â”œâ”€â”€ hypothesis-generator.ts       # ê°€ì„¤ ìƒì„±
â”œâ”€â”€ tag-confirmer.ts             # íƒœê·¸ í™•ì •
â”œâ”€â”€ process-mapper.ts             # ê³µì • ë§¤í•‘
â”œâ”€â”€ guards/                       # ê°€ë“œ í•¨ìˆ˜
â”‚   â”œâ”€â”€ input-guard.ts            # ì…ë ¥ ê²€ì¦
â”‚   â””â”€â”€ reproducibility-guard.ts  # ì¬í˜„ì„± ë³´ì¥
â”œâ”€â”€ audit/                        # ê°ì‚¬ ë¡œê·¸
â”‚   â””â”€â”€ audit-logger.ts
â””â”€â”€ ...
```

**V3 ì—”ì§„** (`lib/analysis/engine-v3/`):
```
engine-v3/
â”œâ”€â”€ index.ts                      # V3Engine í´ë˜ìŠ¤
â”œâ”€â”€ engines/
â”‚   â”œâ”€â”€ TraitEngine.ts            # ì„±í–¥ ì—”ì§„
â”‚   â”œâ”€â”€ StyleEngine.ts            # ìŠ¤íƒ€ì¼ ì—”ì§„
â”‚   â”œâ”€â”€ ProcessEngine.ts          # ê³µì • ì—”ì§„
â”‚   â””â”€â”€ ...
â””â”€â”€ services/
    â””â”€â”€ ...
```

#### 2.2.3 `lib/store/` - ìƒíƒœ ê´€ë¦¬

```
store/
â”œâ”€â”€ v5UltimateStore.ts            # V5 Ultimate ìƒíƒœ
â”œâ”€â”€ personalityStore.ts           # ì„±í–¥ ë¶„ì„ ìƒíƒœ
â”œâ”€â”€ personalityV5.store.ts       # V5 ì„±í–¥ ìƒíƒœ
â”œâ”€â”€ processStore.ts               # ê³µì • ì„ íƒ ìƒíƒœ
â”œâ”€â”€ scopeStore.ts                 # ë²”ìœ„ ì„ íƒ ìƒíƒœ
â””â”€â”€ spaceInfoStore.ts             # ê³µê°„ ì •ë³´ ìƒíƒœ
```

#### 2.2.4 `components/v5-ultimate/` - V5 Ultimate ì»´í¬ë„ŒíŠ¸

```
v5-ultimate/
â”œâ”€â”€ ChatOnboarding.tsx             # ì±„íŒ… ì˜¨ë³´ë”© (ì§ˆë¬¸/ë‹µë³€)
â”œâ”€â”€ StyleSelector.tsx             # ìŠ¤íƒ€ì¼ ì„ íƒ
â”œâ”€â”€ PhotoUploader.tsx              # ì‚¬ì§„ ì—…ë¡œë“œ
â”œâ”€â”€ SpaceInfoForm.tsx             # ê³µê°„ ì •ë³´ ì…ë ¥
â”œâ”€â”€ DNAResultDisplay.tsx          # DNA ê²°ê³¼ í‘œì‹œ
â”œâ”€â”€ SixIndexDashboard.tsx          # 6ê°€ì§€ ì§€ìˆ˜ ëŒ€ì‹œë³´ë“œ
â”œâ”€â”€ AnalyzingLoader.tsx           # ë¶„ì„ ì¤‘ ë¡œë”
â”œâ”€â”€ GradeSelector.tsx             # ë“±ê¸‰ ì„ íƒ
â””â”€â”€ ShareButtons.tsx              # ê³µìœ  ë²„íŠ¼
```

---

## 3. ê³ ê° ì„±í–¥ ë¶„ì„ í”Œë¡œìš°

### 3.1 V5 Ultimate í”Œë¡œìš° (ìµœì‹  ë²„ì „)

**ì „ì²´ í”Œë¡œìš°**:
```
[1] ì§‘ ì •ë³´ ì…ë ¥ (SpaceInfoForm)
    â†“
[2] ìŠ¤íƒ€ì¼ ì„ íƒ (StyleSelector)
    â†“
[3] ì„±í–¥ ë¶„ì„ 1ì°¨ - ì±„íŒ… ì˜¨ë³´ë”© (ChatOnboarding)
    â”œâ”€ ì²« ì§ˆë¬¸: ê³ ì • ì§ˆë¬¸ ("ì–´ë–¤ ê³µê°„ì„ ê°€ì¥ ë°”ê¾¸ê³  ì‹¶ìœ¼ì„¸ìš”?")
    â”œâ”€ 2~5ë²ˆì§¸ ì§ˆë¬¸: AI ìƒì„± (temperature: 0.7)
    â””â”€ ì§ˆë¬¸ ì—”ì§„: lib/analysis/v5-ultimate/question-engine.ts
    â†“
[4] ë¶„ì„ ì¤‘ (AnalyzingLoader)
    â”œâ”€ API: /api/v5/analyze/fusion
    â”œâ”€ ì±„íŒ… ë¶„ì„ + ìŠ¤íƒ€ì¼ ë¶„ì„ í†µí•©
    â””â”€ FusionAnalysisResult ìƒì„±
    â†“
[5] DNA ê²°ê³¼ 1ì°¨ (DNAResultDisplay)
    â”œâ”€ 6ê°€ì§€ ì§€ìˆ˜ í‘œì‹œ
    â”œâ”€ DNA ìœ í˜• í‘œì‹œ
    â””â”€ íƒœê·¸ ë° ì„¤ëª…
    â†“
[6] ê³µì • ì„ íƒ (process-select)
    â†“
[7] ê³µì • ìƒì„¸ (process-detail)
    â†“
[8] ì˜µì…˜ ì„ íƒ (options)
    â†“
[9] ì¶”ê°€ ì˜µì…˜ (additional-options)
    â†“
[10] 2ì°¨ ë¶„ì„ (analysis-phase2)
    â†“
[11] DNA ê²°ê³¼ 2ì°¨ (dna-result-2)
    â†“
[12] ìµœì¢… ê²¬ì  ë° ë¦¬í¬íŠ¸
```

**ìƒì„¸ ë‹¨ê³„ë³„ ì„¤ëª…**:

#### Step 1: ì§‘ ì •ë³´ ì…ë ¥
- **íŒŒì¼**: `components/v5-ultimate/SpaceInfoForm.tsx`
- **ì €ì¥ì†Œ**: `useSpaceInfoStore`
- **ë°ì´í„°**: `housingType`, `pyeong`, `rooms`, `bathrooms`

#### Step 2: ìŠ¤íƒ€ì¼ ì„ íƒ
- **íŒŒì¼**: `components/v5-ultimate/StyleSelector.tsx`
- **ì €ì¥ì†Œ**: `useV5UltimateStore` (ë¡œì»¬ ìƒíƒœ)
- **ê²°ê³¼**: `StyleResult` (styleTag, keywords)

#### Step 3: ì„±í–¥ ë¶„ì„ 1ì°¨ - ì±„íŒ… ì˜¨ë³´ë”©
- **íŒŒì¼**: `components/v5-ultimate/ChatOnboarding.tsx`
- **ì—”ì§„**: `lib/analysis/v5-ultimate/question-engine.ts`
- **API**: `/api/v5/generate-question` (ì§ˆë¬¸ ìƒì„±)
- **í”„ë¡œì„¸ìŠ¤**:
  1. ì²« ì§ˆë¬¸: `getFixedFirstQuestions()` - ê³ ì • ì§ˆë¬¸ ë°˜í™˜ (AI í˜¸ì¶œ ì—†ìŒ)
  2. 2~5ë²ˆì§¸ ì§ˆë¬¸: `generateQuestion()` - AI ìƒì„± (temperature: 0.7)
  3. ì‚¬ìš©ì ë‹µë³€ ìˆ˜ì§‘: `ChatMessage[]` í˜•íƒœë¡œ ì €ì¥
  4. 5ê°œ ì§ˆë¬¸ ì™„ë£Œ ì‹œ `handleChatComplete()` í˜¸ì¶œ

#### Step 4: ë¶„ì„ ì¤‘
- **API**: `/api/v5/analyze/fusion`
- **íŒŒì¼**: `app/api/v5/analyze/fusion/route.ts`
- **í”„ë¡œì„¸ìŠ¤**:
  1. `styleResult` + `chatData` ìˆ˜ì‹ 
  2. `convertToChatAnalysis()` - ìŠ¤íƒ€ì¼ â†’ ì±„íŒ… ë¶„ì„ ë³€í™˜
  3. `FusionAnalyzer` ì‹¤í–‰
  4. `FusionAnalysisResult` ìƒì„±:
     - `dna`: DNA ìœ í˜• ë° ì„¤ëª…
     - `tags`: ì„±í–¥ íƒœê·¸ ë°°ì—´
     - `sixIndices`: 6ê°€ì§€ ì§€ìˆ˜ (ì‹¤ìš©ì„±, ë¯¸ë‹ˆë©€, ìì—°, ëª¨ë˜, í´ë˜ì‹, ì˜ˆì‚°)
     - `confidence`: ì‹ ë¢°ë„

#### Step 5: DNA ê²°ê³¼ 1ì°¨
- **íŒŒì¼**: `components/v5-ultimate/DNAResultDisplay.tsx`
- **í‘œì‹œ ë‚´ìš©**:
  - DNA ìœ í˜• (ì˜ˆ: "ì‹¤ìš©ì£¼ì˜ì", "ë¯¸ë‹ˆë©€ë¦¬ìŠ¤íŠ¸")
  - 6ê°€ì§€ ì§€ìˆ˜ ëŒ€ì‹œë³´ë“œ
  - íƒœê·¸ ëª©ë¡
  - ì„¤ëª… í…ìŠ¤íŠ¸

### 3.2 ê¸°ì¡´ ì˜¨ë³´ë”© í”Œë¡œìš° (ë ˆê±°ì‹œ)

**ì „ì²´ í”Œë¡œìš°**:
```
[1] ì§‘ ì •ë³´ ì…ë ¥ (space-info)
    â†“
[2] ì„±í–¥ ë¶„ì„ (personality)
    â”œâ”€ ëª¨ë“œ ì„ íƒ: quick / standard / deep / vibe
    â”œâ”€ ì§ˆë¬¸ ë‹µë³€ ìˆ˜ì§‘
    â””â”€ API: /api/analysis/submit
    â†“
[3] ê³µì‚¬ ë²”ìœ„ ì„ íƒ (scope)
    â†“
[4] ê³µì • ì„ íƒ (process)
    â†“
[5] AI ì¶”ì²œ (ai-recommendation)
    â†“
[6] ì„¸ë¶€ ì˜µì…˜ (detail-options)
    â†“
[7] ê²¬ì  ê²°ê³¼ (estimate)
```

**ì„±í–¥ ë¶„ì„ ì—”ì§„**:
- **V3 ì—”ì§„**: `lib/analysis/engine-v3/`
- **V4 ì—”ì§„**: `lib/estimate-v4/engines/personality/`
- **V5 ì—”ì§„**: `lib/analysis/v5/`

### 3.3 ì§ˆë¬¸ ìƒì„± ë¡œì§

#### V5 Ultimate ì§ˆë¬¸ ì—”ì§„ (`lib/analysis/v5-ultimate/question-engine.ts`)

**ì£¼ìš” í•¨ìˆ˜**:

1. **`getFixedFirstQuestions()`**
   - ì²« ì§ˆë¬¸ ê³ ì • ë°˜í™˜
   - AI í˜¸ì¶œ ì—†ìŒ
   - ë°˜í™˜ê°’: `{ question: string, quickReplies: string[] }`

2. **`generateQuestion()`**
   - 2~5ë²ˆì§¸ ì§ˆë¬¸ AI ìƒì„±
   - ì…ë ¥: `messages`, `photoAnalysis`, `styleResult`, `spaceInfo`
   - í”„ë¡œì„¸ìŠ¤:
     - `analyzeMissingInfo()` - ëˆ„ë½ ì •ë³´ íŒŒì•… (ì‹¤ì œ ë°ì´í„° ê¸°ë°˜)
     - `formatMissingInfo()` - ëˆ„ë½ ì •ë³´ í…ìŠ¤íŠ¸ ë³€í™˜
     - OpenAI API í˜¸ì¶œ (temperature: 0.7)
     - JSON íŒŒì‹± ë° ë°˜í™˜

3. **`analyzeMissingInfo()`**
   - ì‹¤ì œ ë°ì´í„° ì¡´ì¬ ì—¬ë¶€ ê¸°ì¤€ íŒë‹¨
   - `userMessages.length` ê¸°ë°˜ ì œê±°
   - ëŒ€í™” ë‚´ìš© ë¶„ì„ìœ¼ë¡œ ì •ë³´ ì¶”ì¶œ

4. **`getFallbackQuestion()`**
   - AI í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ fallback
   - ì²« ì§ˆë¬¸ ì œì™¸ (ì´ë¯¸ ê³ ì • ì§ˆë¬¸ìœ¼ë¡œ ì²˜ë¦¬)

**í”„ë¡¬í”„íŠ¸ ì‹œìŠ¤í…œ**:
- **TONE_LOCKED_SYSTEM_PROMPT**: ì§ˆë¬¸ í†¤ ë´‰ì¸ (15ì ì´ë‚´, ì¹œêµ¬ì²˜ëŸ¼ í¸í•˜ê²Œ)

---

## 4. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### 4.1 ì „ì²´ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    í´ë¼ì´ì–¸íŠ¸ (Next.js)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   Pages      â”‚  â”‚  Components  â”‚  â”‚    Store     â”‚       â”‚
â”‚  â”‚  (App Router)â”‚  â”‚  (React)     â”‚  â”‚  (Zustand)   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                 â”‚                  â”‚                â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                            â”‚                                   â”‚
â”‚                            â–¼                                   â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                    â”‚  API Routes  â”‚                           â”‚
â”‚                    â”‚  (Next.js)   â”‚                           â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ì„œë²„ (Next.js API)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Analysis    â”‚  â”‚   Estimate   â”‚  â”‚   AI Call    â”‚       â”‚
â”‚  â”‚   Engines     â”‚  â”‚  Calculators â”‚  â”‚   Limiter    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                 â”‚                  â”‚                â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                            â”‚                                   â”‚
â”‚                            â–¼                                   â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                    â”‚  OpenAI API  â”‚                           â”‚
â”‚                    â”‚  (GPT-4o-mini)â”‚                          â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ì™¸ë¶€ ì„œë¹„ìŠ¤                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   Supabase   â”‚  â”‚   Prisma     â”‚  â”‚   Vercel     â”‚       â”‚
â”‚  â”‚  (Database)  â”‚  â”‚    (ORM)     â”‚  â”‚  (Deploy)    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ë ˆì´ì–´ êµ¬ì¡°

#### Layer 1: Presentation Layer (UI)
- **ìœ„ì¹˜**: `app/`, `components/`
- **ì—­í• **: ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ ë Œë”ë§
- **ê¸°ìˆ **: React, Next.js App Router, Tailwind CSS

#### Layer 2: State Management Layer
- **ìœ„ì¹˜**: `lib/store/`
- **ì—­í• **: í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ ê´€ë¦¬
- **ê¸°ìˆ **: Zustand (persist ë¯¸ë“¤ì›¨ì–´)

#### Layer 3: API Layer
- **ìœ„ì¹˜**: `app/api/`
- **ì—­í• **: API ì—”ë“œí¬ì¸íŠ¸ ì œê³µ
- **ê¸°ìˆ **: Next.js API Routes

#### Layer 4: Business Logic Layer
- **ìœ„ì¹˜**: `lib/analysis/`, `lib/estimate/`
- **ì—­í• **: í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
- **êµ¬ì„±**:
  - ë¶„ì„ ì—”ì§„ (V3, V4, V5, V5 Ultimate)
  - ê²¬ì  ê³„ì‚°ê¸° (V3, V4)
  - ì§ˆë¬¸ ì—”ì§„
  - íƒœê·¸ í™•ì • ë¡œì§

#### Layer 5: Data Layer
- **ìœ„ì¹˜**: `lib/data/`, `prisma/`
- **ì—­í• **: ì •ì  ë°ì´í„° ë° ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼
- **ê¸°ìˆ **: Prisma ORM, Supabase

#### Layer 6: External Services
- **OpenAI API**: AI ë¶„ì„ ë° ì´ë¯¸ì§€ ìƒì„±
- **Supabase**: ë°ì´í„°ë² ì´ìŠ¤
- **Vercel**: ë°°í¬ í”Œë«í¼

### 4.3 ë°ì´í„° íë¦„

#### V5 Ultimate ë°ì´í„° íë¦„

```
ì‚¬ìš©ì ì…ë ¥
    â†“
[SpaceInfoForm] â†’ spaceInfoStore
    â†“
[StyleSelector] â†’ ë¡œì»¬ ìƒíƒœ (styleResult)
    â†“
[ChatOnboarding] â†’ v5UltimateStore (chatHistory)
    â†“
ì§ˆë¬¸ ìƒì„± ìš”ì²­ â†’ /api/v5/generate-question
    â†“
[question-engine.ts] â†’ OpenAI API
    â†“
ì§ˆë¬¸ ë°˜í™˜ â†’ ChatOnboarding
    â†“
ë‹µë³€ ìˆ˜ì§‘ â†’ chatHistory ì—…ë°ì´íŠ¸
    â†“
5ê°œ ì§ˆë¬¸ ì™„ë£Œ â†’ /api/v5/analyze/fusion
    â†“
[fusion-analyzer.ts] â†’ FusionAnalysisResult
    â†“
v5UltimateStore ì—…ë°ì´íŠ¸
    â†“
[DNAResultDisplay] â†’ ê²°ê³¼ í‘œì‹œ
    â†“
localStorage ì €ì¥ (schemaVersion: '5.0')
    â†“
ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™
```

### 4.4 ìƒíƒœ ê´€ë¦¬ êµ¬ì¡°

#### Zustand Store êµ¬ì¡°

**v5UltimateStore** (`lib/store/v5UltimateStore.ts`):
```typescript
interface V5UltimateStore {
  // State
  sessionId: string | null;
  currentStep: 'intro' | 'spaceInfo' | 'mood' | 'chat' | 'analyzing' | 'result';
  uploadedPhoto: { url: string; file: File | null; analysis: PhotoAnalysisResult | null } | null;
  chatHistory: ChatMessage[];
  chatAnalysis: ChatAnalysisResult | null;
  fusionResult: FusionAnalysisResult | null;
  isLoading: boolean;
  error: string | null;
  
  // Actions
  initSession(): void;
  setStep(step: V5UltimateState['currentStep']): void;
  addChatMessage(message: ChatMessage): void;
  setFusionResult(result: FusionAnalysisResult): void;
  reset(): void;
}
```

**spaceInfoStore** (`lib/store/spaceInfoStore.ts`):
```typescript
interface SpaceInfoStore {
  spaceInfo: {
    housingType?: string;
    pyeong?: number;
    rooms?: number;
    bathrooms?: number;
    budget?: string;
  } | null;
  setSpaceInfo(info: SpaceInfo): void;
  clearSpaceInfo(): void;
}
```

**persist ì„¤ì •**:
- `v5UltimateStore`: `sessionId`, `currentStep`, `fusionResult`ë§Œ ì €ì¥
- `spaceInfoStore`: ì „ì²´ `spaceInfo` ì €ì¥

---

## 5. ì£¼ìš” ì»´í¬ë„ŒíŠ¸ ìƒì„¸

### 5.1 V5 Ultimate ë©”ì¸ í˜ì´ì§€

**íŒŒì¼**: `app/v5/page.tsx`

**ì—­í• **: V5 Ultimate í”Œë¡œìš°ì˜ ìŠ¤í… ê´€ë¦¬ì

**ì£¼ìš” í•¨ìˆ˜**:
- `handleStyleComplete()`: ìŠ¤íƒ€ì¼ ì„ íƒ ì™„ë£Œ â†’ ì±„íŒ… ë‹¨ê³„ë¡œ ì´ë™
- `handleChatComplete()`: ì±„íŒ… ì™„ë£Œ â†’ ë¶„ì„ API í˜¸ì¶œ â†’ ê²°ê³¼ ë‹¨ê³„ë¡œ ì´ë™
- `handleResultNext()`: DNA ê²°ê³¼ ì™„ë£Œ â†’ ê³µì • ì„ íƒìœ¼ë¡œ ì´ë™

**ìŠ¤í… ê´€ë¦¬**:
```typescript
type Step = 'intro' | 'spaceInfo' | 'mood' | 'chat' | 'analyzing' | 'result';
```

### 5.2 ì±„íŒ… ì˜¨ë³´ë”© ì»´í¬ë„ŒíŠ¸

**íŒŒì¼**: `components/v5-ultimate/ChatOnboarding.tsx`

**ì—­í• **: ì§ˆë¬¸/ë‹µë³€ ì¸í„°í˜ì´ìŠ¤ ì œê³µ

**ì£¼ìš” ê¸°ëŠ¥**:
- ì§ˆë¬¸ í‘œì‹œ (ì• ë‹ˆë©”ì´ì…˜)
- ë¹ ë¥¸ ë‹µë³€ ë²„íŠ¼
- ë‹µë³€ ìˆ˜ì§‘ ë° ì €ì¥
- ë‹¤ìŒ ì§ˆë¬¸ ìë™ ë¡œë“œ
- 5ê°œ ì§ˆë¬¸ ì™„ë£Œ ì‹œ `onComplete` ì½œë°±

**ì§ˆë¬¸ ë¡œë“œ í”„ë¡œì„¸ìŠ¤**:
1. `loadNextQuestion()` í˜¸ì¶œ
2. `/api/v5/generate-question` API í˜¸ì¶œ
3. `generateQuestion()` ì‹¤í–‰ (question-engine.ts)
4. ì§ˆë¬¸ ë°˜í™˜ ë° í‘œì‹œ

### 5.3 DNA ê²°ê³¼ í‘œì‹œ ì»´í¬ë„ŒíŠ¸

**íŒŒì¼**: `components/v5-ultimate/DNAResultDisplay.tsx`

**ì—­í• **: ë¶„ì„ ê²°ê³¼ ì‹œê°í™”

**í‘œì‹œ ë‚´ìš©**:
- DNA ìœ í˜• (ì œëª©)
- 6ê°€ì§€ ì§€ìˆ˜ ëŒ€ì‹œë³´ë“œ (ì›í˜• ì°¨íŠ¸)
- íƒœê·¸ ëª©ë¡
- ì„¤ëª… í…ìŠ¤íŠ¸
- ë‹¤ìŒ ë‹¨ê³„ ë²„íŠ¼

### 5.4 ì§ˆë¬¸ ì—”ì§„

**íŒŒì¼**: `lib/analysis/v5-ultimate/question-engine.ts`

**ì£¼ìš” í•¨ìˆ˜**:

1. **`getFixedFirstQuestions()`**
   ```typescript
   function getFixedFirstQuestions(): { question: string; quickReplies: string[] }
   ```
   - ì²« ì§ˆë¬¸ ê³ ì • ë°˜í™˜
   - AI í˜¸ì¶œ ì—†ìŒ

2. **`generateQuestion()`**
   ```typescript
   export async function generateQuestion(
     messages: ChatMessage[],
     photoAnalysis: PhotoAnalysisResult | null,
     styleResult?: { styleTag?: string; keywords?: string[] } | null,
     spaceInfo?: { housingType?: string; pyeong?: number; rooms?: number; bathrooms?: number } | null
   ): Promise<{ question: string; quickReplies: string[] } | null>
   ```
   - 2~5ë²ˆì§¸ ì§ˆë¬¸ AI ìƒì„±
   - `analyzeMissingInfo()`ë¡œ ëˆ„ë½ ì •ë³´ íŒŒì•…
   - OpenAI API í˜¸ì¶œ (temperature: 0.7)
   - JSON íŒŒì‹± ë° ë°˜í™˜

3. **`analyzeMissingInfo()`**
   ```typescript
   function analyzeMissingInfo(
     messages: ChatMessage[],
     photoAnalysis: PhotoAnalysisResult | null,
     spaceInfo?: { ... } | null,
     styleResult?: { ... } | null
   ): MissingInfo
   ```
   - ì‹¤ì œ ë°ì´í„° ì¡´ì¬ ì—¬ë¶€ ê¸°ì¤€ íŒë‹¨
   - ëŒ€í™” ë‚´ìš© ë¶„ì„ìœ¼ë¡œ ì •ë³´ ì¶”ì¶œ

### 5.5 í†µí•© ë¶„ì„ API

**íŒŒì¼**: `app/api/v5/analyze/fusion/route.ts`

**ì—­í• **: ìŠ¤íƒ€ì¼ + ì±„íŒ… ë°ì´í„° í†µí•© ë¶„ì„

**í”„ë¡œì„¸ìŠ¤**:
1. `styleResult` + `chatData` ìˆ˜ì‹ 
2. `convertToChatAnalysis()` - ìŠ¤íƒ€ì¼ â†’ ì±„íŒ… ë¶„ì„ ë³€í™˜
3. `FusionAnalyzer` ì‹¤í–‰
4. `FusionAnalysisResult` ìƒì„± ë° ë°˜í™˜

**ê²°ê³¼ êµ¬ì¡°**:
```typescript
interface FusionAnalysisResult {
  dna: {
    type: string;
    title: string;
    description: string;
    explain: string;
  };
  tags: string[];
  sixIndices: {
    practical: number;
    minimal: number;
    natural: number;
    modern: number;
    classic: number;
    budget: number;
  };
  overallConfidence: number;
}
```

---

## 6. ë°ì´í„° íë¦„

### 6.1 V5 Ultimate ì „ì²´ ë°ì´í„° íë¦„

```
[1] ì‚¬ìš©ì ì…ë ¥
    â”‚
    â”œâ”€ SpaceInfoForm
    â”‚  â””â”€ spaceInfoStore.setSpaceInfo()
    â”‚     â””â”€ localStorage: 'space-info-storage'
    â”‚
    â”œâ”€ StyleSelector
    â”‚  â””â”€ ë¡œì»¬ ìƒíƒœ: styleResult
    â”‚
    â””â”€ ChatOnboarding
       â””â”€ v5UltimateStore.addChatMessage()
          â””â”€ localStorage: 'v5-ultimate-storage'

[2] ì§ˆë¬¸ ìƒì„±
    â”‚
    ChatOnboarding.loadNextQuestion()
    â”‚
    â””â”€ /api/v5/generate-question
       â”‚
       â””â”€ question-engine.ts.generateQuestion()
          â”‚
          â”œâ”€ ì²« ì§ˆë¬¸: getFixedFirstQuestions() (AI í˜¸ì¶œ ì—†ìŒ)
          â”‚
          â””â”€ 2~5ë²ˆì§¸: OpenAI API í˜¸ì¶œ
             â”‚
             â””â”€ temperature: 0.7
                â””â”€ JSON ë°˜í™˜: { question, quickReplies }

[3] ë¶„ì„ ìš”ì²­
    â”‚
    ChatOnboarding.handleChatComplete()
    â”‚
    â””â”€ /api/v5/analyze/fusion
       â”‚
       â”œâ”€ convertToChatAnalysis(styleResult)
       â”‚
       â”œâ”€ FusionAnalyzer ì‹¤í–‰
       â”‚  â””â”€ OpenAI API í˜¸ì¶œ (callAIWithLimit)
       â”‚
       â””â”€ FusionAnalysisResult ìƒì„±
          â”‚
          â””â”€ v5UltimateStore.setFusionResult()
             â””â”€ localStorage: 'v5-ultimate-storage'

[4] ê²°ê³¼ í‘œì‹œ
    â”‚
    DNAResultDisplay
    â”‚
    â””â”€ fusionResult í‘œì‹œ
       â”œâ”€ DNA ìœ í˜•
       â”œâ”€ 6ê°€ì§€ ì§€ìˆ˜
       â””â”€ íƒœê·¸ ëª©ë¡

[5] ë‹¤ìŒ ë‹¨ê³„
    â”‚
    handleResultNext()
    â”‚
    â”œâ”€ localStorage.setItem('v5DnaResult1', ...)
    â”œâ”€ localStorage.setItem('v5SpaceInfo', ...)
    â”‚
    â””â”€ router.push('/v5/process-select')
```

### 6.2 localStorage êµ¬ì¡°

**V5 Ultimate ë°ì´í„°**:
```typescript
// v5-ultimate-storage
{
  state: {
    sessionId: "v5_1234567890_abc123",
    currentStep: "result",
    fusionResult: { ... }
  },
  version: 0
}

// v5DnaResult1
{
  schemaVersion: "5.0",
  createdAt: "2025-01-21T...",
  data: FusionAnalysisResult
}

// v5SpaceInfo
{
  schemaVersion: "5.0",
  createdAt: "2025-01-21T...",
  data: SpaceInfo
}
```

### 6.3 API í˜¸ì¶œ íë¦„

**ì§ˆë¬¸ ìƒì„±**:
```
Client â†’ /api/v5/generate-question
  â†’ question-engine.ts.generateQuestion()
    â†’ OpenAI API (gpt-4o-mini)
      â†’ JSON íŒŒì‹±
        â†’ Client
```

**í†µí•© ë¶„ì„**:
```
Client â†’ /api/v5/analyze/fusion
  â†’ convertToChatAnalysis()
  â†’ callAIWithLimit() (AI í˜¸ì¶œ ì œí•œ ë˜í¼)
    â†’ OpenAI API (gpt-4o-mini)
      â†’ FusionAnalysisResult ìƒì„±
        â†’ Client
```

---

## 7. API êµ¬ì¡°

### 7.1 V5 Ultimate API

#### `/api/v5/generate-question`
- **ë©”ì„œë“œ**: POST
- **ì—­í• **: ì§ˆë¬¸ ìƒì„±
- **ì…ë ¥**: `{ messages, photoAnalysis, styleResult, spaceInfo }`
- **ì¶œë ¥**: `{ question: string, quickReplies: string[] }`
- **ì—”ì§„**: `lib/analysis/v5-ultimate/question-engine.ts`

#### `/api/v5/analyze/chat`
- **ë©”ì„œë“œ**: POST
- **ì—­í• **: ì±„íŒ… ë¶„ì„
- **ì…ë ¥**: `{ messages, photoAnalysis }`
- **ì¶œë ¥**: `ChatAnalysisResult`
- **AI í˜¸ì¶œ**: `callAIWithLimit()` (action: 'CHAT')

#### `/api/v5/analyze/photo`
- **ë©”ì„œë“œ**: POST
- **ì—­í• **: ì‚¬ì§„ ë¶„ì„
- **ì…ë ¥**: `{ imageUrl }`
- **ì¶œë ¥**: `PhotoAnalysisResult`
- **AI í˜¸ì¶œ**: `callAIWithLimit()` (action: 'IMAGE_GENERATE')

#### `/api/v5/analyze/fusion`
- **ë©”ì„œë“œ**: POST
- **ì—­í• **: í†µí•© ë¶„ì„ (ìŠ¤íƒ€ì¼ + ì±„íŒ…)
- **ì…ë ¥**: `{ styleResult, chatData, photoAnalysis, spaceInfo }`
- **ì¶œë ¥**: `FusionAnalysisResult`
- **í”„ë¡œì„¸ìŠ¤**: `convertToChatAnalysis()` â†’ `FusionAnalyzer`

### 7.2 AI í˜¸ì¶œ ì œí•œ ì‹œìŠ¤í…œ

**íŒŒì¼**: `lib/api/ai-call-limiter.ts`

**ì£¼ìš” í•¨ìˆ˜**:
- `callAIWithLimit()`: AI í˜¸ì¶œ ë˜í¼ (ì œí•œ ë° ë¡œê¹…)
- `isImageAction()`: IMAGE ê´€ë ¨ ì•¡ì…˜ íŒë³„
- `isConsecutiveCall()`: ì—°ì† í˜¸ì¶œ íŒë³„
- `applySoftDelay()`: ì†Œí”„íŠ¸ ì§€ì—° ì ìš© (300-800ms)

**Phase 7 ì ìš©**:
- IMAGE ê³„ì—´ (`IMAGE_GENERATE`, `IMAGE_PROMPT`, `VISION_ANALYSIS`)ì—ë§Œ ì†Œí”„íŠ¸ ì œí•œ
- ì²« ìš”ì²­ ë¬´ì¡°ê±´ í†µê³¼
- ì—°ì† í˜¸ì¶œì—ë§Œ ì§€ì—° ì ìš©

**ë¡œê¹…** (ê°œë°œ í™˜ê²½):
```
[AI_CALL]
route=CHAT
model=gpt-4o-mini
provider=openai
duration=842ms
tokens~=1250
success=true
soft_delay_applied=false
```

### 7.3 ê¸°ì¡´ ë¶„ì„ API

#### `/api/analysis/submit`
- **ë©”ì„œë“œ**: POST
- **ì—­í• **: ì„±í–¥ ë¶„ì„ ì œì¶œ (ë ˆê±°ì‹œ)
- **ì—”ì§„**: V3, V4, V5 ì—”ì§„ ì„ íƒ ê°€ëŠ¥

#### `/api/analysis/v5`
- **ë©”ì„œë“œ**: POST
- **ì—­í• **: V5 ë¶„ì„ (ê·œì¹™ ê¸°ë°˜)
- **ì—”ì§„**: `lib/analysis/v5/`

---

## 8. í•µì‹¬ ì„¤ê³„ ì›ì¹™

### 8.1 V5 Ultimate ì„¤ê³„ ì›ì¹™

1. **ì²« ì§ˆë¬¸ ê³ ì •í™”**: AI ìƒì„±ì´ ì•„ë‹Œ ê³ ì • ì§ˆë¬¸ ì„¸íŠ¸ ì‚¬ìš©
2. **ì‹¤ì œ ë°ì´í„° ê¸°ë°˜**: `userMessages.length` ëŒ€ì‹  ì‹¤ì œ ë°ì´í„° ì¡´ì¬ ì—¬ë¶€ íŒë‹¨
3. **Temperature ì¡°ì •**: ì²« ì§ˆë¬¸ ì œì™¸, ë‚˜ë¨¸ì§€ëŠ” 0.7ë¡œ ë‹¤ì–‘ì„± í™•ë³´
4. **Fallback ì œì™¸**: ì²« ì§ˆë¬¸ì€ fallback ì‚¬ìš©í•˜ì§€ ì•ŠìŒ

### 8.2 AI í˜¸ì¶œ ì œí•œ ì›ì¹™

1. **IMAGE ê³„ì—´ë§Œ ì œí•œ**: CHAT, ë¶„ì„, ê²¬ì ì€ ë³´í˜¸
2. **ì²« ìš”ì²­ í†µê³¼**: ì²« ìš”ì²­ì€ ë¬´ì¡°ê±´ í†µê³¼
3. **ì—°ì† í˜¸ì¶œë§Œ ì œí•œ**: 5ë¶„ ë‚´ ì—°ì† í˜¸ì¶œì—ë§Œ ì§€ì—° ì ìš©
4. **ì†Œí”„íŠ¸ ì œí•œ**: ì°¨ë‹¨ ì—†ì´ ì§€ì—°ë§Œ ì ìš© (300-800ms)

### 8.3 ë°ì´í„° ë¬´ê²°ì„± ì›ì¹™

1. **Schema Versioning**: ëª¨ë“  ì €ì¥ ë°ì´í„°ì— `schemaVersion: '5.0'` í¬í•¨
2. **ì¬í˜„ì„± ë³´ì¥**: ì…ë ¥/ì¶œë ¥ í•´ì‹œ ìƒì„±
3. **ê°ì‚¬ ë¡œê·¸**: ëª¨ë“  ë¶„ì„ ìš”ì²­/ì™„ë£Œ ë¡œê¹…

---

## 9. í–¥í›„ ê°œì„  ë°©í–¥

### 9.1 ë‹¨ê¸° ê°œì„ 

1. **AI í˜¸ì¶œ ì œí•œ Phase 8**: IMAGE í•˜ë“œ ì œí•œ ê²€í† 
2. **ì§ˆë¬¸ ë‹¤ì–‘ì„± í–¥ìƒ**: Temperature ì¶”ê°€ ì¡°ì •
3. **ì—ëŸ¬ ì²˜ë¦¬ ê°•í™”**: Fallback ë©”ì»¤ë‹ˆì¦˜ ê°œì„ 

### 9.2 ì¤‘ê¸° ê°œì„ 

1. **ìºì‹± ì‹œìŠ¤í…œ**: ì§ˆë¬¸ ìƒì„± ê²°ê³¼ ìºì‹±
2. **A/B í…ŒìŠ¤íŠ¸**: ì§ˆë¬¸ í†¤ ë° ìŠ¤íƒ€ì¼ í…ŒìŠ¤íŠ¸
3. **ì„±ëŠ¥ ìµœì í™”**: API ì‘ë‹µ ì‹œê°„ ê°œì„ 

### 9.3 ì¥ê¸° ê°œì„ 

1. **ë©€í‹°ëª¨ë‹¬ ë¶„ì„**: í…ìŠ¤íŠ¸ + ì´ë¯¸ì§€ í†µí•© ë¶„ì„
2. **ê°œì¸í™” ê°•í™”**: ì‚¬ìš©ì íˆìŠ¤í† ë¦¬ ê¸°ë°˜ ì¶”ì²œ
3. **ì‹¤ì‹œê°„ í˜‘ì—…**: ìƒë‹´ì‚¬ì™€ì˜ ì‹¤ì‹œê°„ ëŒ€í™” ê¸°ëŠ¥

---

## 10. ê²°ë¡ 

ì¸í…Œë¦¬ë´‡ì€ **Next.js 14 App Router ê¸°ë°˜ì˜ í’€ìŠ¤íƒ ì¸í…Œë¦¬ì–´ ìƒë‹´ ì‹œìŠ¤í…œ**ìœ¼ë¡œ, ë‹¤ìŒê³¼ ê°™ì€ íŠ¹ì§•ì„ ê°€ì§‘ë‹ˆë‹¤:

1. **ëª¨ë“ˆí™”ëœ ì•„í‚¤í…ì²˜**: V3, V4, V5, V5 Ultimate ì—”ì§„ ë¶„ë¦¬
2. **AI ê¸°ë°˜ ë¶„ì„**: OpenAI APIë¥¼ í™œìš©í•œ ì„±í–¥ ë¶„ì„ ë° ì¶”ì²œ
3. **ì‹¤ì‹œê°„ ê²¬ì **: ë™ì  ìì¬ ë° ê³µì‚¬ë¹„ ê³„ì‚°
4. **ì‚¬ìš©ì ê²½í—˜ ìµœì í™”**: ë‹¨ê³„ë³„ ì˜¨ë³´ë”© ë° ì‹œê°í™”

í˜„ì¬ **V5 Ultimate**ê°€ ìµœì‹  ë²„ì „ìœ¼ë¡œ, ê³ ì • ì²« ì§ˆë¬¸, ì‹¤ì œ ë°ì´í„° ê¸°ë°˜ ë¶„ì„, AI í˜¸ì¶œ ì œí•œ ë“±ì´ ì ìš©ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

---

**ë¬¸ì„œ ë**

