# 헌법 문서 실행 전 확인사항

## 📋 개요

**작성일**: 2024년 12월  
**목적**: 헌법 문서 실행 전 확인해야 할 사항 정리  
**중요도**: Critical

---

## 🔴 즉시 확인 필요 사항

### 1. 등급 시스템 폐기 범위

**헌법 규칙**: BASIC / STANDARD / PREMIUM / ARGEN 등급 시스템 전면 폐기

**확인 필요**:
- [ ] 현재 코드에서 등급을 사용하는 모든 위치 파악
- [ ] DB 스키마에서 등급 관련 컬럼 확인 (`grade`, `is_argen_standard` 등)
- [ ] UI에서 등급 선택/표시하는 모든 부분 확인
- [ ] API 응답에서 등급 관련 필드 제거 계획

**예상 영향 범위**:
- `lib/estimate/calculator-v3.ts`: 등급별 계산 로직
- `app/onboarding/estimate/page.tsx`: 등급 선택 UI
- `lib/data/pricing-v3/`: 등급별 가격 데이터
- Supabase DB: `materials_pricing` 테이블의 `grade` 컬럼

**질문**:
- `is_argen_standard = true` 조건이 DB에 이미 존재하나요?
- 없으면 DB 스키마 수정이 필요한데, 이건 언제 진행하나요?

---

### 2. 브랜드 DB 구조 확인

**헌법 규칙**: `is_argen_standard = true` 인 자재만 사용

**확인 필요**:
- [ ] Supabase DB에 `is_argen_standard` 컬럼이 존재하나요?
- [ ] 해당 컬럼에 데이터가 채워져 있나요?
- [ ] 브랜드명 + 제품명이 모두 저장되어 있나요?
- [ ] `is_argen_standard = true`인 자재가 충분한가요? (모든 공정 커버 가능?)

**예상 영향**:
- DB에 `is_argen_standard` 컬럼이 없으면 → DB 스키마 수정 필요
- 데이터가 없으면 → 데이터 입력 필요
- 데이터가 부족하면 → 일부 공정에서 견적 실패 가능

**질문**:
- DB 스키마 수정은 언제 진행하나요?
- 데이터 입력은 언제 완료 예정인가요?

---

### 3. 노무비 DB 구조 확인

**헌법 규칙**: 노무 단위, 1일 작업량, 투입 인원, 1인 1일 노무 단가를 DB에서 가져옴

**확인 필요**:
- [ ] Supabase DB에 노무비 관련 테이블이 존재하나요?
- [ ] 테이블명은 무엇인가요? (`labor_costs`, `labor_rates` 등)
- [ ] 필요한 컬럼이 모두 있나요?
  - 노무 단위
  - 1일 작업량
  - 투입 인원
  - 1인 1일 노무 단가
- [ ] 데이터가 충분히 채워져 있나요?

**예상 영향**:
- 노무비 테이블이 없으면 → DB 스키마 생성 필요
- 데이터가 없으면 → 데이터 입력 필요
- 데이터가 부족하면 → 일부 공정에서 견적 실패 가능

**질문**:
- 노무비 테이블 구조는 어떻게 되나요?
- 데이터 입력은 언제 완료 예정인가요?

---

### 4. MaterialRequest / LaborRequest 타입 정의

**헌법 규칙**: DB 조회 전 MaterialRequest / LaborRequest 생성 필수

**확인 필요**:
- [ ] MaterialRequest 타입 정의 필요
  - 공정 ID
  - 공간
  - 브랜드 조건
  - 자재 카테고리
  - 제품 규격
- [ ] LaborRequest 타입 정의 필요
  - 노무 단위
  - 총 작업량
  - 1일 작업량
  - 투입 인원 규칙

**질문**:
- 이 타입들을 어디에 정의할까요? (`lib/types/` 또는 새 파일?)
- 기존 타입과 충돌하는 부분이 있나요?

---

### 5. 기존 코드와의 호환성

**헌법 규칙**: 기존 코드와 충돌 시 헌법이 우선

**확인 필요**:
- [ ] 기존 견적 결과를 보여주는 페이지가 있나요? (`app/result/`, `app/estimate/` 등)
- [ ] 기존 견적 데이터 구조와 새 구조가 완전히 다를 텐데, 기존 데이터는 어떻게 처리하나요?
- [ ] 기존 API 엔드포인트는 어떻게 처리하나요? (하위 호환성 유지? 전면 교체?)

**질문**:
- 기존 견적 데이터는 어떻게 처리할까요?
- 기존 API는 유지하되 새 API를 추가할까요, 아니면 전면 교체할까요?

---

### 6. UI 변경 범위

**헌법 규칙**: 등급 선택 UI 제거, 브랜드 선택 UI 제거

**확인 필요**:
- [ ] 등급 선택 UI가 있는 모든 페이지 파악
- [ ] 브랜드 선택/비교 UI가 있는 모든 페이지 파악
- [ ] 최종 견적 출력 UI 구조 변경 필요

**예상 영향**:
- `app/onboarding/estimate/page.tsx`: 등급 선택 제거
- `app/result/ResultContent.tsx`: 견적 출력 구조 변경
- `app/estimate/page.tsx`: 견적 출력 구조 변경

**질문**:
- UI 변경은 단계적으로 할까요, 한 번에 할까요?

---

### 7. 실패 처리 및 사용자 경험

**헌법 규칙**: 검증 실패 시 "견적 산출 불가 / 추가 확인 필요" 상태로 종료

**확인 필요**:
- [ ] 사용자에게 어떤 메시지를 보여줄까요?
- [ ] "추가 확인 필요" 상태에서 사용자가 할 수 있는 액션은 무엇인가요?
- [ ] 고객센터 연락처나 문의 방법을 안내하나요?

**질문**:
- 실패 시 사용자 경험은 어떻게 설계할까요?

---

### 8. 철거 공정 처리

**헌법 규칙**: 철거는 항상 독립 공정으로 분리, 노무/폐기물/작업 기준 포함

**확인 필요**:
- [ ] 현재 철거 공정이 어떻게 처리되고 있나요?
- [ ] 철거 공정의 노무비 DB 구조는 어떻게 되나요?
- [ ] 전체 철거 / 부분 철거 구분 로직은 어떻게 구현할까요?

**질문**:
- 철거 공정의 MaterialRequest / LaborRequest는 어떻게 구성할까요?

---

### 9. DB 조회 실패 시나리오

**헌법 규칙**: ERROR → 즉시 견적 실패, NOT_FOUND → 사전 정의된 경우만 fallback

**확인 필요**:
- [ ] "사전 정의된 경우"는 무엇인가요?
- [ ] NOT_FOUND인데 fallback이 허용되지 않는 경우, 사용자에게 어떻게 안내하나요?

**질문**:
- NOT_FOUND fallback 허용 기준을 명확히 정의해주세요.

---

### 10. 테스트 및 검증 계획

**확인 필요**:
- [ ] 헌법 문서 적용 후 테스트 계획은 어떻게 되나요?
- [ ] 기존 테스트 코드는 어떻게 처리하나요? (전면 수정? 삭제?)
- [ ] 통합 테스트는 어떻게 진행하나요?

**질문**:
- 테스트 전략을 어떻게 수립할까요?

---

## 🎯 실행 전 체크리스트

### Phase 0: 사전 준비 (필수)

- [ ] DB 스키마 확인 및 수정 계획 수립
  - [ ] `is_argen_standard` 컬럼 존재 여부 확인
  - [ ] 노무비 테이블 존재 여부 확인
  - [ ] 필요한 컬럼 모두 확인
- [ ] 데이터 준비 상태 확인
  - [ ] `is_argen_standard = true` 자재 데이터 확인
  - [ ] 노무비 데이터 확인
- [ ] 타입 정의
  - [ ] MaterialRequest 타입 정의
  - [ ] LaborRequest 타입 정의
  - [ ] DB 결과 타입 (SUCCESS/NOT_FOUND/ERROR) 정의

### Phase 1: 핵심 로직 수정

- [ ] 등급 시스템 제거
  - [ ] calculator-v3.ts에서 등급 관련 로직 제거
  - [ ] 등급별 계산 함수 제거 또는 단일화
- [ ] 입력 데이터 확정 로직 수정
  - [ ] 평수 절대 변경 금지
  - [ ] processSelections만 SSOT로 사용
- [ ] 검증 로직 추가
  - [ ] 계산기 진입 전 강제 검증
  - [ ] Fail-Fast 원칙 적용

### Phase 2: DB 조회 로직 수정

- [ ] MaterialRequest / LaborRequest 생성 로직
- [ ] DB 조회 결과 타입 명확화
- [ ] ERROR 시 즉시 실패 처리
- [ ] NOT_FOUND fallback 조건 명확화

### Phase 3: 노무비 계산 로직

- [ ] 노무비 DB 조회 로직
- [ ] 모든 공정에 노무비 포함
- [ ] 노무비 계산 불가 시 견적 실패

### Phase 4: 최종 견적 출력

- [ ] 공정별 블록 구조
- [ ] 브랜드 표기
- [ ] 자재 상세 정보
- [ ] 노무 상세 정보

### Phase 5: UI 수정

- [ ] 등급 선택 UI 제거
- [ ] 브랜드 선택 UI 제거
- [ ] 최종 견적 출력 UI 수정

---

## ❓ 즉시 답변 필요한 질문

### 1. DB 스키마 관련
- **Q**: `is_argen_standard` 컬럼이 DB에 존재하나요?
- **Q**: 노무비 테이블이 존재하나요? 구조는 어떻게 되나요?
- **Q**: DB 스키마 수정은 언제 진행하나요?

### 2. 데이터 준비 관련
- **Q**: `is_argen_standard = true` 자재 데이터가 충분한가요?
- **Q**: 노무비 데이터가 충분한가요?
- **Q**: 데이터 입력은 언제 완료 예정인가요?

### 3. 실행 계획 관련
- **Q**: 한 번에 전면 개편할까요, 단계적으로 진행할까요?
- **Q**: 기존 견적 데이터는 어떻게 처리할까요?
- **Q**: 기존 API는 유지할까요, 전면 교체할까요?

### 4. 사용자 경험 관련
- **Q**: 견적 실패 시 사용자에게 어떤 메시지를 보여줄까요?
- **Q**: "추가 확인 필요" 상태에서 사용자가 할 수 있는 액션은 무엇인가요?

### 5. NOT_FOUND fallback 관련
- **Q**: "사전 정의된 경우"는 구체적으로 무엇인가요?
- **Q**: NOT_FOUND인데 fallback이 허용되지 않는 경우, 사용자에게 어떻게 안내하나요?

---

## 🚨 위험 요소

### 1. DB 스키마/데이터 준비 미완료
- **위험**: 헌법 문서 적용 후 즉시 실패
- **대응**: Phase 0에서 반드시 확인

### 2. 기존 코드와의 충돌
- **위험**: 기존 기능이 작동하지 않음
- **대응**: 단계적 적용 또는 완전 교체 결정 필요

### 3. 사용자 경험 저하
- **위험**: 견적 실패가 너무 많아서 사용자 이탈
- **대응**: 실패 메시지 및 해결 방법 명확히 안내

---

## 📅 작성일
2024년 12월

## 📌 버전
V1.0 (헌법 문서 실행 전 확인용)

















