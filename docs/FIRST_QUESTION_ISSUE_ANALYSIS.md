# ì²« ì§ˆë¬¸ ë³€í™” ì—†ìŒ ë¬¸ì œì  ë¶„ì„

> **ë¶„ì„ ì¼ì‹œ**: 2025-01-21  
> **ìƒíƒœ**: ë¬¸ì œì  íŒŒì•… ì™„ë£Œ (ì½”ë“œ ìˆ˜ì • ì—†ìŒ)

---

## ğŸ” ë°œê²¬ëœ ë¬¸ì œì 

### 1. **Temperature ê°’ì´ ë„ˆë¬´ ë‚®ìŒ** âš ï¸

**ìœ„ì¹˜**: `lib/analysis/v5-ultimate/question-engine.ts:181`
```typescript
temperature: 0.3,  // ë„ˆë¬´ ë‚®ì•„ì„œ í•­ìƒ ë¹„ìŠ·í•œ ê²°ê³¼ ìƒì„±
```

**ë¬¸ì œ**:
- `temperature: 0.3`ì€ ë§¤ìš° ë‚®ì€ ê°’ìœ¼ë¡œ, AIê°€ ê±°ì˜ ê²°ì •ë¡ ì ìœ¼ë¡œ ë™ì¼í•œ ì§ˆë¬¸ì„ ìƒì„±í•©ë‹ˆë‹¤.
- ì²« ì§ˆë¬¸ ìƒì„± ì‹œ ì…ë ¥ì´ ë¹„ìŠ·í•˜ë©´ í•­ìƒ ê°™ì€ ì§ˆë¬¸ì´ ë‚˜ì˜µë‹ˆë‹¤.

**ì˜í–¥ë„**: ğŸ”´ **ë†’ìŒ**

---

### 2. **ì²« ì§ˆë¬¸ ìƒì„± ì‹œ ì…ë ¥ ë°ì´í„°ê°€ í•­ìƒ ë™ì¼** âš ï¸

**ìœ„ì¹˜**: `lib/analysis/v5-ultimate/question-engine.ts:148-165`

**ë¬¸ì œ**:
```typescript
const userPrompt = `[ê³ ê° ì§‘ ì •ë³´]
${spaceInfo ? `
- ì£¼ê±°í˜•íƒœ: ${spaceInfo.housingType || 'ë¯¸ì…ë ¥'}
- í‰ìˆ˜: ${spaceInfo.pyeong || 'ë¯¸ì…ë ¥'}í‰
- ë°©: ${spaceInfo.rooms || 'ë¯¸ì…ë ¥'}ê°œ
- í™”ì¥ì‹¤: ${spaceInfo.bathrooms || 'ë¯¸ì…ë ¥'}ê°œ
` : 'ì§‘ ì •ë³´ ë¯¸ì…ë ¥'}

${styleResult?.styleTag ? `[ì„ íƒí•œ ìŠ¤íƒ€ì¼]: ${styleResult.styleTag}` : ''}

[ëŒ€í™” ë‚´ì—­]
${conversationSummary || 'ì•„ì§ ëŒ€í™” ì‹œì‘ ì „ - ì²« ì§ˆë¬¸ ìƒì„±í•´ì£¼ì„¸ìš”'}  // âš ï¸ í•­ìƒ ê°™ì€ í…ìŠ¤íŠ¸

${photoAnalysis ? `[ì‚¬ì§„ ë¶„ì„ ê²°ê³¼]\nê³µê°„: ${photoAnalysis.spaceType}` : ''}

ì§ˆë¬¸ ìˆ˜: ${userMessages.length}/5
ë‹¤ìŒ ì§ˆë¬¸ì„ ìì—°ìŠ¤ëŸ½ê²Œ ìƒì„±í•´ì£¼ì„¸ìš”.`;
```

**ë¬¸ì œì **:
- ì²« ì§ˆë¬¸ ìƒì„± ì‹œ `conversationSummary`ê°€ í•­ìƒ ë¹„ì–´ìˆì–´ì„œ "ì•„ì§ ëŒ€í™” ì‹œì‘ ì „ - ì²« ì§ˆë¬¸ ìƒì„±í•´ì£¼ì„¸ìš”"ë¼ëŠ” ê³ ì • í…ìŠ¤íŠ¸ë§Œ ì „ë‹¬ë©ë‹ˆë‹¤.
- `spaceInfo`ê°€ ì—†ê±°ë‚˜ ë¹„ìŠ·í•œ ê°’ì´ë©´ ì…ë ¥ì´ ê±°ì˜ ë™ì¼í•©ë‹ˆë‹¤.
- `userMessages.length`ê°€ í•­ìƒ 0ì´ì–´ì„œ "ì§ˆë¬¸ ìˆ˜: 0/5"ë¡œ ê³ ì •ë©ë‹ˆë‹¤.

**ì˜í–¥ë„**: ğŸ”´ **ë†’ìŒ**

---

### 3. **ëˆ„ë½ëœ ì •ë³´ ë¶„ì„ ë¡œì§ì´ ë‹¨ìˆœí•¨** âš ï¸

**ìœ„ì¹˜**: `lib/analysis/v5-ultimate/question-engine.ts:66-87`

**ë¬¸ì œ**:
```typescript
function analyzeMissingInfo(
  messages: ChatMessage[],
  photoAnalysis: PhotoAnalysisResult | null
): MissingInfo {
  const userMessages = messages.filter(m => m.role === 'user');
  const hasPhoto = !!photoAnalysis;
  
  return {
    spaceType: !hasSpaceType && userMessages.length === 0,  // âš ï¸ ì²« ì§ˆë¬¸ì¼ ë•Œ í•­ìƒ true
    activity: userMessages.length < 1,  // âš ï¸ ì²« ì§ˆë¬¸ì¼ ë•Œ í•­ìƒ true
    familyInfo: userMessages.length < 2,  // âš ï¸ ì²« ì§ˆë¬¸ì¼ ë•Œ í•­ìƒ true
    cleaningStyle: userMessages.length < 3,  // âš ï¸ ì²« ì§ˆë¬¸ì¼ ë•Œ í•­ìƒ true
    spaceInterests: userMessages.length < 4,  // âš ï¸ ì²« ì§ˆë¬¸ì¼ ë•Œ í•­ìƒ true
    budgetRange: userMessages.length < 5,  // âš ï¸ ì²« ì§ˆë¬¸ì¼ ë•Œ í•­ìƒ true
  };
}
```

**ë¬¸ì œì **:
- ì²« ì§ˆë¬¸ì¼ ë•Œ (`userMessages.length === 0`) ëª¨ë“  `missingInfo`ê°€ í•­ìƒ `true`ë¡œ ì„¤ì •ë©ë‹ˆë‹¤.
- ì´ë¡œ ì¸í•´ `formatMissingInfo`ê°€ í•­ìƒ "ëˆ„ë½ëœ ì •ë³´: ì£¼ ì‚¬ìš© ê³µê°„, ì£¼ìš” í™œë™, ê°€ì¡± êµ¬ì„±, ì •ë¦¬ì •ëˆ ìŠ¤íƒ€ì¼, ê´€ì‹¬ ê³µê°„, ì˜ˆì‚° ë²”ìœ„"ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
- **ê²°ê³¼ì ìœ¼ë¡œ AIê°€ ë°›ëŠ” í”„ë¡¬í”„íŠ¸ê°€ í•­ìƒ ë™ì¼í•©ë‹ˆë‹¤.**

**ì˜í–¥ë„**: ğŸ”´ **ë†’ìŒ**

---

### 4. **Fallback ì§ˆë¬¸ì´ ê³ ì •ë¨** âš ï¸

**ìœ„ì¹˜**: `lib/analysis/v5-ultimate/question-engine.ts:217-256`

**ë¬¸ì œ**:
```typescript
function getFallbackQuestion(
  questionIndex: number,
  photoAnalysis: PhotoAnalysisResult | null
): { question: string; quickReplies: string[] } | null {
  if (questionIndex === 0 && !photoAnalysis) {
    return {
      question: "ì•ˆë…•í•˜ì„¸ìš”! ë¨¼ì € ì–´ë–¤ ê³µê°„ì„ ê°€ì¥ ë°”ê¾¸ê³  ì‹¶ìœ¼ì„¸ìš”?",  // âš ï¸ í•­ìƒ ê³ ì •
      quickReplies: ["ê±°ì‹¤", "ì£¼ë°©", "ì¹¨ì‹¤", "ìš•ì‹¤", "ì „ì²´ ë‹¤"]
    };
  }
  // ...
}
```

**ë¬¸ì œì **:
- AI í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ fallback ì§ˆë¬¸ì´ í•­ìƒ ë™ì¼í•©ë‹ˆë‹¤.
- ì²« ì§ˆë¬¸ì¼ ë•Œ í•­ìƒ "ì•ˆë…•í•˜ì„¸ìš”! ë¨¼ì € ì–´ë–¤ ê³µê°„ì„ ê°€ì¥ ë°”ê¾¸ê³  ì‹¶ìœ¼ì„¸ìš”?"ê°€ ë‚˜ì˜µë‹ˆë‹¤.

**ì˜í–¥ë„**: ğŸŸ¡ **ì¤‘ê°„** (ì—ëŸ¬ ì‹œì—ë§Œ ë°œìƒ)

---

### 5. **ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ê°€ ë„ˆë¬´ êµ¬ì²´ì ** âš ï¸

**ìœ„ì¹˜**: `lib/analysis/v5-ultimate/question-engine.ts:31-61`

**ë¬¸ì œ**:
- `TONE_LOCKED_SYSTEM_PROMPT`ê°€ ë§¤ìš° êµ¬ì²´ì ì¸ ì˜ˆì‹œë¥¼ í¬í•¨í•˜ê³  ìˆì–´ì„œ, AIê°€ í•­ìƒ ë¹„ìŠ·í•œ íŒ¨í„´ì˜ ì§ˆë¬¸ì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- íŠ¹íˆ "ì¢‹ì€ ì˜ˆì‹œ"ê°€ ê³ ì •ë˜ì–´ ìˆì–´ì„œ AIê°€ ì´ë¥¼ ëª¨ë°©í•˜ëŠ” ê²½í–¥ì´ ìˆìŠµë‹ˆë‹¤.

**ì˜í–¥ë„**: ğŸŸ¡ **ì¤‘ê°„**

---

### 6. **spaceInfoê°€ ì—†ì„ ë•Œ ì²˜ë¦¬ ë¶€ì¡±** âš ï¸

**ìœ„ì¹˜**: `lib/analysis/v5-ultimate/question-engine.ts:149-155`

**ë¬¸ì œ**:
```typescript
${spaceInfo ? `
- ì£¼ê±°í˜•íƒœ: ${spaceInfo.housingType || 'ë¯¸ì…ë ¥'}
- í‰ìˆ˜: ${spaceInfo.pyeong || 'ë¯¸ì…ë ¥'}í‰
- ë°©: ${spaceInfo.rooms || 'ë¯¸ì…ë ¥'}ê°œ
- í™”ì¥ì‹¤: ${spaceInfo.bathrooms || 'ë¯¸ì…ë ¥'}ê°œ
` : 'ì§‘ ì •ë³´ ë¯¸ì…ë ¥'}  // âš ï¸ spaceInfoê°€ ì—†ìœ¼ë©´ í•­ìƒ "ì§‘ ì •ë³´ ë¯¸ì…ë ¥"
```

**ë¬¸ì œì **:
- `spaceInfo`ê°€ ì—†ê±°ë‚˜ ë¹„ìŠ·í•œ ê°’ì´ë©´ ì…ë ¥ì´ ê±°ì˜ ë™ì¼í•©ë‹ˆë‹¤.
- ì²« ì§ˆë¬¸ ìƒì„± ì‹œ `spaceInfo`ê°€ ì œëŒ€ë¡œ ì „ë‹¬ë˜ì§€ ì•Šìœ¼ë©´ í•­ìƒ "ì§‘ ì •ë³´ ë¯¸ì…ë ¥"ë§Œ í‘œì‹œë©ë‹ˆë‹¤.

**ì˜í–¥ë„**: ğŸŸ¡ **ì¤‘ê°„**

---

## ğŸ“Š ë¬¸ì œì  ìš”ì•½

| ë¬¸ì œì  | ìœ„ì¹˜ | ì˜í–¥ë„ | ìš°ì„ ìˆœìœ„ |
|--------|------|--------|----------|
| Temperature ë„ˆë¬´ ë‚®ìŒ | `question-engine.ts:181` | ğŸ”´ ë†’ìŒ | 1 |
| ì²« ì§ˆë¬¸ ì…ë ¥ ë°ì´í„° ë™ì¼ | `question-engine.ts:148-165` | ğŸ”´ ë†’ìŒ | 1 |
| ëˆ„ë½ ì •ë³´ ë¶„ì„ ë¡œì§ ë‹¨ìˆœ | `question-engine.ts:66-87` | ğŸ”´ ë†’ìŒ | 1 |
| Fallback ì§ˆë¬¸ ê³ ì • | `question-engine.ts:217-256` | ğŸŸ¡ ì¤‘ê°„ | 2 |
| ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ êµ¬ì²´ì  | `question-engine.ts:31-61` | ğŸŸ¡ ì¤‘ê°„ | 2 |
| spaceInfo ì²˜ë¦¬ ë¶€ì¡± | `question-engine.ts:149-155` | ğŸŸ¡ ì¤‘ê°„ | 2 |

---

## ğŸ¯ ê·¼ë³¸ ì›ì¸

**í•µì‹¬ ë¬¸ì œ**: ì²« ì§ˆë¬¸ ìƒì„± ì‹œ AIê°€ ë°›ëŠ” ì…ë ¥ì´ **í•­ìƒ ê±°ì˜ ë™ì¼**í•©ë‹ˆë‹¤.

1. **ì…ë ¥ ë°ì´í„° ë™ì¼ì„±**:
   - `conversationSummary`ê°€ í•­ìƒ ë¹„ì–´ìˆìŒ â†’ "ì•„ì§ ëŒ€í™” ì‹œì‘ ì „ - ì²« ì§ˆë¬¸ ìƒì„±í•´ì£¼ì„¸ìš”"
   - `userMessages.length`ê°€ í•­ìƒ 0 â†’ "ì§ˆë¬¸ ìˆ˜: 0/5"
   - `missingInfo`ê°€ í•­ìƒ ëª¨ë“  í•­ëª©ì´ `true` â†’ "ëˆ„ë½ëœ ì •ë³´: ì£¼ ì‚¬ìš© ê³µê°„, ì£¼ìš” í™œë™, ê°€ì¡± êµ¬ì„±, ì •ë¦¬ì •ëˆ ìŠ¤íƒ€ì¼, ê´€ì‹¬ ê³µê°„, ì˜ˆì‚° ë²”ìœ„"
   - `spaceInfo`ê°€ ì—†ê±°ë‚˜ ë¹„ìŠ·í•˜ë©´ â†’ "ì§‘ ì •ë³´ ë¯¸ì…ë ¥" ë˜ëŠ” ë¹„ìŠ·í•œ ê°’

2. **Temperature ë‚®ìŒ**:
   - `temperature: 0.3`ì€ ë§¤ìš° ë‚®ì•„ì„œ, ë™ì¼í•œ ì…ë ¥ì— ëŒ€í•´ ê±°ì˜ í•­ìƒ ê°™ì€ ì¶œë ¥ì„ ìƒì„±í•©ë‹ˆë‹¤.

3. **ê²°ê³¼**:
   - AIê°€ ë°›ëŠ” í”„ë¡¬í”„íŠ¸ê°€ ê±°ì˜ ë™ì¼ â†’ í•­ìƒ ë¹„ìŠ·í•œ ì§ˆë¬¸ ìƒì„±

---

## ğŸ’¡ í•´ê²° ë°©ì•ˆ (ì°¸ê³ ìš©, ìˆ˜ì •í•˜ì§€ ì•ŠìŒ)

### ë°©ì•ˆ 1: Temperature ì¦ê°€
```typescript
temperature: 0.7,  // 0.3 â†’ 0.7ë¡œ ì¦ê°€í•˜ì—¬ ë‹¤ì–‘ì„± í™•ë³´
```

### ë°©ì•ˆ 2: ì²« ì§ˆë¬¸ ìƒì„± ì‹œ ëœë¤ ìš”ì†Œ ì¶”ê°€
```typescript
// spaceInfoë‚˜ ë‹¤ë¥¸ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì²« ì§ˆë¬¸ì˜ ì´ˆì ì„ ë‹¤ë¥´ê²Œ ì„¤ì •
const firstQuestionFocus = [
  'ê³µê°„ ì‚¬ìš© íŒ¨í„´',
  'ê°€ì¡± êµ¬ì„±',
  'ë¶ˆí¸í•œ ì ',
  'ì›í•˜ëŠ” ë¶„ìœ„ê¸°',
  'ì˜ˆì‚° ê³„íš'
][Math.floor(Math.random() * 5)];

const userPrompt = `[ì²« ì§ˆë¬¸ ì´ˆì ]: ${firstQuestionFocus}
...`;
```

### ë°©ì•ˆ 3: ëˆ„ë½ ì •ë³´ ë¶„ì„ ë¡œì§ ê°œì„ 
```typescript
// spaceInfoë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‹¤ì œë¡œ ëˆ„ë½ëœ ì •ë³´ë§Œ í‘œì‹œ
function analyzeMissingInfo(
  messages: ChatMessage[],
  photoAnalysis: PhotoAnalysisResult | null,
  spaceInfo?: SpaceInfo  // ì¶”ê°€
): MissingInfo {
  // spaceInfoì— ì´ë¯¸ ìˆëŠ” ì •ë³´ëŠ” falseë¡œ ì„¤ì •
  return {
    spaceType: !hasPhoto && !spaceInfo?.housingType,
    activity: !hasActivityInfo(messages),
    // ...
  };
}
```

### ë°©ì•ˆ 4: ì²« ì§ˆë¬¸ í”„ë¡¬í”„íŠ¸ ë‹¤ì–‘í™”
```typescript
// ì²« ì§ˆë¬¸ì¼ ë•Œ ì—¬ëŸ¬ ê°€ì§€ ì ‘ê·¼ ë°©ì‹ ì¤‘ í•˜ë‚˜ë¥¼ ëœë¤ ì„ íƒ
const firstQuestionApproaches = [
  'ë¶ˆí¸í•œ ì  ì¤‘ì‹¬',
  'ì›í•˜ëŠ” ê³µê°„ ì¤‘ì‹¬',
  'ìƒí™œ íŒ¨í„´ ì¤‘ì‹¬',
  'ê°€ì¡± êµ¬ì„± ì¤‘ì‹¬',
  'ì˜ˆì‚° ì¤‘ì‹¬'
];
const approach = firstQuestionApproaches[Math.floor(Math.random() * firstQuestionApproaches.length)];
```

---

## âœ… ê²°ë¡ 

**ì£¼ìš” ë¬¸ì œì **:
1. âœ… Temperatureê°€ ë„ˆë¬´ ë‚®ìŒ (0.3)
2. âœ… ì²« ì§ˆë¬¸ ìƒì„± ì‹œ ì…ë ¥ ë°ì´í„°ê°€ í•­ìƒ ë™ì¼
3. âœ… ëˆ„ë½ ì •ë³´ ë¶„ì„ ë¡œì§ì´ ë‹¨ìˆœí•˜ì—¬ í•­ìƒ ê°™ì€ ê²°ê³¼ ë°˜í™˜

**ì˜í–¥**:
- ì²« ì§ˆë¬¸ì´ í•­ìƒ ë¹„ìŠ·í•˜ê²Œ ìƒì„±ë¨
- ì‚¬ìš©ì ê²½í—˜ ì €í•˜ (ì§ˆë¬¸ì´ ë°˜ë³µì ìœ¼ë¡œ ëŠê»´ì§)

**ìš°ì„  í•´ê²° í•„ìš”**:
1. Temperature ê°’ ì¡°ì • (0.3 â†’ 0.7 ì •ë„)
2. ì²« ì§ˆë¬¸ ìƒì„± ì‹œ ëœë¤ ìš”ì†Œ ë˜ëŠ” spaceInfo ê¸°ë°˜ ë‹¤ì–‘í™”
3. ëˆ„ë½ ì •ë³´ ë¶„ì„ ë¡œì§ ê°œì„  (ì‹¤ì œë¡œ ëˆ„ë½ëœ ì •ë³´ë§Œ í‘œì‹œ)

---

**ë¬¸ì„œ ë**


