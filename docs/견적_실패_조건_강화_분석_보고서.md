# ê²¬ì  ì‹¤íŒ¨ ì¡°ê±´ ê°•í™” ë¶„ì„ ë³´ê³ ì„œ

**ì‘ì„±ì¼**: 2024ë…„ 12ì›”  
**ë¶„ì„ ëŒ€ìƒ**: ê²¬ì  ì‹¤íŒ¨ ì¡°ê±´ ê°•í™” ëª…ì„¸ (í—Œë²• v1 ë³´ê°•)  
**ëª©ì **: í˜„ì¬ ì½”ë“œ ìƒíƒœ ë¶„ì„ ë° êµ¬í˜„ ë°©ì•ˆ ì œì‹œ

---

## ğŸ“‹ ê°œìš”

ê²¬ì  ì‹¤íŒ¨ ì¡°ê±´ ê°•í™” ëª…ì„¸ëŠ” **ì˜ëª»ëœ ê²¬ì ì´ ìƒì„±ë˜ì§€ ì•Šë„ë¡** ì—”ì§„ ë ˆë²¨ì—ì„œ ê²€ì¦ì„ ê°•í™”í•˜ëŠ” ê·œì¹™ì…ë‹ˆë‹¤. UI ë³´ì •Â·ë•œì§ˆì„ ì „ë©´ ê¸ˆì§€í•˜ê³ , ì¡°ê±´ ìœ„ë°˜ ì‹œ `ESTIMATE_FAILED` ìƒíƒœë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

---

## ğŸ” í˜„ì¬ ì½”ë“œ ìƒíƒœ ë¶„ì„

### 1. ê¸°ì¡´ ê²€ì¦ ë¡œì§ í˜„í™©

#### 1-1. `checkFailures` í•¨ìˆ˜ (2525-2548ì¤„)

**í˜„ì¬ êµ¬í˜„**:
```typescript
function checkFailures(
  processBlocks: ProcessEstimateBlock[],
  processSelections: Record<string, Record<string, string | string[] | null>>
): {
  failedProcesses: ProcessId[]
  reasons: string[]
} {
  const failures: { failedProcesses: ProcessId[]; reasons: string[] } = {
    failedProcesses: [],
    reasons: [],
  }

  // ê³µì • ì—†ì´ ê²¬ì  ìƒì„± ì²´í¬
  if (processBlocks.length === 0) {
    failures.reasons.push('ê³µì • ì—†ì´ ê²¬ì  ìƒì„± ì‹œë„')
  }

  // TODO: ë‚˜ë¨¸ì§€ ì‹¤íŒ¨ ì¡°ê±´ ì²´í¬
  // - í•„ìˆ˜ ì—°ë™ ê³µì • ëˆ„ë½
  // - DBì— ì—†ëŠ” ë‹¨ê°€ ì‚¬ìš©
  // - ê³ ê° ì…ë ¥ê³¼ ë¬´ê´€í•œ ê³µì • ì¶”ê°€

  return failures
}
```

**ë¬¸ì œì **:
- âœ… ê³µì • ì—†ìŒ ì²´í¬ë§Œ ì¡´ì¬
- âŒ ìì¬ ì‹¤íŒ¨ ì¡°ê±´ ê²€ì¦ ì—†ìŒ
- âŒ ë…¸ë¬´ ì‹¤íŒ¨ ì¡°ê±´ ê²€ì¦ ì—†ìŒ
- âŒ ê³µì • ì¤‘ë³µ ê²€ì¦ ì—†ìŒ
- âŒ ìˆ˜ëŸ‰ ì‹¤íŒ¨ ì¡°ê±´ ê²€ì¦ ë¶€ì¡±
- âŒ ì„¤ëª…-ê³„ì‚° ë¶ˆì¼ì¹˜ ê²€ì¦ ì—†ìŒ

#### 1-2. `createSingleProcessBlock` í•¨ìˆ˜ (893-1083ì¤„)

**í˜„ì¬ êµ¬í˜„**:
- âœ… `quantityBasis` ê²€ì¦ ì¡´ì¬ (`validateQuantityBasis` í˜¸ì¶œ)
- âœ… DB ì¡°íšŒ ì‹¤íŒ¨ ì‹œ `null` ë°˜í™˜ (969ì¤„)
- âŒ ìì¬ ì •ë³´ ë¶ˆì™„ì „ ì²´í¬ ì—†ìŒ
- âŒ ë…¸ë¬´ë¹„ ê³„ì‚° ë¶ˆê°€ ì²´í¬ ì—†ìŒ
- âŒ ì¤‘ë³µ ì²´í¬ ì—†ìŒ

**ìì¬ ì •ë³´ ìˆ˜ì§‘ ë¶€ë¶„** (1011-1031ì¤„):
```typescript
const materials = materialRequests.map((req, idx) => {
  const result = materialResults[idx]
  if (result.status !== 'SUCCESS' || !result.data) {
    throw new Error(`ìì¬ ë°ì´í„° ì—†ìŒ: ${req.category.category1}/${req.category.category2}`)
  }

  return {
    brandName: result.data.brandName,
    productName: result.data.productName,
    spec: result.data.spec,
    category: req.category,
    quantity: req.quantity.value,
    unit: req.quantity.unit,
    unitPrice: result.data.price,
    totalPrice: result.data.price * req.quantity.value, // âš ï¸ priceê°€ 0ì´ë©´ 0ì›
    // ...
  }
})
```

**ë¬¸ì œì **:
- âŒ `unitPrice === 0` ì²´í¬ ì—†ìŒ (ëª…ì„¸ 2-1 ìœ„ë°˜)
- âŒ ë¸Œëœë“œ/ê·œê²©/ë‹¨ìœ„ ëˆ„ë½ ì²´í¬ ì—†ìŒ (ëª…ì„¸ 2-2 ìœ„ë°˜)

**ë…¸ë¬´ ì •ë³´ ìˆ˜ì§‘ ë¶€ë¶„** (1033-1047ì¤„):
```typescript
const laborTotal = laborRequestsWithData.reduce((sum, { request, data }) => {
  const workDays = Math.ceil(request.totalQuantity / data.dailyOutput)
  const cost = workDays * data.crewSize * data.ratePerPersonDay * data.difficultyFactor
  return sum + Math.round(cost)
}, 0)
```

**ë¬¸ì œì **:
- âŒ `dailyOutput === 0` ì²´í¬ ì—†ìŒ (ëª…ì„¸ 3-2 ìœ„ë°˜)
- âŒ `crewSize === 0` ì²´í¬ ì—†ìŒ (ëª…ì„¸ 3-2 ìœ„ë°˜)
- âŒ `ratePerPersonDay === 0` ì²´í¬ ì—†ìŒ (ëª…ì„¸ 3-2 ìœ„ë°˜)

**calculationBasis ìƒì„± ë¶€ë¶„** (1068ì¤„):
```typescript
calculationBasis: `ì‘ì—…ëŸ‰ ${firstLabor.request.totalQuantity}${firstLabor.data.unit} Ã· 1ì¼ ì‘ì—…ëŸ‰ ${firstLabor.data.dailyOutput}${firstLabor.data.unit} = ${workDays}ì¼ Ã— ${firstLabor.data.crewSize}ì¸ Ã— ${firstLabor.data.ratePerPersonDay.toLocaleString()}ì› Ã— ë‚œì´ë„ ${firstLabor.data.difficultyFactor}`,
```

**ë¬¸ì œì **:
- âœ… ë‚œì´ë„ ê³„ìˆ˜ëŠ” í‘œì‹œë¨
- âš ï¸ í•˜ì§€ë§Œ `difficultyFactor !== 1`ì¸ë° í‘œì‹œë˜ì§€ ì•ŠëŠ” ê²½ìš° ì²´í¬ ì—†ìŒ (ëª…ì„¸ 6-1)

---

## ğŸ¯ ëª…ì„¸ ìš”êµ¬ì‚¬í•­ vs í˜„ì¬ êµ¬í˜„ ë¹„êµ

### 2. ìì¬ ì‹¤íŒ¨ ì¡°ê±´ (ëª…ì„¸ 2)

| ì¡°ê±´ | ëª…ì„¸ ìš”êµ¬ì‚¬í•­ | í˜„ì¬ êµ¬í˜„ | ìƒíƒœ |
|------|--------------|----------|------|
| ìˆ˜ëŸ‰ ì¡´ì¬ + ë‹¨ê°€ 0 | `quantity > 0 && unitPrice === 0` â†’ ì‹¤íŒ¨ | ì²´í¬ ì—†ìŒ | âŒ ë¯¸êµ¬í˜„ |
| ìì¬ ì •ë³´ ë¶ˆì™„ì „ | ë¸Œëœë“œ/ê·œê²©/ë‹¨ìœ„ ì—†ìŒ â†’ ì‹¤íŒ¨ | ì²´í¬ ì—†ìŒ | âŒ ë¯¸êµ¬í˜„ |

**í•„ìš” ì‘ì—…**:
- `createSingleProcessBlock` í•¨ìˆ˜ì—ì„œ ìì¬ ì •ë³´ ìˆ˜ì§‘ í›„ ê²€ì¦ ì¶”ê°€
- `checkFailures` í•¨ìˆ˜ì—ì„œ ì „ì²´ processBlocks ê²€ì¦ ì¶”ê°€

### 3. ë…¸ë¬´ ì‹¤íŒ¨ ì¡°ê±´ (ëª…ì„¸ 3)

| ì¡°ê±´ | ëª…ì„¸ ìš”êµ¬ì‚¬í•­ | í˜„ì¬ êµ¬í˜„ | ìƒíƒœ |
|------|--------------|----------|------|
| ì‹œê³µ ê³µì •ì¸ë° ë…¸ë¬´ë¹„ ì—†ìŒ | `materials.length > 0 && labor.totalLaborCost === 0` â†’ ì‹¤íŒ¨ | ì²´í¬ ì—†ìŒ | âŒ ë¯¸êµ¬í˜„ |
| ë…¸ë¬´ ìˆ˜ëŸ‰ ê³„ì‚° ë¶ˆê°€ | `dailyOutput === 0 \|\| crewSize === 0 \|\| ratePerPersonDay === 0` â†’ ì‹¤íŒ¨ | ì²´í¬ ì—†ìŒ | âŒ ë¯¸êµ¬í˜„ |

**í•„ìš” ì‘ì—…**:
- `createSingleProcessBlock` í•¨ìˆ˜ì—ì„œ ë…¸ë¬´ ì •ë³´ ìˆ˜ì§‘ í›„ ê²€ì¦ ì¶”ê°€
- `checkFailures` í•¨ìˆ˜ì—ì„œ ì „ì²´ processBlocks ê²€ì¦ ì¶”ê°€

### 4. ê³µì • ì¤‘ë³µ ì‹¤íŒ¨ ì¡°ê±´ (ëª…ì„¸ 4)

| ì¡°ê±´ | ëª…ì„¸ ìš”êµ¬ì‚¬í•­ | í˜„ì¬ êµ¬í˜„ | ìƒíƒœ |
|------|--------------|----------|------|
| ë™ì¼ ê³µì • ë¸”ë¡ ì¤‘ë³µ | `processId + ê³µê°„ + ê³µì • ìœ í˜•` ì¡°í•© ì¤‘ë³µ â†’ ì‹¤íŒ¨ | ì²´í¬ ì—†ìŒ | âŒ ë¯¸êµ¬í˜„ |
| ë™ì¼ ìì¬ ì¤‘ë³µ ì‚½ì… | ë¸Œëœë“œ + ì œí’ˆëª… + ê·œê²© + ë‹¨ìœ„ ì¤‘ë³µ â†’ ì‹¤íŒ¨ | ì²´í¬ ì—†ìŒ | âŒ ë¯¸êµ¬í˜„ |

**í•„ìš” ì‘ì—…**:
- `createProcessBlocksWithDB` í•¨ìˆ˜ì—ì„œ ì¤‘ë³µ ì²´í¬ ì¶”ê°€
- `checkFailures` í•¨ìˆ˜ì—ì„œ ì¤‘ë³µ ê²€ì¦ ì¶”ê°€

### 5. ìˆ˜ëŸ‰ ì‹¤íŒ¨ ì¡°ê±´ (ëª…ì„¸ 5)

| ì¡°ê±´ | ëª…ì„¸ ìš”êµ¬ì‚¬í•­ | í˜„ì¬ êµ¬í˜„ | ìƒíƒœ |
|------|--------------|----------|------|
| quantityBasis ëˆ„ë½ | `type`, `value`, `reason` ì—†ìŒ â†’ ì‹¤íŒ¨ | `validateQuantityBasis` ì¡´ì¬ | âœ… ë¶€ë¶„ êµ¬í˜„ |
| ìˆ˜ëŸ‰ 0 ë˜ëŠ” ìŒìˆ˜ | `value <= 0` â†’ ì‹¤íŒ¨ | `validateQuantityBasis`ì—ì„œ ì²´í¬ | âœ… êµ¬í˜„ë¨ |

**í•„ìš” ì‘ì—…**:
- `validateQuantityBasis` í•¨ìˆ˜ í™•ì¸ ë° ë³´ê°•

### 6. ì„¤ëª…-ê³„ì‚° ë¶ˆì¼ì¹˜ ì‹¤íŒ¨ ì¡°ê±´ (ëª…ì„¸ 6)

| ì¡°ê±´ | ëª…ì„¸ ìš”êµ¬ì‚¬í•­ | í˜„ì¬ êµ¬í˜„ | ìƒíƒœ |
|------|--------------|----------|------|
| ë‚œì´ë„ ê³„ìˆ˜ ë¯¸ë…¸ì¶œ | `difficultyFactor â‰  1`ì¸ë° `calculationBasis`ì— ë¯¸í‘œê¸° â†’ ì‹¤íŒ¨ | ë‚œì´ë„ ê³„ìˆ˜ëŠ” í‘œì‹œë¨ | âš ï¸ ê²€ì¦ í•„ìš” |

**í•„ìš” ì‘ì—…**:
- `calculationBasis`ì— ë‚œì´ë„ ê³„ìˆ˜ê°€ í¬í•¨ë˜ëŠ”ì§€ ê²€ì¦ ë¡œì§ ì¶”ê°€

---

## ğŸ› ï¸ êµ¬í˜„ ë°©ì•ˆ

### Phase 1: ìì¬ ì‹¤íŒ¨ ì¡°ê±´ ê²€ì¦ ì¶”ê°€

**ìœ„ì¹˜**: `lib/estimate/constitution-v1-engine.ts`

**1-1. `createSingleProcessBlock` í•¨ìˆ˜ ìˆ˜ì •** (1011-1031ì¤„ ì´í›„)

```typescript
// ìì¬ ì •ë³´ ìˆ˜ì§‘
const materials = materialRequests.map((req, idx) => {
  const result = materialResults[idx]
  if (result.status !== 'SUCCESS' || !result.data) {
    throw new Error(`ìì¬ ë°ì´í„° ì—†ìŒ: ${req.category.category1}/${req.category.category2}`)
  }

  const material = {
    brandName: result.data.brandName,
    productName: result.data.productName,
    spec: result.data.spec,
    category: req.category,
    quantity: req.quantity.value,
    unit: req.quantity.unit,
    unitPrice: result.data.price,
    totalPrice: result.data.price * req.quantity.value,
    dbSource: {
      table: 'materials',
      key: result.data.materialId,
    },
  }

  // âœ… ëª…ì„¸ 2-1: ìˆ˜ëŸ‰ ì¡´ì¬ + ë‹¨ê°€ 0 ì²´í¬
  if (material.quantity > 0 && material.unitPrice === 0) {
    throw new Error(`ìì¬ ë‹¨ê°€ 0ì›: ${material.productName || material.brandName} (ìˆ˜ëŸ‰: ${material.quantity}${material.unit})`)
  }

  // âœ… ëª…ì„¸ 2-2: ìì¬ ì •ë³´ ë¶ˆì™„ì „ ì²´í¬
  if (!material.brandName || !material.spec || !material.unit) {
    throw new Error(`ìì¬ ì •ë³´ ë¶ˆì™„ì „: ${material.productName || 'ì•Œ ìˆ˜ ì—†ìŒ'} (ë¸Œëœë“œ: ${material.brandName || 'ì—†ìŒ'}, ê·œê²©: ${material.spec || 'ì—†ìŒ'}, ë‹¨ìœ„: ${material.unit || 'ì—†ìŒ'})`)
  }

  return material
})
```

**1-2. `checkFailures` í•¨ìˆ˜ ìˆ˜ì •** (2525-2548ì¤„)

```typescript
function checkFailures(
  processBlocks: ProcessEstimateBlock[],
  processSelections: Record<string, Record<string, string | string[] | null>>
): {
  failedProcesses: ProcessId[]
  reasons: string[]
} {
  const failures: { failedProcesses: ProcessId[]; reasons: string[] } = {
    failedProcesses: [],
    reasons: [],
  }

  // ê³µì • ì—†ì´ ê²¬ì  ìƒì„± ì²´í¬
  if (processBlocks.length === 0) {
    failures.reasons.push('ê³µì • ì—†ì´ ê²¬ì  ìƒì„± ì‹œë„')
    return failures
  }

  // âœ… ëª…ì„¸ 2-1, 2-2: ìì¬ ì‹¤íŒ¨ ì¡°ê±´ ê²€ì¦
  for (const block of processBlocks) {
    for (const material of block.materials) {
      // ìˆ˜ëŸ‰ ì¡´ì¬ + ë‹¨ê°€ 0
      if (material.quantity > 0 && material.unitPrice === 0) {
        failures.failedProcesses.push(block.processId)
        failures.reasons.push(`ìì¬ ë‹¨ê°€ 0ì›: ${block.processName} - ${material.productName || material.brandName} (ìˆ˜ëŸ‰: ${material.quantity}${material.unit})`)
      }

      // ìì¬ ì •ë³´ ë¶ˆì™„ì „
      if (!material.brandName || !material.spec || !material.unit) {
        failures.failedProcesses.push(block.processId)
        failures.reasons.push(`ìì¬ ì •ë³´ ë¶ˆì™„ì „: ${block.processName} - ${material.productName || 'ì•Œ ìˆ˜ ì—†ìŒ'}`)
      }
    }
  }

  return failures
}
```

### Phase 2: ë…¸ë¬´ ì‹¤íŒ¨ ì¡°ê±´ ê²€ì¦ ì¶”ê°€

**2-1. `createSingleProcessBlock` í•¨ìˆ˜ ìˆ˜ì •** (1033-1047ì¤„ ì´í›„)

```typescript
// ë…¸ë¬´ ì •ë³´ ìˆ˜ì§‘
const laborRequestsWithData = laborRequests.map((req, idx) => {
  const result = laborResults[idx]
  if (result.status !== 'SUCCESS' || !result.data) {
    throw new Error(`ë…¸ë¬´ ë°ì´í„° ì—†ìŒ: ${req.processId}`)
  }

  // âœ… ëª…ì„¸ 3-2: ë…¸ë¬´ ìˆ˜ëŸ‰ ê³„ì‚° ë¶ˆê°€ ì²´í¬
  if (result.data.dailyOutput === 0) {
    throw new Error(`ë…¸ë¬´ 1ì¼ ì‘ì—…ëŸ‰ 0: ${req.processId}`)
  }
  if (result.data.crewSize === 0) {
    throw new Error(`ë…¸ë¬´ íˆ¬ì… ì¸ì› 0: ${req.processId}`)
  }
  if (result.data.ratePerPersonDay === 0) {
    throw new Error(`ë…¸ë¬´ ë‹¨ê°€ 0ì›: ${req.processId}`)
  }

  return { request: req, data: result.data }
})

// ë…¸ë¬´ë¹„ ê³„ì‚°
const laborTotal = laborRequestsWithData.reduce((sum, { request, data }) => {
  const workDays = Math.ceil(request.totalQuantity / data.dailyOutput)
  const cost = workDays * data.crewSize * data.ratePerPersonDay * data.difficultyFactor
  return sum + Math.round(cost)
}, 0)
```

**2-2. `checkFailures` í•¨ìˆ˜ ìˆ˜ì •** (ì¶”ê°€)

```typescript
// âœ… ëª…ì„¸ 3-1: ì‹œê³µ ê³µì •ì¸ë° ë…¸ë¬´ë¹„ ì—†ìŒ ì²´í¬
for (const block of processBlocks) {
  if (block.materials.length > 0 && block.labor.totalLaborCost === 0) {
    failures.failedProcesses.push(block.processId)
    failures.reasons.push(`ì‹œê³µ ê³µì •ì¸ë° ë…¸ë¬´ë¹„ ì—†ìŒ: ${block.processName} (ìì¬ë¹„: ${block.materialTotal}ì›)`)
  }
}
```

### Phase 3: ê³µì • ì¤‘ë³µ ì‹¤íŒ¨ ì¡°ê±´ ê²€ì¦ ì¶”ê°€

**3-1. `checkFailures` í•¨ìˆ˜ ìˆ˜ì •** (ì¶”ê°€)

```typescript
// âœ… ëª…ì„¸ 4-1: ë™ì¼ ê³µì • ë¸”ë¡ ì¤‘ë³µ ì²´í¬
const processBlockKeys = new Set<string>()
for (const block of processBlocks) {
  const key = `${block.processId}_${block.spaces.join(',')}_${block.processType}`
  if (processBlockKeys.has(key)) {
    failures.failedProcesses.push(block.processId)
    failures.reasons.push(`ë™ì¼ ê³µì • ë¸”ë¡ ì¤‘ë³µ: ${block.processName} (ê³µê°„: ${block.spaces.join(', ')}, ìœ í˜•: ${block.processType})`)
  }
  processBlockKeys.add(key)
}

// âœ… ëª…ì„¸ 4-2: ë™ì¼ ìì¬ ì¤‘ë³µ ì‚½ì… ì²´í¬
const materialKeys = new Set<string>()
for (const block of processBlocks) {
  for (const material of block.materials) {
    const key = `${material.brandName}_${material.productName}_${material.spec}_${material.unit}`
    if (materialKeys.has(key)) {
      failures.failedProcesses.push(block.processId)
      failures.reasons.push(`ë™ì¼ ìì¬ ì¤‘ë³µ ì‚½ì…: ${material.productName || material.brandName} (${material.spec})`)
    }
    materialKeys.add(key)
  }
}
```

### Phase 4: ìˆ˜ëŸ‰ ì‹¤íŒ¨ ì¡°ê±´ ê²€ì¦ ë³´ê°•

**4-1. `validateQuantityBasis` í•¨ìˆ˜ í™•ì¸** (492ì¤„)

í˜„ì¬ êµ¬í˜„ í™•ì¸ í•„ìš”:
- `type`, `value`, `reason` ëˆ„ë½ ì²´í¬ ì—¬ë¶€
- `value <= 0` ì²´í¬ ì—¬ë¶€

### Phase 5: ì„¤ëª…-ê³„ì‚° ë¶ˆì¼ì¹˜ ì‹¤íŒ¨ ì¡°ê±´ ê²€ì¦ ì¶”ê°€

**5-1. `checkFailures` í•¨ìˆ˜ ìˆ˜ì •** (ì¶”ê°€)

```typescript
// âœ… ëª…ì„¸ 6-1: ë‚œì´ë„ ê³„ìˆ˜ ë¯¸ë…¸ì¶œ ì²´í¬
for (const block of processBlocks) {
  if (block.labor && block.labor.difficultyFactor !== 1.0) {
    const hasDifficultyInBasis = block.labor.calculationBasis?.includes('ë‚œì´ë„') || 
                                  block.labor.calculationBasis?.includes('difficulty')
    if (!hasDifficultyInBasis) {
      failures.failedProcesses.push(block.processId)
      failures.reasons.push(`ë‚œì´ë„ ê³„ìˆ˜ ë¯¸ë…¸ì¶œ: ${block.processName} (ë‚œì´ë„: ${block.labor.difficultyFactor}, ê³„ì‚°ì‹ì— ë¯¸í‘œê¸°)`)
    }
  }
}
```

---

## ğŸ“ êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1: ìì¬ ì‹¤íŒ¨ ì¡°ê±´ (ìš°ì„ ìˆœìœ„: ê¸´ê¸‰)

- [ ] `createSingleProcessBlock` í•¨ìˆ˜ì— ìì¬ ë‹¨ê°€ 0ì› ì²´í¬ ì¶”ê°€
- [ ] `createSingleProcessBlock` í•¨ìˆ˜ì— ìì¬ ì •ë³´ ë¶ˆì™„ì „ ì²´í¬ ì¶”ê°€
- [ ] `checkFailures` í•¨ìˆ˜ì— ìì¬ ì‹¤íŒ¨ ì¡°ê±´ ê²€ì¦ ì¶”ê°€
- [ ] í…ŒìŠ¤íŠ¸: ìˆ˜ëŸ‰ ìˆì§€ë§Œ ë‹¨ê°€ 0ì›ì¸ ìì¬ â†’ `ESTIMATE_FAILED`
- [ ] í…ŒìŠ¤íŠ¸: ë¸Œëœë“œ/ê·œê²©/ë‹¨ìœ„ ëˆ„ë½ ìì¬ â†’ `ESTIMATE_FAILED`

### Phase 2: ë…¸ë¬´ ì‹¤íŒ¨ ì¡°ê±´ (ìš°ì„ ìˆœìœ„: ê¸´ê¸‰)

- [ ] `createSingleProcessBlock` í•¨ìˆ˜ì— ë…¸ë¬´ ìˆ˜ëŸ‰ ê³„ì‚° ë¶ˆê°€ ì²´í¬ ì¶”ê°€
- [ ] `checkFailures` í•¨ìˆ˜ì— ì‹œê³µ ê³µì •ì¸ë° ë…¸ë¬´ë¹„ ì—†ìŒ ì²´í¬ ì¶”ê°€
- [ ] í…ŒìŠ¤íŠ¸: `dailyOutput === 0` â†’ `ESTIMATE_FAILED`
- [ ] í…ŒìŠ¤íŠ¸: `crewSize === 0` â†’ `ESTIMATE_FAILED`
- [ ] í…ŒìŠ¤íŠ¸: `ratePerPersonDay === 0` â†’ `ESTIMATE_FAILED`
- [ ] í…ŒìŠ¤íŠ¸: ìì¬ ìˆì§€ë§Œ ë…¸ë¬´ë¹„ 0ì› â†’ `ESTIMATE_FAILED`

### Phase 3: ê³µì • ì¤‘ë³µ ì‹¤íŒ¨ ì¡°ê±´ (ìš°ì„ ìˆœìœ„: ë†’ìŒ)

- [ ] `checkFailures` í•¨ìˆ˜ì— ë™ì¼ ê³µì • ë¸”ë¡ ì¤‘ë³µ ì²´í¬ ì¶”ê°€
- [ ] `checkFailures` í•¨ìˆ˜ì— ë™ì¼ ìì¬ ì¤‘ë³µ ì‚½ì… ì²´í¬ ì¶”ê°€
- [ ] í…ŒìŠ¤íŠ¸: ë™ì¼ ê³µì • ë¸”ë¡ ì¤‘ë³µ â†’ `ESTIMATE_FAILED`
- [ ] í…ŒìŠ¤íŠ¸: ë™ì¼ ìì¬ ì¤‘ë³µ ì‚½ì… â†’ `ESTIMATE_FAILED`

### Phase 4: ìˆ˜ëŸ‰ ì‹¤íŒ¨ ì¡°ê±´ (ìš°ì„ ìˆœìœ„: ì¤‘ê°„)

- [ ] `validateQuantityBasis` í•¨ìˆ˜ í™•ì¸ ë° ë³´ê°•
- [ ] `quantityBasis.type` ëˆ„ë½ ì²´í¬
- [ ] `quantityBasis.value` ëˆ„ë½ ì²´í¬
- [ ] `quantityBasis.reason` ëˆ„ë½ ì²´í¬
- [ ] í…ŒìŠ¤íŠ¸: `quantityBasis` ëˆ„ë½ â†’ `ESTIMATE_FAILED`

### Phase 5: ì„¤ëª…-ê³„ì‚° ë¶ˆì¼ì¹˜ ì‹¤íŒ¨ ì¡°ê±´ (ìš°ì„ ìˆœìœ„: ì¤‘ê°„)

- [ ] `checkFailures` í•¨ìˆ˜ì— ë‚œì´ë„ ê³„ìˆ˜ ë¯¸ë…¸ì¶œ ì²´í¬ ì¶”ê°€
- [ ] í…ŒìŠ¤íŠ¸: `difficultyFactor !== 1`ì¸ë° `calculationBasis`ì— ë¯¸í‘œê¸° â†’ `ESTIMATE_FAILED`

### Phase 6: í†µí•© í…ŒìŠ¤íŠ¸

- [ ] ëª¨ë“  ì‹¤íŒ¨ ì¡°ê±´ì´ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸
- [ ] `ESTIMATE_FAILED` ìƒíƒœ ë°˜í™˜ ì‹œ ìˆ«ì ì¶œë ¥ ì•ˆ ë˜ëŠ”ì§€ í™•ì¸
- [ ] UIì—ì„œ ì‹¤íŒ¨ ë©”ì‹œì§€ê°€ ì •ìƒ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. UI ìˆ˜ì • ê¸ˆì§€

ëª…ì„¸ì— ëª…ì‹œëœ ëŒ€ë¡œ:
- âŒ 0ì› í•­ëª© í‘œì‹œ ê¸ˆì§€
- âŒ ì¤‘ë³µ í•­ëª© ìˆ¨ê¹€ ê¸ˆì§€
- âŒ ê²½ê³  ë¡œê·¸ë§Œ ì¶œë ¥í•˜ê³  ê³„ì† ì§„í–‰ ê¸ˆì§€
- âŒ ì„ì˜ ê¸°ë³¸ê°’ ì‚½ì… ê¸ˆì§€

**UIëŠ” ì˜¤ì§**:
- âœ… ì„±ê³µ ê²°ê³¼ ì¶œë ¥
- âœ… ì‹¤íŒ¨ ë©”ì‹œì§€ í‘œì‹œ

### 2. ì‹¤íŒ¨ ì²˜ë¦¬ ì¶œë ¥ ê·œì¹™

ì‹¤íŒ¨ ì‹œ:
- âŒ ìˆ«ì ì¶œë ¥ ê¸ˆì§€
- âŒ ë¶€ë¶„ í•©ê³„ ê¸ˆì§€
- âŒ ê³µì •ë³„ ê¸ˆì•¡ ê¸ˆì§€

ë°˜í™˜:
```typescript
{
  status: 'ESTIMATE_FAILED',
  reason: 'ëª…í™•í•œ ì‹¤íŒ¨ ì‚¬ìœ  ë¬¸ì¥',
  failedAt: 'ENGINE_VALIDATION'
}
```

### 3. ì ìš© ë²”ìœ„

- âœ… ëŒ€ìƒ íŒŒì¼: `lib/estimate/constitution-v1-engine.ts`ë§Œ ìˆ˜ì •
- âŒ UI, Adapter, page.tsxëŠ” ì ˆëŒ€ ìˆ˜ì • ëŒ€ìƒ ì•„ë‹˜

---

## ğŸ“Š ì˜ˆìƒ íš¨ê³¼

êµ¬í˜„ ì™„ë£Œ í›„:
- âœ… ì˜ëª»ëœ ê²¬ì ì´ ìƒì„±ë˜ì§€ ì•ŠìŒ
- âœ… 0ì› í‘œì‹œ ë¬¸ì œ ê·¼ë³¸ í•´ê²°
- âœ… ì¤‘ë³µ í•­ëª© ë¬¸ì œ ê·¼ë³¸ í•´ê²°
- âœ… ê³„ì‚°ì‹ ë¶ˆì¼ì¹˜ ë¬¸ì œ ê·¼ë³¸ í•´ê²°
- âœ… ê²¬ì  ì‹œìŠ¤í…œ ì‹ ë¢°ë„ í–¥ìƒ

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

1. **Phase 1-2 ìš°ì„  êµ¬í˜„** (ìì¬/ë…¸ë¬´ ì‹¤íŒ¨ ì¡°ê±´)
2. **Phase 3 êµ¬í˜„** (ê³µì • ì¤‘ë³µ ì‹¤íŒ¨ ì¡°ê±´)
3. **Phase 4-5 êµ¬í˜„** (ìˆ˜ëŸ‰/ì„¤ëª…-ê³„ì‚° ë¶ˆì¼ì¹˜ ì‹¤íŒ¨ ì¡°ê±´)
4. **í†µí•© í…ŒìŠ¤íŠ¸ ë° ê²€ì¦**

---

**ì‘ì„±ì**: AI Assistant  
**ê²€í†  í•„ìš”**: ê°œë°œíŒ€ ë¦¬ë·° í›„ êµ¬í˜„ ì‘ì—… ì§„í–‰













