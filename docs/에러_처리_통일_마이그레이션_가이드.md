# ì—ëŸ¬ ì²˜ë¦¬ í†µì¼ ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ

> **ì‘ì„±ì¼**: 2025-12-31  
> **ëª©ì **: ê¸°ì¡´ console.error/warnì„ í†µì¼ëœ loggerë¡œ, ì—ëŸ¬ ì²˜ë¦¬ë¥¼ í†µì¼ëœ íŒ¨í„´ìœ¼ë¡œ ì „í™˜

---

## ğŸ“‹ ê°œìš”

ì¸í…Œë¦¬ë´‡ í”„ë¡œì íŠ¸ì˜ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ í†µì¼í•˜ì—¬:
1. **ì—ëŸ¬ íƒ€ì… ì²´ê³„ êµ¬ì¶•** - `lib/errors/index.ts`
2. **í†µì¼ëœ ë¡œê±°** - `lib/utils/logger.ts`
3. **í†µì¼ëœ ì—ëŸ¬ í•¸ë“¤ëŸ¬** - `lib/utils/error-handler.ts`

---

## ğŸ¯ ëª©í‘œ

- âœ… 307ê°œì˜ console.error/warnì„ loggerë¡œ ì „í™˜
- âœ… ì¼ê´€ëœ ì—ëŸ¬ ì²˜ë¦¬ íŒ¨í„´ ì ìš©
- âœ… ì‚¬ìš©ì ì¹œí™”ì  ì—ëŸ¬ ë©”ì‹œì§€ ì œê³µ
- âœ… í”„ë¡œë•ì…˜/ê°œë°œ í™˜ê²½ ë¶„ë¦¬

---

## ğŸ“š ìƒˆë¡œìš´ ì—ëŸ¬ íƒ€ì…

### ê¸°ë³¸ ì—ëŸ¬ í´ë˜ìŠ¤

```typescript
import { InteriBotError, ErrorCode } from '@/lib/errors'

// ì—ëŸ¬ ì½”ë“œ
type ErrorCode =
  | 'VALIDATION_ERROR'
  | 'ESTIMATE_ERROR'
  | 'ANALYSIS_ERROR'
  | 'DATABASE_ERROR'
  | 'API_ERROR'
  | 'UNEXPECTED_ERROR'
```

### ì£¼ìš” ì—ëŸ¬ í´ë˜ìŠ¤

```typescript
import {
  ValidationError,
  EstimateError,
  AnalysisError,
  DatabaseError,
  ApiError,
  UnexpectedError,
} from '@/lib/errors'

// ê²€ì¦ ì—ëŸ¬
throw new ValidationError('pyeong', 'í‰ìˆ˜ëŠ” 1 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.')

// ê²¬ì  ì—ëŸ¬
throw new EstimateError(
  'kitchen',
  'ìì¬ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.',
  'MATERIAL_OR_LABOR_VALIDATION'
)

// ë¶„ì„ ì—ëŸ¬
throw new AnalysisError('V5_ANALYSIS', 'íƒœê·¸ ìƒì„± ì‹¤íŒ¨')
```

---

## ğŸ“ Logger ì‚¬ìš©ë²•

### ê¸°ë³¸ ì‚¬ìš©

```typescript
import { logger } from '@/lib/utils/logger'

// Debug ë¡œê·¸ (ê°œë°œ í™˜ê²½ì—ì„œë§Œ)
logger.debug('ë””ë²„ê·¸ ë©”ì‹œì§€', { context: 'value' })

// Info ë¡œê·¸
logger.info('ì •ë³´ ë©”ì‹œì§€', { userId: 123 })

// Warning ë¡œê·¸
logger.warn('ê²½ê³  ë©”ì‹œì§€', { field: 'pyeong' })

// Error ë¡œê·¸
logger.error('ì—ëŸ¬ ë©”ì‹œì§€', error, { context: 'value' })

// ì—ëŸ¬ ê°ì²´ ë¡œê¹…
logger.logError(error, { operation: 'calculateEstimate' })
```

### ëª¨ë“ˆë³„ Logger

```typescript
import { createLogger } from '@/lib/utils/logger'

const logger = createLogger('EstimateEngine')

logger.info('ê²¬ì  ê³„ì‚° ì‹œì‘', { pyeong: 30 })
logger.error('ê²¬ì  ê³„ì‚° ì‹¤íŒ¨', error, { processId: 'kitchen' })
```

---

## ğŸ”„ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒ¨í„´

### íŒ¨í„´ 1: console.error â†’ logger

**Before:**
```typescript
try {
  // ...
} catch (error) {
  console.error('[ESTIMATE_ERROR]', error)
}
```

**After:**
```typescript
import { logger } from '@/lib/utils/logger'

try {
  // ...
} catch (error) {
  logger.logError(error, { operation: 'estimate' })
}
```

---

### íŒ¨í„´ 2: ì—ëŸ¬ throw â†’ í†µì¼ëœ ì—ëŸ¬ íƒ€ì…

**Before:**
```typescript
if (!pyeong || pyeong < 1) {
  throw new Error('í‰ìˆ˜ëŠ” 1 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.')
}
```

**After:**
```typescript
import { ValidationError } from '@/lib/errors'

if (!pyeong || pyeong < 1) {
  throw new ValidationError('pyeong', 'í‰ìˆ˜ëŠ” 1 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.')
}
```

---

### íŒ¨í„´ 3: API ë¼ìš°íŠ¸ ì—ëŸ¬ ì²˜ë¦¬

**Before:**
```typescript
export async function POST(request: NextRequest) {
  try {
    // ...
  } catch (error) {
    console.error('API ì˜¤ë¥˜:', error)
    return NextResponse.json(
      { error: 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' },
      { status: 500 }
    )
  }
}
```

**After:**
```typescript
import { createErrorResponse } from '@/lib/utils/error-handler'

export async function POST(request: NextRequest) {
  try {
    // ...
  } catch (error) {
    return createErrorResponse(error)
  }
}
```

---

### íŒ¨í„´ 4: ê²¬ì  ì—ëŸ¬ ì²˜ë¦¬ (í—Œë²• v1.1 í˜¸í™˜)

**Before:**
```typescript
import { EstimateValidationError } from '@/lib/types/í—Œë²•_ê²¬ì _íƒ€ì…'

try {
  // ...
} catch (error) {
  if (error instanceof EstimateValidationError) {
    return NextResponse.json(
      {
        status: 'ESTIMATE_FAILED',
        reason: error.reason,
      },
      { status: 422 }
    )
  }
}
```

**After:**
```typescript
import { createEstimateErrorResponse } from '@/lib/utils/error-handler'
import { adaptEstimateValidationError } from '@/lib/errors/adapters'

try {
  // ...
} catch (error) {
  // ê¸°ì¡´ EstimateValidationErrorë„ ìë™ ë³€í™˜ë¨
  return createEstimateErrorResponse(error)
}
```

---

## ğŸ”§ ê¸°ì¡´ ì—ëŸ¬ íƒ€ì… í˜¸í™˜ì„±

### EstimateValidationError

ê¸°ì¡´ `EstimateValidationError`ëŠ” ê·¸ëŒ€ë¡œ ì‚¬ìš© ê°€ëŠ¥í•˜ë©°, ìë™ìœ¼ë¡œ `EstimateError`ë¡œ ë³€í™˜ë©ë‹ˆë‹¤:

```typescript
import { EstimateValidationError } from '@/lib/types/í—Œë²•_ê²¬ì _íƒ€ì…'
import { adaptEstimateValidationError } from '@/lib/errors/adapters'

try {
  throw new EstimateValidationError({
    processId: 'kitchen',
    reason: 'ìì¬ ë°ì´í„° ì—†ìŒ',
  })
} catch (error) {
  // ìë™ ë³€í™˜
  const adapted = adaptEstimateValidationError(error as EstimateValidationError)
  // ë˜ëŠ” createEstimateErrorResponseê°€ ìë™ ì²˜ë¦¬
}
```

---

## ğŸ“Š ë§ˆì´ê·¸ë ˆì´ì…˜ ìš°ì„ ìˆœìœ„

### Phase 1: í•µì‹¬ API ë¼ìš°íŠ¸ (ìš°ì„ ìˆœìœ„ ë†’ìŒ)

1. `app/api/estimate/constitution/route.ts`
2. `app/api/estimate/v4/route.ts`
3. `app/api/analyze/v5/route.ts`

### Phase 2: ì„œë¹„ìŠ¤ ë ˆì´ì–´

1. `lib/services/material-service-strict.ts`
2. `lib/services/labor-service-strict.ts`
3. `lib/estimate/constitution-v1-engine.ts`

### Phase 3: ì—”ì§„ ë ˆì´ì–´

1. `lib/analysis/v5-ultimate/`
2. `lib/estimate-v4/`

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œ í™•ì¸ì‚¬í•­:

- [ ] `console.error` â†’ `logger.error` ë˜ëŠ” `logger.logError`
- [ ] `console.warn` â†’ `logger.warn`
- [ ] `console.log` â†’ `logger.info` ë˜ëŠ” `logger.debug`
- [ ] `throw new Error()` â†’ ì ì ˆí•œ ì—ëŸ¬ íƒ€ì… ì‚¬ìš©
- [ ] API ë¼ìš°íŠ¸ì—ì„œ `createErrorResponse` ì‚¬ìš©
- [ ] ê²¬ì  APIì—ì„œ `createEstimateErrorResponse` ì‚¬ìš©
- [ ] ë¶„ì„ APIì—ì„œ `createAnalysisErrorResponse` ì‚¬ìš©

---

## ğŸš¨ ì£¼ì˜ì‚¬í•­

1. **ê¸°ì¡´ ì—ëŸ¬ íƒ€ì… ìœ ì§€**
   - `EstimateValidationError`ëŠ” í—Œë²• v1.1ì—ì„œ ê³„ì† ì‚¬ìš©
   - ì–´ëŒ‘í„°ë¥¼ í†µí•´ ìë™ ë³€í™˜

2. **ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜**
   - í•œ ë²ˆì— ëª¨ë“  íŒŒì¼ ìˆ˜ì •í•˜ì§€ ì•ŠìŒ
   - íŒŒì¼ë³„ë¡œ ë‹¨ê³„ì  ì „í™˜

3. **í…ŒìŠ¤íŠ¸ í•„ìˆ˜**
   - ë§ˆì´ê·¸ë ˆì´ì…˜ í›„ í•´ë‹¹ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
   - ì—ëŸ¬ ì‘ë‹µ í˜•ì‹ í™•ì¸

---

## ğŸ“š ì°¸ê³  íŒŒì¼

- `lib/errors/index.ts` - ì—ëŸ¬ íƒ€ì… ì •ì˜
- `lib/utils/logger.ts` - ë¡œê±° êµ¬í˜„
- `lib/utils/error-handler.ts` - ì—ëŸ¬ í•¸ë“¤ëŸ¬
- `lib/errors/adapters.ts` - ê¸°ì¡´ ì—ëŸ¬ íƒ€ì… ì–´ëŒ‘í„°

---

**ì‘ì„± ì™„ë£Œ** âœ…
