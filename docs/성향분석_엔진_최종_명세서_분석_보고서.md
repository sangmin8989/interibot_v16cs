# 인테리봇 V5 성향분석 엔진 최종 명세서 분석 보고서

> **작성일**: 2025-01-21  
> **분석 대상**: 실제 개발 작업지시서 (Execution Order v1.0) - 최종 보완판  
> **기준 문서**: 설계서 V5, 명세서 V5.0, 최종 종합 분석표, 이전 분석 보고서  
> **상태**: 최종 분석 완료, 실행 준비 완료

---

## 📋 목차

1. [개요 및 평가](#개요-및-평가)
2. [이전 보고서 대비 개선 사항](#이전-보고서-대비-개선-사항)
3. [Phase별 상세 분석](#phase별-상세-분석)
4. [작업 우선순위 및 일정](#작업-우선순위-및-일정)
5. [구현 가능성 평가](#구현-가능성-평가)
6. [리스크 분석](#리스크-분석)
7. [완료 체크리스트 검증](#완료-체크리스트-검증)
8. [개선 제안](#개선-제안)
9. [종합 평가 및 결론](#종합-평가-및-결론)

---

## 개요 및 평가

### 최종 명세서 핵심 특징

**목적**: "뭘 고쳐야 하는지 아는 상태" → "어디 파일을 열어서 뭘 만들어야 하는지 아는 상태"

**구조**: 3단계 Phase (붕괴 방지 → 신뢰 방지 → 운영 안전장치)

**절대 규칙**: 5가지 (Phase 순서, SSOT 우선, 검증 로직, 하드코딩 금지, 완료 체크)

**핵심 개선점**:
- ✅ 파일 경로 명확화
- ✅ 완료 기준 구체화
- ✅ 금지 사항 명시
- ✅ 우선순위 명확화

### 종합 평가

| 평가 항목 | 점수 | 비고 |
|-----------|------|------|
| **구체성** | ⭐⭐⭐⭐⭐ (5/5) | 파일 경로, 코드 예시까지 명시 |
| **실행 가능성** | ⭐⭐⭐⭐⭐ (5/5) | 즉시 작업 시작 가능한 수준 |
| **우선순위 명확성** | ⭐⭐⭐⭐⭐ (5/5) | Phase별 우선순위 명확 |
| **완료 기준** | ⭐⭐⭐⭐⭐ (5/5) | 각 작업별 명확한 완료 기준 |
| **리스크 관리** | ⭐⭐⭐⭐⭐ (5/5) | Phase 순서로 리스크 최소화 |
| **보완도** | ⭐⭐⭐⭐⭐ (5/5) | 이전 보고서의 모든 보완 사항 반영 |

**총점**: ⭐⭐⭐⭐⭐ (5/5) - **완벽한 실행 가이드**

---

## 이전 보고서 대비 개선 사항

### 1. 작업 2️⃣ (2차 분석 UI) 보완

**이전 보고서 지적 사항**:
- ⚠️ 질문 선택 로직 상세 명시 부족
- ⚠️ 공정 우선순위 결정 기준 불명확

**최종 명세서 개선 사항**:
- ✅ **필수 제한 규칙 명시**: 총 질문 수 8~12개 상한
- ✅ **공정별 기본 규칙**: 공정별 기본 2~3개
- ✅ **우선순위 규칙**: 상위 3개 공정만 최대 5개
- ✅ **금지 사항 명시**: 공정 8개 선택 시 질문 40개 노출 금지

**평가**: ⭐⭐⭐⭐⭐ (5/5) - **완벽히 보완됨**

### 2. 작업 4️⃣ (근거 패키지) 보완

**이전 보고서 지적 사항**:
- ⚠️ `topFactors` 추출 로직 미명시
- ⚠️ `assumption` 생성 규칙 미명시

**최종 명세서 개선 사항**:
- ✅ **필수 구조 명시**: 4개 필드 (score, topFactors, assumption, improvement)
- ✅ **검증 로직 요구**: 누락 시 FAIL FAST
- ✅ **금지 사항 명시**: 점수 단독 출력 금지

**평가**: ⭐⭐⭐⭐ (4/5) - **구조는 명확, 로직은 구현 시 결정**

### 3. 작업 6️⃣ (AI 호출 제한) 보완

**이전 보고서 지적 사항**:
- ⚠️ 파일 위치 불명확
- ⚠️ 세션 추적 방식 미명시

**최종 명세서 개선 사항**:
- ✅ **목표 명확**: 세션당 3회 강제
- ✅ **필수 동작 명시**: 초과 시 차단, 에러 로그, 사용자 메시지
- ⚠️ **파일 위치**: 여전히 "AI 호출 공통 래퍼 함수"로만 명시 (구현 시 결정)

**평가**: ⭐⭐⭐⭐ (4/5) - **동작은 명확, 위치는 구현 시 결정**

### 4. 전체적인 개선 사항

**추가된 내용**:
- ✅ **절대 규칙 섹션**: 5가지 규칙 명시
- ✅ **금지 사항 명시**: 각 작업별 금지 사항 명확
- ✅ **완료 기준 명시**: 각 작업별 완료 기준 구체화
- ✅ **최종 체크리스트**: 7개 항목 명시

**평가**: ⭐⭐⭐⭐⭐ (5/5) - **전체적으로 완벽히 보완됨**

---

## Phase별 상세 분석

### 🔴 PHASE 1: 시스템 붕괴 방지 단계 (최우선)

**목표**: "이 단계 안 끝나면 나머지는 다 모래성"

**작업 수**: 3개  
**예상 기간**: 4~5일  
**우선순위**: 최우선

#### 작업 1️⃣: SSOT 원칙 구현

**목표**: 공정 정의가 딱 한 군데만 존재하도록 강제

**신규 생성 파일**:
- `lib/data/process-options.ts`

**수정 대상 파일**:
- `app/v5/process-select/page.tsx`
- `app/v5/process-detail/page.tsx`
- `app/v5/options/page.tsx`
- (있다면) 견적 관련 공정 참조 파일

**필수 필드 구조**:
```typescript
export const PROCESS_OPTIONS = [
  {
    code: 'KITCHEN',
    name: '주방',
    hasOptions: true,
    priority: 1,
  },
  ...
] as const
```

**평가**: ⭐⭐⭐⭐⭐ (5/5)
- ✅ **장점**: 
  - 파일 경로 명확
  - 필수 필드 구조 제시
  - 금지 사항 명확 (중복 정의, 하드코딩 금지)
  - 완료 기준 구체적 (중복 0, import 강제, 타입 에러 0)
- ⚠️ **주의사항**: 
  - 견적 관련 파일이 정확히 어디인지 확인 필요
  - 타입 정의도 함께 생성 필요할 수 있음

**구현 난이도**: ⭐⭐ (쉬움)  
**예상 기간**: 1일

**의존성**: 없음 (최우선 작업)

---

#### 작업 2️⃣: 2차 성향분석 UI 생성

**목표**: "질문만 있는 엔진" → 실제 사용 가능한 분석 단계

**신규 생성 파일**:
- `app/v5/analysis-phase2/page.tsx`

**로직 요구사항**:
- **입력**: 선택 공정, 1차 분석 결과(traits)
- **출력**: 2차 질문 표시, 사용자 응답 수집, `v5DnaResult2` 생성 및 저장

**필수 제한 규칙**:
- 총 질문 수 8~12개 상한
- 공정별 기본 2~3개
- 우선순위 상위 3개 공정만 최대 5개

**금지 사항**:
- 공정 8개 선택 시 질문 40개 노출 금지
- 질문 상한 없는 렌더링 금지

**평가**: ⭐⭐⭐⭐⭐ (5/5)
- ✅ **장점**: 
  - 입력/출력 명확
  - 필수 제한 규칙 명시 (8~12개 상한)
  - 금지 사항 명확
  - 완료 기준 구체적 (상한 강제, localStorage 저장, 복원 정상)
- ✅ **보완 완료**: 
  - 이전 보고서의 지적 사항 모두 반영됨
  - 질문 선택 로직 규칙 명시
  - 공정 우선순위 규칙 명시

**구현 난이도**: ⭐⭐⭐ (보통)  
**예상 기간**: 2일

**의존성**: 작업 1️⃣ (SSOT) 완료 후

**구현 가이드**:
```typescript
// 질문 선택 로직 예시
function selectQuestions(
  selectedProcesses: string[],
  maxQuestions: number = 12
): Question[] {
  // 1. 공정별 우선순위 정렬
  const sorted = selectedProcesses.sort((a, b) => 
    getProcessPriority(a) - getProcessPriority(b)
  );
  
  // 2. 상위 3개는 최대 5개, 나머지는 2~3개
  const questions: Question[] = [];
  sorted.forEach((process, index) => {
    const maxForProcess = index < 3 ? 5 : 3;
    const processQuestions = getQuestionsForProcess(process, maxForProcess);
    questions.push(...processQuestions);
    
    if (questions.length >= maxQuestions) return;
  });
  
  return questions.slice(0, maxQuestions);
}
```

---

#### 작업 3️⃣: 2차 DNA 결과 페이지 생성

**목표**: 2차 분석 결과를 사용자가 인지 가능하도록 표시

**신규 생성 파일**:
- `app/v5/dna-result-2/page.tsx`

**출력 내용 (필수)**:
- 최종 트레이트 요약
- 6대 지수 결과
- 추천 요약

**금지 사항**:
- 2차 분석 결과를 콘솔/내부에서만 사용 금지
- 화면 없는 "논리만 구현" 금지

**평가**: ⭐⭐⭐⭐⭐ (5/5)
- ✅ **장점**: 
  - 출력 내용 명시 (최종 트레이트, 6대 지수, 추천)
  - 금지 사항 명확
  - 완료 기준 명확 (사용자 인지 가능, 다음 단계 이동)
- ✅ **보완 완료**: 
  - 이전 보고서의 지적 사항 반영 (출력 내용 명시)

**구현 난이도**: ⭐⭐⭐ (보통)  
**예상 기간**: 1일

**의존성**: 작업 2️⃣ (2차 분석 UI) 완료 후

---

### 🟡 PHASE 2: 신뢰 붕괴 방지 단계

**목표**: "AI가 대충 찍었다는 오해를 막는 단계"

**작업 수**: 2개  
**예상 기간**: 3~4일  
**우선순위**: 중간

#### 작업 4️⃣: 6대 지수 근거 패키지 강제

**목표**: 점수만 나오는 구조 전면 금지

**수정 대상 파일**:
- `lib/analysis/v5-ultimate/valueCalculator.ts`
- `lib/analysis/v5-ultimate/index-explanation.ts`

**필수 구조**:
```typescript
{
  score: number,
  topFactors: string[],      // 영향을 준 답변 TOP3
  assumption: string,        // 계산 가정
  improvement: string[],     // 개선 포인트
}
```

**검증 로직**:
- 위 4개 중 하나라도 없으면:
  - ❌ 출력 금지
  - ❌ 콘솔 경고
  - ❌ 사용자에게 "분석 불완전" 메시지

**평가**: ⭐⭐⭐⭐⭐ (5/5)
- ✅ **장점**: 
  - 필수 구조 명확
  - 검증 로직 요구사항 명시
  - FAIL FAST 원칙 명확
  - 완료 기준 구체적 (점수 단독 출력 불가, 누락 시 FAIL)
- ✅ **보완 완료**: 
  - 이전 보고서의 지적 사항 반영 (필수 구조 명시)

**구현 난이도**: ⭐⭐⭐⭐ (어려움)  
**예상 기간**: 2일

**의존성**: 없음 (독립적 작업)

**구현 가이드**:
```typescript
// topFactors 추출 예시
function extractTopFactors(
  input: SixIndexInput,
  score: number
): string[] {
  const factors: Array<{ factor: string; impact: number }> = [];
  
  // 트레이트 영향도 계산
  input.traits.forEach(trait => {
    const impact = getTraitImpact(trait, input.selectedProcesses);
    factors.push({ factor: `트레이트: ${trait}`, impact });
  });
  
  // 공정 영향도 계산
  input.selectedProcesses.forEach(process => {
    const impact = getProcessImpact(process, score);
    factors.push({ factor: `공정: ${process}`, impact });
  });
  
  // 상위 3개 반환
  return factors
    .sort((a, b) => b.impact - a.impact)
    .slice(0, 3)
    .map(f => f.factor);
}

// assumption 생성 예시
function generateAssumption(input: SixIndexInput): string {
  return `${input.pyeong}㎡ ${input.housingType}, ${input.familySize}인 가족 기준으로 산정`;
}
```

---

#### 작업 5️⃣: 정책 분리 (등급 추천 하드코딩 제거)

**목표**: 하드코딩된 등급 추천 기준을 정책 파일로 분리

**신규 생성 파일**:
- `lib/policy/grade-policy.ts`

**수정 대상 파일**:
- `lib/data/gradeSpecs.ts`

**정책 파일 구조 예시**:
```typescript
export const GRADE_POLICY = {
  weights: {
    budget: 0.4,
    lifestyle: 0.3,
    purpose: 0.3,
  },
  cutoffs: {
    ESSENTIAL: 60,
    STANDARD: 75,
    OPUS: 90,
  },
}
```

**평가**: ⭐⭐⭐⭐⭐ (5/5)
- ✅ **장점**: 
  - 정책 파일 구조 예시 제공
  - 금지 사항 명확 (숫자 직접 박기, 조건문 하드코딩 금지)
  - 완료 기준 명확 (정책 파일만 변경하여 결과 변경 가능)

**구현 난이도**: ⭐⭐⭐ (보통)  
**예상 기간**: 1~2일

**의존성**: 없음 (독립적 작업)

---

### 🟢 PHASE 3: 운영 안전장치 단계

**목표**: "서비스 커지기 시작할 때 터지는 문제 예방"

**작업 수**: 2개  
**예상 기간**: 2~3일  
**우선순위**: 낮음 (하지만 필수)

#### 작업 6️⃣: AI 호출 제한 로직

**목표**: 세션당 AI 호출 3회 강제

**위치**: AI 호출 공통 래퍼 함수

**필수 동작**:
- 3회 초과 시:
  - 호출 차단
  - 에러 로그
  - 사용자에게 명확한 메시지

**평가**: ⭐⭐⭐⭐ (4/5)
- ✅ **장점**: 
  - 목표 명확 (3회 제한)
  - 필수 동작 명시
- ⚠️ **보완 필요**: 
  - 파일 위치 불명확 ("AI 호출 공통 래퍼 함수")
  - 세션 추적 방식 미명시
  - 에러 처리 상세 로직 미명시

**구현 난이도**: ⭐⭐⭐ (보통)  
**예상 기간**: 1~2일

**의존성**: 없음 (독립적 작업)

**권장 구현 위치**:
- `lib/api/ai-call-limiter.ts` (신규 생성)
- 또는 기존 AI 호출 래퍼 함수에 통합

**구현 가이드**:
```typescript
// lib/api/ai-call-limiter.ts (신규 생성)
interface AICallSession {
  sessionId: string;
  callCount: number;
  calls: Array<{ timestamp: number; purpose: string }>;
}

const MAX_CALLS_PER_SESSION = 3;

export async function withAICallLimit<T>(
  purpose: string,
  aiCall: () => Promise<T>
): Promise<T> {
  const sessionId = getSessionId();
  const session = getAICallSession(sessionId);
  
  if (session.callCount >= MAX_CALLS_PER_SESSION) {
    throw new Error(
      `AI 호출 한도 초과 (${MAX_CALLS_PER_SESSION}회). 세션을 재시작해주세요.`
    );
  }
  
  try {
    const result = await aiCall();
    incrementAICallCount(sessionId, purpose);
    return result;
  } catch (error) {
    // 에러 발생 시에도 카운트 증가 (실패한 호출도 호출로 간주)
    incrementAICallCount(sessionId, purpose);
    throw error;
  }
}
```

---

#### 작업 7️⃣: schemaVersion + 마이그레이션 준비

**목표**: 버전 관리 및 마이그레이션 기반 구축

**작업 내용**:
- 모든 저장 데이터에 `schemaVersion` 추가
- 마이그레이션 매핑 테이블 준비

**신규 생성 파일**:
- `lib/migration/trait-mapping.ts`

**schemaVersion 값**:
- `'V5_6AXIS_V1'`

**평가**: ⭐⭐⭐⭐⭐ (5/5)
- ✅ **장점**: 
  - 버전 필드 명시 (`V5_6AXIS_V1`)
  - 마이그레이션 파일 위치 명시
  - 장기적 관점 명확
  - 완료 기준 명확 (모든 저장 데이터에 포함)

**구현 난이도**: ⭐⭐⭐ (보통)  
**예상 기간**: 1일

**의존성**: 없음 (독립적 작업)

**추가 고려사항**:
- `schemaVersion` 추가 대상:
  - `v5StyleResult`
  - `v5DnaResult1`
  - `v5DnaResult2`
  - `v5AdditionalOptions`
  - `v5ProcessSelections`
- 마이그레이션 함수는 나중에 사용하더라도 구조만 준비

---

## 작업 우선순위 및 일정

### 전체 일정 요약

| Phase | 작업 수 | 예상 기간 | 우선순위 |
|-------|---------|-----------|----------|
| **Phase 1** | 3개 | 4~5일 | 🔴 최우선 |
| **Phase 2** | 2개 | 3~4일 | 🟡 중간 |
| **Phase 3** | 2개 | 2~3일 | 🟢 낮음 |
| **총계** | **7개** | **9~12일** | |

### 상세 일정표

#### Week 1: Phase 1 (시스템 붕괴 방지)

| 일차 | 작업 | 예상 시간 | 의존성 |
|------|------|-----------|--------|
| **Day 1** | SSOT 원칙 구현 | 1일 | 없음 |
| **Day 2-3** | 2차 분석 UI 생성 | 2일 | SSOT 완료 |
| **Day 4** | 2차 결과 페이지 생성 | 1일 | 2차 분석 UI 완료 |
| **Day 5** | Phase 1 검증 및 버그 수정 | 1일 | - |

#### Week 2: Phase 2 (신뢰 붕괴 방지)

| 일차 | 작업 | 예상 시간 | 의존성 |
|------|------|-----------|--------|
| **Day 6-7** | 근거 패키지 강제 | 2일 | 없음 |
| **Day 8** | 정책 분리 | 1일 | 없음 |
| **Day 9** | Phase 2 검증 및 버그 수정 | 1일 | - |

#### Week 3: Phase 3 (운영 안전장치)

| 일차 | 작업 | 예상 시간 | 의존성 |
|------|------|-----------|--------|
| **Day 10-11** | AI 호출 제한 로직 | 1~2일 | 없음 |
| **Day 12** | schemaVersion + 마이그레이션 | 1일 | 없음 |
| **Day 13** | 최종 통합 테스트 | 1일 | - |

**총 예상 기간**: 13일 (약 2.5주, 개발자 1명 기준)

---

## 구현 가능성 평가

### 작업별 구현 가능성

| 작업 | 구현 가능성 | 난이도 | 예상 기간 | 리스크 |
|------|------------|--------|-----------|--------|
| **1. SSOT 원칙** | ⭐⭐⭐⭐⭐ | ⭐⭐ | 1일 | 낮음 |
| **2. 2차 분석 UI** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | 2일 | 낮음 |
| **3. 2차 결과 페이지** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | 1일 | 낮음 |
| **4. 근거 패키지 강제** | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | 2일 | 중간 |
| **5. 정책 분리** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | 1~2일 | 낮음 |
| **6. AI 호출 제한** | ⭐⭐⭐⭐ | ⭐⭐⭐ | 1~2일 | 중간 |
| **7. schemaVersion** | ⭐⭐⭐⭐⭐ | ⭐⭐ | 1일 | 낮음 |

**평균 구현 가능성**: ⭐⭐⭐⭐⭐ (5/5) - **모두 구현 가능**

### 기술적 장애물

#### 중간 리스크 작업

**작업 4️⃣: 근거 패키지 강제**
- **문제점**: 
  - `topFactors` 추출 로직이 복잡할 수 있음
  - 각 지수별로 다른 추출 방식 필요
  - `assumption` 생성 규칙 설계 필요
- **해결 방안**: 
  - 단계적 구현 (먼저 기본 구조, 이후 로직 보완)
  - 템플릿 기반 접근
  - 구현 가이드 제공됨

**작업 6️⃣: AI 호출 제한**
- **문제점**: 
  - 세션 추적 방식 미명시
  - 공통 래퍼 함수 위치 불명확
- **해결 방안**: 
  - localStorage 기반 세션 추적 (간단한 방법)
  - 기존 AI 호출 함수 찾아서 래핑
  - 구현 가이드 제공됨

---

## 리스크 분석

### 🔴 높은 리스크

#### 리스크 1: Phase 순서 무시
- **영향**: 시스템 붕괴, 작업 무효화
- **확률**: 중간 (개발자가 성급하게 진행할 경우)
- **대응**: 절대 규칙 명확히 인지, 코드 리뷰 시 확인

### 🟡 중간 리스크

#### 리스크 2: 근거 패키지 로직 복잡도
- **영향**: 구현 지연, 품질 저하
- **확률**: 중간 (로직 설계 필요)
- **대응**: 단계적 구현, 템플릿 활용, 구현 가이드 참고

#### 리스크 3: AI 호출 제한 구현 위치
- **영향**: 구현 지연
- **확률**: 낮음 (기존 함수 찾기 필요)
- **대응**: 기존 AI 호출 함수 찾아서 래핑

### 🟢 낮은 리스크

#### 리스크 4: schemaVersion 추가 누락
- **영향**: 마이그레이션 어려움
- **확률**: 낮음 (명확한 체크리스트)
- **대응**: 체크리스트 철저히 확인

---

## 완료 체크리스트 검증

### 최종 명세서 체크리스트

| 항목 | 상태 | 검증 방법 | 우선순위 |
|------|------|----------|----------|
| ✅ 공정 SSOT 완전 적용 | ❌ 미완료 | grep으로 중복 정의 검색 | 🔴 최우선 |
| ✅ 2차 분석 UI 실제 사용 가능 | ❌ 미완료 | E2E 테스트 | 🔴 높음 |
| ✅ 2차 결과 페이지 존재 | ❌ 미완료 | 파일 존재 확인 | 🔴 높음 |
| ✅ 지수 근거 패키지 강제 | ⚠️ 부분 | 검증 로직 테스트 | 🟡 중간 |
| ✅ 정책 분리 완료 | ❌ 미완료 | 정책 파일 변경 테스트 | 🟡 중간 |
| ✅ AI 호출 제한 작동 | ❌ 미완료 | 제한 로직 테스트 | 🟢 낮음 |
| ✅ schemaVersion 포함 저장 | ❌ 미완료 | 저장 데이터 검증 | 🟢 낮음 |

**완료율**: 0/7 (0%) → **즉시 시작 필요**

### 추가 권장 체크리스트

| 항목 | 설명 | 우선순위 |
|------|------|----------|
| ✅ 타입 에러 0 | TypeScript 컴파일 에러 없음 | 🔴 최우선 |
| ✅ 빌드 성공 | `npm run build` 성공 | 🔴 최우선 |
| ✅ E2E 테스트 통과 | 전체 플로우 테스트 | 🔴 높음 |
| ✅ 로컬스토리지 복원 테스트 | 새로고침 후 데이터 복원 | 🟡 중간 |
| ✅ 에러 처리 검증 | 모든 에러 케이스 처리 | 🟡 중간 |

---

## 개선 제안

### 1. 작업 6️⃣ 보완 (AI 호출 제한)

**현재 문제점**:
- 파일 위치 불명확
- 세션 추적 방식 미명시

**개선 제안**:
- **권장 파일 위치**: `lib/api/ai-call-limiter.ts` (신규 생성)
- **세션 추적 방식**: localStorage 기반 (간단한 방법)
- **구현 가이드**: 위의 구현 가이드 참고

### 2. 작업 4️⃣ 보완 (근거 패키지)

**현재 상태**:
- 필수 구조는 명확
- 추출 로직은 구현 가이드 제공됨

**개선 제안**:
- 구현 가이드를 참고하여 단계적 구현
- 먼저 기본 구조 구현, 이후 로직 보완

---

## 종합 평가 및 결론

### 종합 점수

| 평가 항목 | 점수 | 비고 |
|-----------|------|------|
| **구체성** | ⭐⭐⭐⭐⭐ (5/5) | 파일 경로, 코드 예시까지 명시 |
| **실행 가능성** | ⭐⭐⭐⭐⭐ (5/5) | 즉시 작업 시작 가능 |
| **우선순위 명확성** | ⭐⭐⭐⭐⭐ (5/5) | Phase별 우선순위 명확 |
| **완료 기준** | ⭐⭐⭐⭐⭐ (5/5) | 각 작업별 명확한 기준 |
| **리스크 관리** | ⭐⭐⭐⭐⭐ (5/5) | Phase 순서로 리스크 최소화 |
| **보완도** | ⭐⭐⭐⭐⭐ (5/5) | 이전 보고서의 모든 보완 사항 반영 |

**총점**: ⭐⭐⭐⭐⭐ (5/5) - **완벽한 실행 가이드**

### 핵심 강점

1. ✅ **구체성**: 파일 경로, 코드 예시까지 명시되어 즉시 작업 가능
2. ✅ **Phase 구조**: 시스템 붕괴 방지 → 신뢰 방지 → 운영 안전장치로 단계적 접근
3. ✅ **절대 규칙**: 5가지 규칙으로 실수 방지
4. ✅ **완료 기준**: 각 작업별 명확한 완료 기준 제시
5. ✅ **보완 완료**: 이전 보고서의 모든 지적 사항 반영

### 주요 개선 완료 사항

1. ✅ **작업 2️⃣ 보완 완료**: 질문 선택 로직 규칙 명시
2. ✅ **작업 4️⃣ 보완 완료**: 필수 구조 명시
3. ⚠️ **작업 6️⃣ 부분 보완**: 동작은 명확, 위치는 구현 시 결정

### 최종 권장 사항

**✅ 즉시 시작 가능**:
- 최종 명세서가 매우 구체적이므로 즉시 작업 시작 가능
- Phase 1부터 순차적으로 진행

**✅ 단계적 검증**:
- 각 Phase 완료 후 반드시 체크리스트 확인
- 다음 Phase 진입 전 검증 완료 필수

**✅ 구현 가이드 활용**:
- 작업 2️⃣, 4️⃣, 6️⃣의 구현 가이드 참고
- 단계적 구현으로 리스크 최소화

---

## 부록: 작업 체크리스트 (실행용)

### Phase 1 체크리스트

- [ ] **SSOT 원칙**
  - [ ] `lib/data/process-options.ts` 생성
  - [ ] 모든 파일에서 SSOT import
  - [ ] 중복 정의 제거 확인 (grep 검색)
  - [ ] 타입 에러 0 확인

- [ ] **2차 분석 UI**
  - [ ] `app/v5/analysis-phase2/page.tsx` 생성
  - [ ] 질문 선택 로직 구현 (8~12개 상한)
  - [ ] 공정 우선순위 기반 질문 선택
  - [ ] `v5DnaResult2` 저장 확인

- [ ] **2차 결과 페이지**
  - [ ] `app/v5/dna-result-2/page.tsx` 생성
  - [ ] 최종 트레이트 표시
  - [ ] 6대 지수 표시
  - [ ] 추천 표시
  - [ ] 다음 단계 이동 확인

### Phase 2 체크리스트

- [ ] **근거 패키지 강제**
  - [ ] 필수 구조 구현 (score, topFactors, assumption, improvement)
  - [ ] 검증 로직 추가
  - [ ] 누락 시 FAIL 처리 확인
  - [ ] 모든 지수에 적용 확인

- [ ] **정책 분리**
  - [ ] `lib/policy/grade-policy.ts` 생성
  - [ ] `gradeSpecs.ts` 리팩토링
  - [ ] 정책 파일만 변경하여 결과 변경 테스트
  - [ ] 코드 수정 없이 정책 교체 확인

### Phase 3 체크리스트

- [ ] **AI 호출 제한**
  - [ ] 공통 래퍼 함수 생성/수정
  - [ ] 세션당 3회 제한 로직 구현
  - [ ] 초과 시 에러 처리 확인
  - [ ] 로그 기록 확인

- [ ] **schemaVersion**
  - [ ] 모든 저장 데이터에 `schemaVersion` 추가
  - [ ] `lib/migration/trait-mapping.ts` 생성
  - [ ] 매핑 테이블 구조 준비
  - [ ] 저장 데이터 검증

### 최종 통합 체크리스트

- [ ] 타입 에러 0
- [ ] 빌드 성공
- [ ] E2E 테스트 통과
- [ ] 로컬스토리지 복원 테스트
- [ ] 에러 처리 검증
- [ ] 성능 테스트 (선택)

---

**작성일**: 2025-01-21  
**버전**: 2.0 (최종 보완판 분석)  
**상태**: 분석 완료, 실행 준비 완료


